<div class="profile-container">
  <!-- Loading Spinner -->
  <div *ngIf="isLoading()" class="loading-container">
    <div class="spinner"></div>
    <p>Loading profile...</p>
  </div>

  <!-- Profile Content -->
  <div *ngIf="!isLoading()" class="profile-content">
    <!-- Header -->
    <div class="profile-header">
      <div class="header-content">
        <div class="profile-picture-section">
          <div class="profile-avatar" [style.background-image]="profilePicturePreview ? 'url(' + profilePicturePreview + ')' : 'none'">
            <span *ngIf="!profilePicturePreview" class="avatar-initials">{{ getUserInitials() }}</span>
          </div>
        </div>
        <div class="user-info">
          <h1>{{ getUserDisplayName() }}</h1>
          <p class="user-type">{{ currentUser?.userRole === 'mentor' ? 'Mentor' : 'Mentee' }}</p>
          <p class="user-email">{{ currentUser?.email }}</p>
        </div>
      </div>
      <button 
        class="save-button"
        [disabled]="isSaving()"
        (click)="saveProfile()">
        <span *ngIf="!isSaving()">üíæ Save Profile</span>
        <span *ngIf="isSaving()">‚è≥ Saving...</span>
      </button>
    </div>

    <!-- Progress Bar -->
    <div class="progress-bar">
      <div class="progress-steps">
        <div 
          *ngFor="let tab of tabs; let i = index" 
          class="step"
          [class.active]="currentTab() === i"
          [class.completed]="currentTab() > i"
          (click)="switchTab(i)">
          <div class="step-number">{{ i + 1 }}</div>
          <span class="step-title">{{ tab.title }}</span>
        </div>
      </div>
      <div class="progress-line" [style.width.%]="progressPercentage()"></div>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Basic Info Tab -->
      <div class="tab-panel" *ngIf="currentTab() === 0">
        <div class="tab-header">
          <h2>Basic Information</h2>
          <p>Tell us about yourself and your expertise</p>
        </div>

        <form [formGroup]="basicInfoForm" class="profile-form">
          <!-- Profile Picture Upload -->
          <div class="form-section">
            <h3>Profile Picture</h3>
            <div class="file-upload-container">
              <div class="file-upload-preview" *ngIf="profilePicturePreview">
                <img [src]="profilePicturePreview" alt="Profile preview" class="preview-image">
                <button type="button" class="remove-image-btn" (click)="removeProfilePicture()">
                  ‚úï
                </button>
              </div>
              <div class="file-upload-area" *ngIf="!profilePicturePreview">
                <input type="file" id="profilePicture" accept="image/*" (change)="onFileSelected($event)" hidden>
                <label for="profilePicture" class="file-upload-label">
                  <div class="upload-icon">üì∑</div>
                  <span>Click to upload profile picture</span>
                  <small>Max file size: 5MB</small>
                </label>
              </div>
            </div>
          </div>

          <!-- Location -->
          <div class="form-group">
            <label for="location">Location</label>
            <input type="text" id="location" formControlName="location" placeholder="City, Country">
          </div>

          <!-- About -->
          <div class="form-group">
            <label for="about">About Me</label>
            <textarea id="about" formControlName="about" rows="4" placeholder="Tell us about yourself..."></textarea>
          </div>

          <!-- Expertise -->
          <div class="form-group">
            <label>Areas of Expertise</label>
            <app-searchable-dropdown
              [options]="expertiseOptions"
              placeholder="Search or add expertise areas"
              [allowCustom]="true"
              (optionSelected)="onExpertiseSelected($event)">
            </app-searchable-dropdown>
            <div class="tags-container" *ngIf="expertiseArray.length > 0">
              <span 
                *ngFor="let item of expertiseArray.controls; let i = index" 
                class="tag">
                {{ item.value }}
                <button type="button" (click)="removeFromArray('expertise', i)">√ó</button>
              </span>
            </div>
          </div>

          <!-- Skills -->
          <div class="form-group">
            <label>Skills</label>
            <app-searchable-dropdown
              [options]="skillsOptions"
              placeholder="Search or add skills"
              [allowCustom]="true"
              (optionSelected)="onSkillSelected($event)">
            </app-searchable-dropdown>
            <div class="tags-container" *ngIf="skillsArray.length > 0">
              <span 
                *ngFor="let item of skillsArray.controls; let i = index" 
                class="tag">
                {{ item.value }}
                <button type="button" (click)="removeFromArray('skills', i)">√ó</button>
              </span>
            </div>
          </div>

          <!-- Specializations -->
          <div class="form-group">
            <label>Specializations</label>
            <app-searchable-dropdown
              [options]="specializationsOptions"
              placeholder="Search or add specializations"
              [allowCustom]="true"
              (optionSelected)="onSpecializationSelected($event)">
            </app-searchable-dropdown>
            <div class="tags-container" *ngIf="specializationsArray.length > 0">
              <span 
                *ngFor="let item of specializationsArray.controls; let i = index" 
                class="tag">
                {{ item.value }}
                <button type="button" (click)="removeFromArray('specializations', i)">√ó</button>
              </span>
            </div>
          </div>

          <!-- Languages -->
          <div class="form-group">
            <label>Languages</label>
            <app-searchable-dropdown
              [options]="languagesOptions"
              placeholder="Search or add languages"
              [allowCustom]="true"
              (optionSelected)="onLanguageSelected($event)">
            </app-searchable-dropdown>
            <div class="tags-container" *ngIf="languagesArray.length > 0">
              <span 
                *ngFor="let item of languagesArray.controls; let i = index" 
                class="tag">
                {{ item.value }}
                <button type="button" (click)="removeFromArray('languages', i)">√ó</button>
              </span>
            </div>
          </div>

          <!-- Mentorship Style -->
          <div class="form-group">
            <label>Mentorship Style</label>
            <app-searchable-dropdown
              [options]="mentorshipStyleOptions"
              placeholder="Search or add mentorship styles"
              [allowCustom]="true"
              (optionSelected)="onMentorshipStyleSelected($event)">
            </app-searchable-dropdown>
            <div class="tags-container" *ngIf="mentorshipStyleArray.length > 0">
              <span 
                *ngFor="let item of mentorshipStyleArray.controls; let i = index" 
                class="tag">
                {{ item.value }}
                <button type="button" (click)="removeFromArray('mentorshipStyle', i)">√ó</button>
              </span>
            </div>
          </div>
        </form>
      </div>

      <!-- Experience Tab -->
      <div class="tab-panel" *ngIf="currentTab() === 1">
        <div class="tab-header">
          <h2>Experience & Background</h2>
          <p>Share your educational and professional background</p>
        </div>

        <form [formGroup]="experienceForm" class="profile-form">
          <!-- Education -->
          <div class="form-section">
            <div class="section-header">
              <h3>Education</h3>
              <button type="button" class="add-btn" (click)="addEducation()">+ Add Education</button>
            </div>
            
            <div formArrayName="education" class="form-array">
              <div 
                *ngFor="let edu of educationArray.controls; let i = index" 
                [formGroupName]="i" 
                class="array-item">
                <div class="form-row">
                  <div class="form-group">
                    <label>Degree/Certificate</label>
                    <input type="text" formControlName="degree" placeholder="Bachelor of Science in...">
                  </div>
                  <div class="form-group">
                    <label>Institution</label>
                    <input type="text" formControlName="institution" placeholder="University name">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>Start Date</label>
                    <input type="date" formControlName="startDate">
                  </div>
                  <div class="form-group">
                    <label>End Date</label>
                    <input type="date" formControlName="endDate">
                  </div>
                </div>
                <div class="form-group">
                  <label>Description</label>
                  <textarea formControlName="description" rows="2" placeholder="Brief description..."></textarea>
                </div>
                <button type="button" class="remove-btn" (click)="removeEducation(i)">Remove</button>
              </div>
            </div>
          </div>

          <!-- Work Experience -->
          <div class="form-section">
            <div class="section-header">
              <h3>Work Experience</h3>
              <button type="button" class="add-btn" (click)="addWorkExperience()">+ Add Experience</button>
            </div>
            
            <div formArrayName="workExperience" class="form-array">
              <div 
                *ngFor="let work of workExperienceArray.controls; let i = index" 
                [formGroupName]="i" 
                class="array-item">
                <div class="form-row">
                  <div class="form-group">
                    <label>Job Title</label>
                    <input type="text" formControlName="jobTitle" placeholder="Software Engineer">
                  </div>
                  <div class="form-group">
                    <label>Company</label>
                    <input type="text" formControlName="company" placeholder="Company name">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>Start Date</label>
                    <input type="date" formControlName="startDate">
                  </div>
                  <div class="form-group">
                    <label>End Date</label>
                    <input type="date" formControlName="endDate">
                  </div>
                </div>
                <div class="form-group">
                  <label>Description</label>
                  <textarea formControlName="description" rows="3" placeholder="Describe your role and responsibilities..."></textarea>
                </div>
                <button type="button" class="remove-btn" (click)="removeWorkExperience(i)">Remove</button>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Achievements Tab -->
      <div class="tab-panel" *ngIf="currentTab() === 2">
        <div class="tab-header">
          <h2>Achievements & Awards</h2>
          <p>Share your accomplishments and recognitions</p>
        </div>

        <form [formGroup]="achievementsForm" class="profile-form">
          <div class="form-section">
            <div class="section-header">
              <h3>Achievements</h3>
              <button type="button" class="add-btn" (click)="addAchievement()">+ Add Achievement</button>
            </div>
            
            <div formArrayName="achievements" class="form-array">
              <div 
                *ngFor="let achievement of achievementsArray.controls; let i = index" 
                [formGroupName]="i" 
                class="array-item">
                <div class="form-group">
                  <label>Achievement Title</label>
                  <input type="text" formControlName="title" placeholder="Award name or achievement">
                </div>
                <div class="form-group">
                  <label>Description</label>
                  <textarea formControlName="description" rows="3" placeholder="Describe your achievement..."></textarea>
                </div>
                <div class="form-group">
                  <label>Date</label>
                  <input type="date" formControlName="date">
                </div>
                <button type="button" class="remove-btn" (click)="removeAchievement(i)">Remove</button>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Certifications Tab -->
      <div class="tab-panel" *ngIf="currentTab() === 3">
        <div class="tab-header">
          <h2>Certifications & Credentials</h2>
          <p>Share your professional certifications and credentials</p>
        </div>

        <form [formGroup]="certificationsForm" class="profile-form">
          <div class="form-section">
            <div class="section-header">
              <h3>Certifications</h3>
              <button type="button" class="add-btn" (click)="addCertification()">+ Add Certification</button>
            </div>
            
            <div formArrayName="certifications" class="form-array">
              <div 
                *ngFor="let certification of certificationsArray.controls; let i = index" 
                [formGroupName]="i" 
                class="array-item">
                <div class="form-row">
                  <div class="form-group">
                    <label>Certification Title</label>
                    <input type="text" formControlName="title" placeholder="Certification name">
                  </div>
                  <div class="form-group">
                    <label>Institution/Organization</label>
                    <input type="text" formControlName="institution" placeholder="Issuing organization">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>Issued Date</label>
                    <input type="date" formControlName="issuedDate">
                  </div>
                  <div class="form-group">
                    <label>Expiration Date</label>
                    <input type="date" formControlName="expirationDate">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>Credential ID</label>
                    <input type="text" formControlName="credentialId" placeholder="Certificate ID">
                  </div>
                  <div class="form-group">
                    <label>Verification URL</label>
                    <input type="url" formControlName="verificationUrl" placeholder="https://verify.example.com">
                  </div>
                </div>
                <button type="button" class="remove-btn" (click)="removeCertification(i)">Remove</button>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Availability Tab -->
      <div class="tab-panel" *ngIf="currentTab() === 4">
        <div class="tab-header">
          <h2>Availability & Schedule</h2>
          <p>Set your availability for mentoring sessions</p>
        </div>

        <form [formGroup]="availabilityForm" class="profile-form">
          <!-- Time Zone -->
          <div class="form-group">
            <label for="timeZone">Time Zone</label>
            <select id="timeZone" formControlName="timeZone">
              <option value="">Select time zone</option>
              <option value="PST">PST (UTC-8)</option>
              <option value="EST">EST (UTC-5)</option>
              <option value="GMT">GMT (UTC+0)</option>
              <option value="JST">JST (UTC+9)</option>
              <option value="PHT">PHT (UTC+8)</option>
            </select>
          </div>

          <!-- Available Time Slots -->
          <div class="form-section">
            <div class="section-header">
              <h3>Available Time Slots</h3>
              <button type="button" class="add-btn" (click)="addTimeSlot()">+ Add Time Slot</button>
            </div>
            
            <div formArrayName="availableTimeSlots" class="form-array">
              <div 
                *ngFor="let slot of timeSlotsArray.controls; let i = index" 
                [formGroupName]="i" 
                class="array-item">
                <div class="form-row">
                  <div class="form-group">
                    <label>Day</label>
                    <select formControlName="day">
                      <option value="">Select day</option>
                      <option value="Monday">Monday</option>
                      <option value="Tuesday">Tuesday</option>
                      <option value="Wednesday">Wednesday</option>
                      <option value="Thursday">Thursday</option>
                      <option value="Friday">Friday</option>
                      <option value="Saturday">Saturday</option>
                      <option value="Sunday">Sunday</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Start Time</label>
                    <input type="time" formControlName="startTime">
                  </div>
                  <div class="form-group">
                    <label>End Time</label>
                    <input type="time" formControlName="endTime">
                  </div>
                </div>
                <button type="button" class="remove-btn" (click)="removeTimeSlot(i)">Remove</button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="navigation-buttons">
      <button 
        type="button" 
        class="nav-btn prev-btn" 
        [disabled]="currentTab() === 0"
        (click)="switchTab(currentTab() - 1)">
        ‚Üê Previous
      </button>
      <button 
        type="button" 
        class="nav-btn next-btn" 
        [disabled]="currentTab() === tabs.length - 1"
        (click)="switchTab(currentTab() + 1)">
        Next ‚Üí
      </button>
    </div>
  </div>
</div>
