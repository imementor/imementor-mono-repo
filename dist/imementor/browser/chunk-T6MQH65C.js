import{$b as Xd,F as We,J as Gd,P as gt,R as Kd,U as os,X as Wn,Z as Fe,_ as zn,_b as Yd,a as ye,aa as Qd,ac as ba,b as Ut,ba as as,c as va,d as mt,db as Ze,e as p,ga as Bt,h as ln,l as wa,m as zd,n as Hd,oa as cs,p as ss,pa as Ue,q as Ta,r as Aa,s as Te,u as De,x as jn,xa as Jd}from"./chunk-Q3SXWR5O.js";var Zd=()=>{};var nf=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Cy=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],a=n[t++],c=n[t++],l=((i&7)<<18|(s&63)<<12|(a&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{let s=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return e.join("")},us={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],a=i+1<n.length,c=a?n[i+1]:0,l=i+2<n.length,d=l?n[i+2]:0,m=s>>2,I=(s&3)<<4|c>>4,E=(c&15)<<2|d>>6,S=d&63;l||(S=64,a||(E=64)),r.push(t[m],t[I],t[E],t[S])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(nf(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Cy(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],c=i<n.length?t[n.charAt(i)]:0;++i;let d=i<n.length?t[n.charAt(i)]:64;++i;let I=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||c==null||d==null||I==null)throw new Ra;let E=s<<2|c>>4;if(r.push(E),d!==64){let S=c<<4&240|d>>2;if(r.push(S),I!==64){let k=d<<6&192|I;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Ra=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},ky=function(n){let e=nf(n);return us.encodeByteArray(e,!0)},Xr=function(n){return ky(n).replace(/\./g,"")},ls=function(n){try{return us.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Ca(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Dy=()=>Ca().__FIREBASE_DEFAULTS__,Ny=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Oy=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&ls(n[1]);return e&&JSON.parse(e)},hs=()=>{try{return Zd()||Dy()||Ny()||Oy()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},ka=n=>{var e,t;return(t=(e=hs())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},rf=n=>{let e=ka(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Da=()=>{var n;return(n=hs())===null||n===void 0?void 0:n.config},Na=n=>{var e;return(e=hs())===null||e===void 0?void 0:e[`_${n}`]};var hn=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function qt(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function ds(n){return p(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function sf(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Xr(JSON.stringify(t)),Xr(JSON.stringify(a)),""].join(".")}var Yr={};function Ly(){let n={prod:[],emulator:[]};for(let e of Object.keys(Yr))Yr[e]?n.emulator.push(e):n.prod.push(e);return n}function xy(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var ef=!1;function fs(n,e){if(typeof window>"u"||typeof document>"u"||!qt(window.location.host)||Yr[n]===e||Yr[n]||ef)return;Yr[n]=e;function t(E){return`__firebase__banner__${E}`}let r="__firebase__banner",s=Ly().prod.length>0;function a(){let E=document.getElementById(r);E&&E.remove()}function c(E){E.style.display="flex",E.style.background="#7faaf0",E.style.position="fixed",E.style.bottom="5px",E.style.left="5px",E.style.padding=".5em",E.style.borderRadius="5px",E.style.alignItems="center"}function l(E,S){E.setAttribute("width","24"),E.setAttribute("id",S),E.setAttribute("height","24"),E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","none"),E.style.marginLeft="-6px"}function d(){let E=document.createElement("span");return E.style.cursor="pointer",E.style.marginLeft="16px",E.style.fontSize="24px",E.innerHTML=" &times;",E.onclick=()=>{ef=!0,a()},E}function m(E,S){E.setAttribute("id",S),E.innerText="Learn more",E.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",E.setAttribute("target","__blank"),E.style.paddingLeft="5px",E.style.textDecoration="underline"}function I(){let E=xy(r),S=t("text"),k=document.getElementById(S)||document.createElement("span"),L=t("learnmore"),D=document.getElementById(L)||document.createElement("a"),$=t("preprendIcon"),U=document.getElementById($)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(E.created){let j=E.element;c(j),m(D,L);let X=d();l(U,$),j.append(U,k,D,X),document.body.appendChild(j)}s?(k.innerText="Preview backend disconnected.",U.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(U.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",I):I()}function pe(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function of(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(pe())}function Vy(){var n;let e=(n=hs())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function af(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function cf(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function uf(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function lf(){let n=pe();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function hf(){return!Vy()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Zr(){try{return typeof indexedDB=="object"}catch{return!1}}function df(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}var My="FirebaseError",xe=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=My,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ze.prototype.create)}},ze=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],a=s?Fy(s,r):"Error",c=`${this.serviceName}: ${a} (${i}).`;return new xe(i,c,r)}};function Fy(n,e){return n.replace(Uy,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var Uy=/\{\$([^}]+)}/g;function ff(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function et(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let s=n[i],a=e[i];if(tf(s)&&tf(a)){if(!et(s,a))return!1}else if(s!==a)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function tf(n){return n!==null&&typeof n=="object"}function Hn(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Gn(n){let e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function Kn(n){let e=n.indexOf("?");if(!e)return"";let t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function pf(n,e){let t=new Pa(n,e);return t.subscribe.bind(t)}var Pa=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");By(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=Sa),i.error===void 0&&(i.error=Sa),i.complete===void 0&&(i.complete=Sa);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function By(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Sa(){}var tR=4*60*60*1e3;function ie(n){return n&&n._delegate?n._delegate:n}var Ne=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var dn="[DEFAULT]";var Oa=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new hn;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if($y(e))try{this.getOrInitializeService({instanceIdentifier:dn})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=dn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return p(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=dn){return this.instances.has(e)}getOptions(e=dn){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[s,a]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(s);r===c&&a.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);let a=this.instances.get(i);return a&&e(a,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:qy(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=dn){return this.component?this.component.multipleInstances?e:dn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function qy(n){return n===dn?void 0:n}function $y(n){return n.instantiationMode==="EAGER"}var ps=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new Oa(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var jy=[],z=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(z||{}),Wy={debug:z.DEBUG,verbose:z.VERBOSE,info:z.INFO,warn:z.WARN,error:z.ERROR,silent:z.SILENT},zy=z.INFO,Hy={[z.DEBUG]:"log",[z.VERBOSE]:"log",[z.INFO]:"info",[z.WARN]:"warn",[z.ERROR]:"error"},Gy=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=Hy[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},tt=class{constructor(e){this.name=e,this._logLevel=zy,this._logHandler=Gy,this._userLogHandler=null,jy.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in z))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Wy[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,z.DEBUG,...e),this._logHandler(this,z.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,z.VERBOSE,...e),this._logHandler(this,z.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,z.INFO,...e),this._logHandler(this,z.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,z.WARN,...e),this._logHandler(this,z.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,z.ERROR,...e),this._logHandler(this,z.ERROR,...e)}};var Ky=(n,e)=>e.some(t=>n instanceof t),mf,gf;function Qy(){return mf||(mf=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Jy(){return gf||(gf=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var _f=new WeakMap,xa=new WeakMap,yf=new WeakMap,La=new WeakMap,Ma=new WeakMap;function Yy(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{t(nt(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&_f.set(t,n)}).catch(()=>{}),Ma.set(e,n),e}function Xy(n){if(xa.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});xa.set(n,e)}var Va={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return xa.get(n);if(e==="objectStoreNames")return n.objectStoreNames||yf.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return nt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function If(n){Va=n(Va)}function Zy(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(ms(this),e,...t);return yf.set(r,e.sort?e.sort():[e]),nt(r)}:Jy().includes(n)?function(...e){return n.apply(ms(this),e),nt(_f.get(this))}:function(...e){return nt(n.apply(ms(this),e))}}function eI(n){return typeof n=="function"?Zy(n):(n instanceof IDBTransaction&&Xy(n),Ky(n,Qy())?new Proxy(n,Va):n)}function nt(n){if(n instanceof IDBRequest)return Yy(n);if(La.has(n))return La.get(n);let e=eI(n);return e!==n&&(La.set(n,e),Ma.set(e,n)),e}var ms=n=>Ma.get(n);function gs(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(n,e),c=nt(a);return r&&a.addEventListener("upgradeneeded",l=>{r(nt(a.result),l.oldVersion,l.newVersion,nt(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),c.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}var tI=["get","getKey","getAll","getAllKeys","count"],nI=["put","add","delete","clear"],Fa=new Map;function Ef(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Fa.get(e))return Fa.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=nI.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||tI.includes(t)))return;let s=function(a,...c){return p(this,null,function*(){let l=this.transaction(a,i?"readwrite":"readonly"),d=l.store;return r&&(d=d.index(c.shift())),(yield Promise.all([d[t](...c),i&&l.done]))[0]})};return Fa.set(e,s),s}If(n=>Ut(ye({},n),{get:(e,t,r)=>Ef(e,t)||n.get(e,t,r),has:(e,t)=>!!Ef(e,t)||n.has(e,t)}));var Ba=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(rI(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function rI(n){let e=n.getComponent();return e?.type==="VERSION"}var qa="@firebase/app",vf="0.13.2";var _t=new tt("@firebase/app"),iI="@firebase/app-compat",sI="@firebase/analytics-compat",oI="@firebase/analytics",aI="@firebase/app-check-compat",cI="@firebase/app-check",uI="@firebase/auth",lI="@firebase/auth-compat",hI="@firebase/database",dI="@firebase/data-connect",fI="@firebase/database-compat",pI="@firebase/functions",mI="@firebase/functions-compat",gI="@firebase/installations",_I="@firebase/installations-compat",yI="@firebase/messaging",II="@firebase/messaging-compat",EI="@firebase/performance",vI="@firebase/performance-compat",wI="@firebase/remote-config",TI="@firebase/remote-config-compat",AI="@firebase/storage",bI="@firebase/storage-compat",SI="@firebase/firestore",RI="@firebase/ai",PI="@firebase/firestore-compat",CI="firebase",kI="11.10.0";var $a="[DEFAULT]",DI={[qa]:"fire-core",[iI]:"fire-core-compat",[oI]:"fire-analytics",[sI]:"fire-analytics-compat",[cI]:"fire-app-check",[aI]:"fire-app-check-compat",[uI]:"fire-auth",[lI]:"fire-auth-compat",[hI]:"fire-rtdb",[dI]:"fire-data-connect",[fI]:"fire-rtdb-compat",[pI]:"fire-fn",[mI]:"fire-fn-compat",[gI]:"fire-iid",[_I]:"fire-iid-compat",[yI]:"fire-fcm",[II]:"fire-fcm-compat",[EI]:"fire-perf",[vI]:"fire-perf-compat",[wI]:"fire-rc",[TI]:"fire-rc-compat",[AI]:"fire-gcs",[bI]:"fire-gcs-compat",[SI]:"fire-fst",[PI]:"fire-fst-compat",[RI]:"fire-vertex","fire-js":"fire-js",[CI]:"fire-js-all"};var ei=new Map,NI=new Map,ja=new Map;function wf(n,e){try{n.container.addComponent(e)}catch(t){_t.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function He(n){let e=n.name;if(ja.has(e))return _t.debug(`There were multiple attempts to register component ${e}.`),!1;ja.set(e,n);for(let t of ei.values())wf(t,n);for(let t of NI.values())wf(t,n);return!0}function Qn(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Oe(n){return n==null?!1:n.settings!==void 0}var OI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},$t=new ze("app","Firebase",OI);var Wa=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ne("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw $t.create("app-deleted",{appName:this._name})}};var jt=kI;function Ga(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:$a,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw $t.create("bad-app-name",{appName:String(i)});if(t||(t=Da()),!t)throw $t.create("no-options");let s=ei.get(i);if(s){if(et(t,s.options)&&et(r,s.config))return s;throw $t.create("duplicate-app",{appName:i})}let a=new ps(i);for(let l of ja.values())a.addComponent(l);let c=new Wa(t,r,a);return ei.set(i,c),c}function fn(n=$a){let e=ei.get(n);if(!e&&n===$a&&Da())return Ga();if(!e)throw $t.create("no-app",{appName:n});return e}function _s(){return Array.from(ei.values())}function se(n,e,t){var r;let i=(r=DI[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let s=i.match(/\s|\//),a=e.match(/\s|\//);if(s||a){let c=[`Unable to register library "${i}" with version "${e}":`];s&&c.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&c.push("and"),a&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),_t.warn(c.join(" "));return}He(new Ne(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var LI="firebase-heartbeat-database",xI=1,ti="firebase-heartbeat-store",Ua=null;function Sf(){return Ua||(Ua=gs(LI,xI,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(ti)}catch(t){console.warn(t)}}}}).catch(n=>{throw $t.create("idb-open",{originalErrorMessage:n.message})})),Ua}function VI(n){return p(this,null,function*(){try{let t=(yield Sf()).transaction(ti),r=yield t.objectStore(ti).get(Rf(n));return yield t.done,r}catch(e){if(e instanceof xe)_t.warn(e.message);else{let t=$t.create("idb-get",{originalErrorMessage:e?.message});_t.warn(t.message)}}})}function Tf(n,e){return p(this,null,function*(){try{let r=(yield Sf()).transaction(ti,"readwrite");yield r.objectStore(ti).put(e,Rf(n)),yield r.done}catch(t){if(t instanceof xe)_t.warn(t.message);else{let r=$t.create("idb-set",{originalErrorMessage:t?.message});_t.warn(r.message)}}})}function Rf(n){return`${n.name}!${n.options.appId}`}var MI=1024,FI=30,za=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Ha(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return p(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Af();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>FI){let a=BI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){_t.warn(r)}})}getHeartbeatsHeader(){return p(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=Af(),{heartbeatsToSend:r,unsentEntries:i}=UI(this._heartbeatsCache.heartbeats),s=Xr(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return _t.warn(t),""}})}};function Af(){return new Date().toISOString().substring(0,10)}function UI(n,e=MI){let t=[],r=n.slice();for(let i of n){let s=t.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),bf(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),bf(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var Ha=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return p(this,null,function*(){return Zr()?df().then(()=>!0).catch(()=>!1):!1})}read(){return p(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield VI(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return p(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Tf(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return p(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Tf(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function bf(n){return Xr(JSON.stringify({version:2,heartbeats:n})).length}function BI(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function qI(n){He(new Ne("platform-logger",e=>new Ba(e),"PRIVATE")),He(new Ne("heartbeat",e=>new za(e),"PRIVATE")),se(qa,vf,n),se(qa,vf,"esm2017"),se("fire-js","")}qI("");var $I="firebase",jI="11.10.0";se($I,jI,"app");function Pf(n){n===void 0&&(n=Fe(Bt));let e=n.get(cs);return t=>new ln(r=>{let i=e.add(),s=!1;function a(){s||(i(),s=!0)}let c=t.subscribe({next:l=>{r.next(l),a()},complete:()=>{r.complete(),a()},error:l=>{r.error(l),a()}});return c.add(()=>{r.unsubscribe(),a()}),c})}var Wt=new Yd("ANGULARFIRE2_VERSION");function ni(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(a=>a.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Yn=(n,e)=>{let t=e?[e]:_s(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(a=>{r.includes(a)||r.push(a)})}),r},Jn=function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n}(Jn||{}),Cf=ba()&&typeof Zone<"u"?Jn.WARN:Jn.SILENT;var ys=class{zone;delegate;constructor(e,t=Hd){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(a){i?i.runGuarded(()=>{e.apply(this,[a])}):e.apply(this,[a])};return this.delegate.schedule(s,t,r)}},zt=(()=>{class n{outsideAngular;insideAngular;constructor(){let t=Fe(Ze);this.outsideAngular=t.runOutsideAngular(()=>new ys(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new ys(typeof Zone>"u"?void 0:Zone.current,zd))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=os({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),kf=!1;function zI(n,e){!kf&&(Cf>Jn.SILENT||ba())&&(kf=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),Cf>=e&&console.warn(`Firebase API called outside injection context: ${n.name}`)}function HI(n){let e=Fe(Ze,{optional:!0});return e?e.runOutsideAngular(()=>n()):n()}function pn(n){let e=Fe(Ze,{optional:!0});return e?e.run(()=>n()):n()}var GI=(n,e,t)=>(...r)=>(e&&setTimeout(e,0),as(t,()=>pn(()=>n.apply(void 0,r)))),ae=(n,e,t)=>(t||=e?Jn.WARN:Jn.VERBOSE,function(){let r,i=arguments,s,a,c;try{s=Fe(zt),a=Fe(cs),c=Fe(Qd)}catch{return zI(n,t),n.apply(this,i)}for(let d=0;d<arguments.length;d++)typeof i[d]=="function"&&(e&&(r||=pn(()=>a.add())),i[d]=GI(i[d],r,c));let l=HI(()=>n.apply(this,i));return e?l instanceof ln?l.pipe(Aa(s.outsideAngular),Ta(s.insideAngular),Pf(c)):l instanceof Promise?pn(()=>{let d=a.add();return new Promise((m,I)=>{l.then(E=>as(c,()=>pn(()=>m(E))),E=>as(c,()=>pn(()=>I(E)))).finally(d)})}):typeof l=="function"&&r?function(){return setTimeout(r,0),l.apply(this,arguments)}:pn(()=>l):l instanceof ln?l.pipe(Aa(s.outsideAngular),Ta(s.insideAngular)):pn(()=>l)});var yt=class{constructor(e){return e}},mn=class{constructor(){return _s()}};function KI(n){return n&&n.length===1?n[0]:new yt(fn())}var Ka=new Wn("angularfire2._apps"),QI={provide:yt,useFactory:KI,deps:[[new Ue,Ka]]},JI={provide:mn,deps:[[new Ue,Ka]]};function YI(n){return(e,t)=>{let r=t.get(Jd);se("angularfire",Wt.full,"core"),se("angularfire",Wt.full,"app"),se("angular",Xd.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new yt(i)}}function ZR(n,...e){return zn([QI,JI,{provide:Ka,useFactory:YI(n),multi:!0,deps:[Ze,Bt,zt,...e]}])}var eP=ae(Ga,!0);var XI=new Map,ZI={activated:!1,tokenObservers:[]},eE={initialized:!1,enabled:!1};function Ge(n){return XI.get(n)||Object.assign({},ZI)}function Lf(){return eE}var tE="https://content-firebaseappcheck.googleapis.com/v1";var nE="exchangeDebugToken",Df={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},uP=24*60*60*1e3;var Ya=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return p(this,null,function*(){this.stop();try{this.pending=new hn,this.pending.promise.catch(t=>{}),yield rE(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new hn,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function rE(n){return new Promise(e=>{setTimeout(e,n)})}var iE={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},Ht=new ze("appCheck","AppCheck",iE);function xf(n){if(!Ge(n).activated)throw Ht.create("use-before-activation",{appName:n.name})}function Vf(r,i){return p(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},a=t.getImmediate({optional:!0});if(a){let S=yield a.getHeartbeatsHeader();S&&(s["X-Firebase-Client"]=S)}let c={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,c)}catch(S){throw Ht.create("fetch-network-error",{originalErrorMessage:S?.message})}if(l.status!==200)throw Ht.create("fetch-status-error",{httpStatus:l.status});let d;try{d=yield l.json()}catch(S){throw Ht.create("fetch-parse-error",{originalErrorMessage:S?.message})}let m=d.ttl.match(/^([\d.]+)(s)$/);if(!m||!m[2]||isNaN(Number(m[1])))throw Ht.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${d.ttl}`});let I=Number(m[1])*1e3,E=Date.now();return{token:d.token,expireTimeMillis:E+I,issuedAtTimeMillis:E}})}function Mf(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${tE}/projects/${t}/apps/${r}:${nE}?key=${i}`,body:{debug_token:e}}}var sE="firebase-app-check-database",oE=1,Xa="firebase-app-check-store";var Is=null;function aE(){return Is||(Is=new Promise((n,e)=>{try{let t=indexedDB.open(sE,oE);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Ht.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Xa,{keyPath:"compositeKey"})}}}catch(t){e(Ht.create("storage-open",{originalErrorMessage:t?.message}))}}),Is)}function cE(n,e){return uE(lE(n),e)}function uE(n,e){return p(this,null,function*(){let r=(yield aE()).transaction(Xa,"readwrite"),s=r.objectStore(Xa).put({compositeKey:n,value:e});return new Promise((a,c)=>{s.onsuccess=l=>{a()},r.onerror=l=>{var d;c(Ht.create("storage-set",{originalErrorMessage:(d=l.target.error)===null||d===void 0?void 0:d.message}))}})})}function lE(n){return`${n.options.appId}-${n.name}`}var ri=new tt("@firebase/app-check");function Qa(n,e){return Zr()?cE(n,e).catch(t=>{ri.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Ff(){return Lf().enabled}function Uf(){return p(this,null,function*(){let n=Lf();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var hE={error:"UNKNOWN_ERROR"};function dE(n){return us.encodeString(JSON.stringify(n),!1)}function Za(n,e=!1,t=!1){return p(this,null,function*(){let r=n.app;xf(r);let i=Ge(r),s=i.token,a;if(s&&!ii(s)&&(i.token=void 0,s=void 0),!s){let d=yield i.cachedTokenPromise;d&&(ii(d)?s=d:yield Qa(r,void 0))}if(!e&&s&&ii(s))return{token:s.token};let c=!1;if(Ff())try{i.exchangeTokenPromise||(i.exchangeTokenPromise=Vf(Mf(r,yield Uf()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),c=!0);let d=yield i.exchangeTokenPromise;return yield Qa(r,d),i.token=d,{token:d.token}}catch(d){return d.code==="appCheck/throttled"||d.code==="appCheck/initial-throttle"?ri.warn(d.message):t&&ri.error(d),Ja(d)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),c=!0),s=yield Ge(r).exchangeTokenPromise}catch(d){d.code==="appCheck/throttled"||d.code==="appCheck/initial-throttle"?ri.warn(d.message):t&&ri.error(d),a=d}let l;return s?a?ii(s)?l={token:s.token,internalError:a}:l=Ja(a):(l={token:s.token},i.token=s,yield Qa(r,s)):l=Ja(a),c&&gE(r,l),l})}function fE(n){return p(this,null,function*(){let e=n.app;xf(e);let{provider:t}=Ge(e);if(Ff()){let r=yield Uf(),{token:i}=yield Vf(Mf(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function pE(n,e,t,r){let{app:i}=n,s=Ge(i),a={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,a],s.token&&ii(s.token)){let c=s.token;Promise.resolve().then(()=>{t({token:c.token}),Nf(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Nf(n))}function Bf(n,e){let t=Ge(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function Nf(n){let{app:e}=n,t=Ge(e),r=t.tokenRefresher;r||(r=mE(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function mE(n){let{app:e}=n;return new Ya(()=>p(null,null,function*(){let t=Ge(e),r;if(t.token?r=yield Za(n,!0):r=yield Za(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=Ge(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},Df.RETRIAL_MIN_WAIT,Df.RETRIAL_MAX_WAIT)}function gE(n,e){let t=Ge(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function ii(n){return n.expireTimeMillis-Date.now()>0}function Ja(n){return{token:dE(hE),error:n}}var ec=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Ge(this.app);for(let t of e)Bf(this.app,t.next);return Promise.resolve()}};function _E(n,e){return new ec(n,e)}function yE(n){return{getToken:e=>Za(n,e),getLimitedUseToken:()=>fE(n),addTokenListener:e=>pE(n,"INTERNAL",e),removeTokenListener:e=>Bf(n.app,e)}}var IE="@firebase/app-check",EE="0.10.1";var vE="app-check",Of="app-check-internal";function wE(){He(new Ne(vE,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return _E(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Of).initialize()})),He(new Ne(Of,n=>{let e=n.getProvider("app-check").getImmediate();return yE(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),se(IE,EE)}wE();var TE="app-check";var Xn=class{constructor(){return Yn(TE)}};var AE=["localhost","0.0.0.0","127.0.0.1"],wP=typeof window<"u"&&AE.includes(window.location.hostname);var qf=()=>{};var $f=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},bE=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],a=n[t++],c=n[t++],l=((i&7)<<18|(s&63)<<12|(a&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{let s=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return e.join("")},jf={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],a=i+1<n.length,c=a?n[i+1]:0,l=i+2<n.length,d=l?n[i+2]:0,m=s>>2,I=(s&3)<<4|c>>4,E=(c&15)<<2|d>>6,S=d&63;l||(S=64,a||(E=64)),r.push(t[m],t[I],t[E],t[S])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray($f(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):bE(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],c=i<n.length?t[n.charAt(i)]:0;++i;let d=i<n.length?t[n.charAt(i)]:64;++i;let I=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||c==null||d==null||I==null)throw new nc;let E=s<<2|c>>4;if(r.push(E),d!==64){let S=c<<4&240|d>>2;if(r.push(S),I!==64){let k=d<<6&192|I;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},nc=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},SE=function(n){let e=$f(n);return jf.encodeByteArray(e,!0)},ic=function(n){return SE(n).replace(/\./g,"")},Es=function(n){try{return jf.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function RE(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var PE=()=>RE().__FIREBASE_DEFAULTS__,CE=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},kE=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&Es(n[1]);return e&&JSON.parse(e)},DE=()=>{try{return qf()||PE()||CE()||kE()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}};var Wf=n=>DE()?.[`_${n}`];function sc(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function Ke(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function zf(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ke())}function Hf(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Gf(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Kf(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Qf(){try{return typeof indexedDB=="object"}catch{return!1}}function Jf(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}var NE="FirebaseError",rt=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=NE,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,It.prototype.create)}},It=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],a=s?OE(s,r):"Error",c=`${this.serviceName}: ${a} (${i}).`;return new rt(i,c,r)}};function OE(n,e){return n.replace(LE,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var LE=/\{\$([^}]+)}/g;function oc(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Yf(n,e){let t=new rc(n,e);return t.subscribe.bind(t)}var rc=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");xE(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=tc),i.error===void 0&&(i.error=tc),i.complete===void 0&&(i.complete=tc);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function xE(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function tc(){}var RP=4*60*60*1e3;function Zn(n){return n&&n._delegate?n._delegate:n}var Et=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var VE=[],ee=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(ee||{}),ME={debug:ee.DEBUG,verbose:ee.VERBOSE,info:ee.INFO,warn:ee.WARN,error:ee.ERROR,silent:ee.SILENT},FE=ee.INFO,UE={[ee.DEBUG]:"log",[ee.VERBOSE]:"log",[ee.INFO]:"info",[ee.WARN]:"warn",[ee.ERROR]:"error"},BE=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=UE[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},er=class{constructor(e){this.name=e,this._logLevel=FE,this._logHandler=BE,this._userLogHandler=null,VE.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ee))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?ME[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ee.DEBUG,...e),this._logHandler(this,ee.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ee.VERBOSE,...e),this._logHandler(this,ee.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ee.INFO,...e),this._logHandler(this,ee.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ee.WARN,...e),this._logHandler(this,ee.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ee.ERROR,...e),this._logHandler(this,ee.ERROR,...e)}};var cc=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if($E(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function $E(n){return n.getComponent()?.type==="VERSION"}var uc="@firebase/app",Xf="0.14.0";var vt=new er("@firebase/app"),jE="@firebase/app-compat",WE="@firebase/analytics-compat",zE="@firebase/analytics",HE="@firebase/app-check-compat",GE="@firebase/app-check",KE="@firebase/auth",QE="@firebase/auth-compat",JE="@firebase/database",YE="@firebase/data-connect",XE="@firebase/database-compat",ZE="@firebase/functions",ev="@firebase/functions-compat",tv="@firebase/installations",nv="@firebase/installations-compat",rv="@firebase/messaging",iv="@firebase/messaging-compat",sv="@firebase/performance",ov="@firebase/performance-compat",av="@firebase/remote-config",cv="@firebase/remote-config-compat",uv="@firebase/storage",lv="@firebase/storage-compat",hv="@firebase/firestore",dv="@firebase/ai",fv="@firebase/firestore-compat",pv="firebase",mv="12.0.0";var gv={[uc]:"fire-core",[jE]:"fire-core-compat",[zE]:"fire-analytics",[WE]:"fire-analytics-compat",[GE]:"fire-app-check",[HE]:"fire-app-check-compat",[KE]:"fire-auth",[QE]:"fire-auth-compat",[JE]:"fire-rtdb",[YE]:"fire-data-connect",[XE]:"fire-rtdb-compat",[ZE]:"fire-fn",[ev]:"fire-fn-compat",[tv]:"fire-iid",[nv]:"fire-iid-compat",[rv]:"fire-fcm",[iv]:"fire-fcm-compat",[sv]:"fire-perf",[ov]:"fire-perf-compat",[av]:"fire-rc",[cv]:"fire-rc-compat",[uv]:"fire-gcs",[lv]:"fire-gcs-compat",[hv]:"fire-fst",[fv]:"fire-fst-compat",[dv]:"fire-vertex","fire-js":"fire-js",[pv]:"fire-js-all"};var _v=new Map,yv=new Map,Zf=new Map;function ep(n,e){try{n.container.addComponent(e)}catch(t){vt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function nr(n){let e=n.name;if(Zf.has(e))return vt.debug(`There were multiple attempts to register component ${e}.`),!1;Zf.set(e,n);for(let t of _v.values())ep(t,n);for(let t of yv.values())ep(t,n);return!0}function gn(n){return n==null?!1:n.settings!==void 0}var Iv={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},dc=new It("app","Firebase",Iv);var vs=mv;function tr(n,e,t){let r=gv[n]??n;t&&(r+=`-${t}`);let i=r.match(/\s|\//),s=e.match(/\s|\//);if(i||s){let a=[`Unable to register library "${r}" with version "${e}":`];i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&a.push("and"),s&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),vt.warn(a.join(" "));return}nr(new Et(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}var Ev="firebase-heartbeat-database",vv=1,si="firebase-heartbeat-store",ac=null;function ip(){return ac||(ac=gs(Ev,vv,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(si)}catch(t){console.warn(t)}}}}).catch(n=>{throw dc.create("idb-open",{originalErrorMessage:n.message})})),ac}function wv(n){return p(this,null,function*(){try{let t=(yield ip()).transaction(si),r=yield t.objectStore(si).get(sp(n));return yield t.done,r}catch(e){if(e instanceof rt)vt.warn(e.message);else{let t=dc.create("idb-get",{originalErrorMessage:e?.message});vt.warn(t.message)}}})}function tp(n,e){return p(this,null,function*(){try{let r=(yield ip()).transaction(si,"readwrite");yield r.objectStore(si).put(e,sp(n)),yield r.done}catch(t){if(t instanceof rt)vt.warn(t.message);else{let r=dc.create("idb-set",{originalErrorMessage:t?.message});vt.warn(r.message)}}})}function sp(n){return`${n.name}!${n.options.appId}`}var Tv=1024,Av=30,lc=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new hc(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return p(this,null,function*(){try{let t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=np();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>Av){let i=Sv(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){vt.warn(e)}})}getHeartbeatsHeader(){return p(this,null,function*(){try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=np(),{heartbeatsToSend:t,unsentEntries:r}=bv(this._heartbeatsCache.heartbeats),i=ic(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return vt.warn(e),""}})}};function np(){return new Date().toISOString().substring(0,10)}function bv(n,e=Tv){let t=[],r=n.slice();for(let i of n){let s=t.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),rp(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),rp(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var hc=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return p(this,null,function*(){return Qf()?Jf().then(()=>!0).catch(()=>!1):!1})}read(){return p(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield wv(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return p(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return tp(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return p(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return tp(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return})}};function rp(n){return ic(JSON.stringify({version:2,heartbeats:n})).length}function Sv(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Rv(n){nr(new Et("platform-logger",e=>new cc(e),"PRIVATE")),nr(new Et("heartbeat",e=>new lc(e),"PRIVATE")),tr(uc,Xf,n),tr(uc,Xf,"esm2020"),tr("fire-js","")}Rv("");function fp(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var pp=fp,mp=new It("auth","Firebase",fp());var bs=new er("@firebase/auth");function Pv(n,...e){bs.logLevel<=ee.WARN&&bs.warn(`Auth (${vs}): ${n}`,...e)}function Ts(n,...e){bs.logLevel<=ee.ERROR&&bs.error(`Auth (${vs}): ${n}`,...e)}function op(n,...e){throw Ac(n,...e)}function Tc(n,...e){return Ac(n,...e)}function gp(n,e,t){let r=Ut(ye({},pp()),{[e]:t});return new It("auth","Firebase",r).create(e,{appName:n.name})}function As(n){return gp(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ac(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return mp.create(n,...e)}function Q(n,e,...t){if(!n)throw Ac(e,...t)}function oi(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Ts(e),new Error(e)}function Ss(n,e){n||oi(e)}function Cv(){return ap()==="http:"||ap()==="https:"}function ap(){return typeof self<"u"&&self.location?.protocol||null}function kv(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Cv()||Gf()||"connection"in navigator)?navigator.onLine:!0}function Dv(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var In=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ss(t>e,"Short delay should be less than long delay!"),this.isMobile=zf()||Kf()}get(){return kv()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Nv(n,e){Ss(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var Rs=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;oi("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;oi("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;oi("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var Ov={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var Lv=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],xv=new In(3e4,6e4);function _p(n,e){return n.tenantId&&!e.tenantId?Ut(ye({},e),{tenantId:n.tenantId}):e}function Ns(s,a,c,l){return p(this,arguments,function*(n,e,t,r,i={}){return yp(n,i,()=>p(null,null,function*(){let d={},m={};r&&(e==="GET"?m=r:d={body:JSON.stringify(r)});let I=oc(ye({key:n.config.apiKey},m)).slice(1),E=yield n._getAdditionalHeaders();E["Content-Type"]="application/json",n.languageCode&&(E["X-Firebase-Locale"]=n.languageCode);let S=ye({method:e,headers:E},d);return Hf()||(S.referrerPolicy="no-referrer"),n.emulatorConfig&&sc(n.emulatorConfig.host)&&(S.credentials="include"),Rs.fetch()(yield Ip(n,n.config.apiHost,t,I),S)}))})}function yp(n,e,t){return p(this,null,function*(){n._canInitEmulator=!1;let r=ye(ye({},Ov),e);try{let i=new mc(n),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let a=yield s.json();if("needConfirmation"in a)throw ws(n,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{let c=s.ok?a.errorMessage:a.error.message,[l,d]=c.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw ws(n,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw ws(n,"email-already-in-use",a);if(l==="USER_DISABLED")throw ws(n,"user-disabled",a);let m=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw gp(n,m,d);op(n,m)}}catch(i){if(i instanceof rt)throw i;op(n,"network-request-failed",{message:String(i)})}})}function Ip(n,e,t,r){return p(this,null,function*(){let i=`${e}${t}?${r}`,s=n,a=s.config.emulator?Nv(n.config,i):`${n.config.apiScheme}://${i}`;return Lv.includes(t)&&(yield s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(a).toString():a})}var mc=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Tc(this.auth,"network-request-failed")),xv.get())})}};function ws(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=Tc(n,e,r);return i.customData._tokenResponse=t,i}function Vv(n,e){return p(this,null,function*(){return Ns(n,"POST","/v1/accounts:delete",e)})}function Ps(n,e){return p(this,null,function*(){return Ns(n,"POST","/v1/accounts:lookup",e)})}function ai(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Ep(n,e=!1){return p(this,null,function*(){let t=Zn(n),r=yield t.getIdToken(e),i=vp(r);Q(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,a=s?.sign_in_provider;return{claims:i,token:r,authTime:ai(fc(i.auth_time)),issuedAtTime:ai(fc(i.iat)),expirationTime:ai(fc(i.exp)),signInProvider:a||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function fc(n){return Number(n)*1e3}function vp(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Ts("JWT malformed, contained fewer than 3 sections"),null;try{let i=Es(t);return i?JSON.parse(i):(Ts("Failed to decode base64 JWT payload"),null)}catch(i){return Ts("Caught error parsing JWT payload as JSON",i?.toString()),null}}function cp(n){let e=vp(n);return Q(e,"internal-error"),Q(typeof e.exp<"u","internal-error"),Q(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function gc(n,e,t=!1){return p(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof rt&&Mv(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function Mv({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var _c=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){let t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;let r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>p(this,null,function*(){yield this.iteration()}),t)}iteration(){return p(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var ui=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ai(this.lastLoginAt),this.creationTime=ai(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function Cs(n){return p(this,null,function*(){let e=n.auth,t=yield n.getIdToken(),r=yield gc(n,Ps(e,{idToken:t}));Q(r?.users.length,e,"internal-error");let i=r.users[0];n._notifyReloadListener(i);let s=i.providerUserInfo?.length?Tp(i.providerUserInfo):[],a=Fv(n.providerData,s),c=n.isAnonymous,l=!(n.email&&i.passwordHash)&&!a?.length,d=c?l:!1,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new ui(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,m)})}function wp(n){return p(this,null,function*(){let e=Zn(n);yield Cs(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function Fv(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function Tp(n){return n.map(r=>{var i=r,{providerId:e}=i,t=va(i,["providerId"]);return{providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}})}function Uv(n,e){return p(this,null,function*(){let t=yield yp(n,{},()=>p(null,null,function*(){let r=oc({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,a=yield Ip(n,i,"/v1/token",`key=${s}`),c=yield n._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";let l={method:"POST",headers:c,body:r};return n.emulatorConfig&&sc(n.emulatorConfig.host)&&(l.credentials="include"),Rs.fetch()(a,l)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function Bv(n,e){return p(this,null,function*(){return Ns(n,"POST","/v2/accounts:revokeToken",_p(n,e))})}var ci=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Q(e.idToken,"internal-error"),Q(typeof e.idToken<"u","internal-error"),Q(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):cp(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Q(e.length!==0,"internal-error");let t=cp(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return p(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Q(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return p(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:s}=yield Uv(e,t);this.updateTokensAndExpiration(r,i,Number(s))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:s}=t,a=new n;return r&&(Q(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(Q(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),s&&(Q(typeof s=="number","internal-error",{appName:e}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return oi("not implemented")}};function Gt(n,e){Q(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var _n=class n{constructor(s){var a=s,{uid:e,auth:t,stsTokenManager:r}=a,i=va(a,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new _c(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new ui(i.createdAt||void 0,i.lastLoginAt||void 0)}getIdToken(e){return p(this,null,function*(){let t=yield gc(this,this.stsTokenManager.getToken(this.auth,e));return Q(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return Ep(this,e)}reload(){return wp(this)}_assign(e){this!==e&&(Q(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>ye({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Ut(ye({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Q(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return p(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield Cs(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return p(this,null,function*(){if(gn(this.auth.app))return Promise.reject(As(this.auth));let e=yield this.getIdToken();return yield gc(this,Vv(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Ut(ye({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>ye({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let r=t.displayName??void 0,i=t.email??void 0,s=t.phoneNumber??void 0,a=t.photoURL??void 0,c=t.tenantId??void 0,l=t._redirectEventId??void 0,d=t.createdAt??void 0,m=t.lastLoginAt??void 0,{uid:I,emailVerified:E,isAnonymous:S,providerData:k,stsTokenManager:L}=t;Q(I&&L,e,"internal-error");let D=ci.fromJSON(this.name,L);Q(typeof I=="string",e,"internal-error"),Gt(r,e.name),Gt(i,e.name),Q(typeof E=="boolean",e,"internal-error"),Q(typeof S=="boolean",e,"internal-error"),Gt(s,e.name),Gt(a,e.name),Gt(c,e.name),Gt(l,e.name),Gt(d,e.name),Gt(m,e.name);let $=new n({uid:I,auth:e,email:i,emailVerified:E,displayName:r,isAnonymous:S,photoURL:a,phoneNumber:s,tenantId:c,stsTokenManager:D,createdAt:d,lastLoginAt:m});return k&&Array.isArray(k)&&($.providerData=k.map(U=>ye({},U))),l&&($._redirectEventId=l),$}static _fromIdTokenResponse(e,t,r=!1){return p(this,null,function*(){let i=new ci;i.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield Cs(s),s})}static _fromGetAccountInfoResponse(e,t,r){return p(this,null,function*(){let i=t.users[0];Q(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?Tp(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!s?.length,c=new ci;c.updateFromIdToken(r);let l=new n({uid:i.localId,auth:e,stsTokenManager:c,isAnonymous:a}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new ui(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(l,d),l})}};var up=new Map;function yn(n){Ss(n instanceof Function,"Expected a class definition");let e=up.get(n);return e?(Ss(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,up.set(n,e),e)}var qv=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return p(this,null,function*(){return!0})}_set(t,r){return p(this,null,function*(){this.storage[t]=r})}_get(t){return p(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return p(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),yc=qv;function pc(n,e,t){return`firebase:${n}:${e}:${t}`}var ks=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=pc(this.userKey,i.apiKey,s),this.fullPersistenceKey=pc("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return p(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield Ps(this.auth,{idToken:e}).catch(()=>{});return t?_n._fromGetAccountInfoResponse(this.auth,t,e):null}return _n._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return p(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return p(this,null,function*(){if(!t.length)return new n(yn(yc),e,r);let i=(yield Promise.all(t.map(d=>p(null,null,function*(){if(yield d._isAvailable())return d})))).filter(d=>d),s=i[0]||yn(yc),a=pc(r,e.config.apiKey,e.name),c=null;for(let d of t)try{let m=yield d._get(a);if(m){let I;if(typeof m=="string"){let E=yield Ps(e,{idToken:m}).catch(()=>{});if(!E)break;I=yield _n._fromGetAccountInfoResponse(e,E,m)}else I=_n._fromJSON(e,m);d!==s&&(c=I),s=d;break}}catch{}let l=i.filter(d=>d._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new n(s,e,r):(s=l[0],c&&(yield s._set(a,c.toJSON())),yield Promise.all(t.map(d=>p(null,null,function*(){if(d!==s)try{yield d._remove(a)}catch{}}))),new n(s,e,r))})}};function lp(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(zv(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if($v(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Gv(e))return"Blackberry";if(Kv(e))return"Webos";if(jv(e))return"Safari";if((e.includes("chrome/")||Wv(e))&&!e.includes("edge/"))return"Chrome";if(Hv(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function $v(n=Ke()){return/firefox\//i.test(n)}function jv(n=Ke()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Wv(n=Ke()){return/crios\//i.test(n)}function zv(n=Ke()){return/iemobile/i.test(n)}function Hv(n=Ke()){return/android/i.test(n)}function Gv(n=Ke()){return/blackberry/i.test(n)}function Kv(n=Ke()){return/webos/i.test(n)}function Ap(n,e=[]){let t;switch(n){case"Browser":t=lp(Ke());break;case"Worker":t=`${lp(Ke())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${vs}/${r}`}var Ic=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=s=>new Promise((a,c)=>{try{let l=e(s);a(l)}catch(l){c(l)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return p(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function Qv(t){return p(this,arguments,function*(n,e={}){return Ns(n,"GET","/v2/passwordPolicy",_p(n,e))})}var Jv=6,Ec=class{constructor(e){let t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Jv,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var vc=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ds(this),this.idTokenSubscription=new Ds(this),this.beforeStateQueue=new Ic(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=mp,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=yn(t)),this._initializationPromise=this.queue(()=>p(this,null,function*(){if(!this._deleted&&(this.persistenceManager=yield ks.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return p(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return p(this,null,function*(){try{let t=yield Ps(this,{idToken:e}),r=yield _n._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return p(this,null,function*(){if(gn(this.app)){let s=this.app.settings.authIdToken;return s?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(a,a))}):this.directlySetCurrentUser(null)}let t=yield this.assertedPersistence.getCurrentUser(),r=t,i=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let s=this.redirectUser?._redirectEventId,a=r?._redirectEventId,c=yield this.tryRedirectSignIn(e);(!s||s===a)&&c?.user&&(r=c.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{yield this.beforeStateQueue.runMiddleware(r)}catch(s){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Q(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)})}tryRedirectSignIn(e){return p(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return p(this,null,function*(){try{yield Cs(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=Dv()}_delete(){return p(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return p(this,null,function*(){if(gn(this.app))return Promise.reject(As(this));let t=e?Zn(e):null;return t&&Q(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return p(this,null,function*(){if(!this._deleted)return e&&Q(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>p(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return p(this,null,function*(){return gn(this.app)?Promise.reject(As(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return gn(this.app)?Promise.reject(As(this)):this.queue(()=>p(this,null,function*(){yield this.assertedPersistence.setPersistence(yn(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return p(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return p(this,null,function*(){let e=yield Qv(this),t=new Ec(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new It("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return p(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield Bv(this,r)}})}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}_setRedirectUser(e,t){return p(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return p(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&yn(e)||this._popupRedirectResolver;Q(t,this,"argument-error"),this.redirectPersistenceManager=yield ks.create(this,[yn(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return p(this,null,function*(){return this._isInitialized&&(yield this.queue(()=>p(this,null,function*(){}))),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null})}_persistUserIfCurrent(e){return p(this,null,function*(){if(e===this.currentUser)return this.queue(()=>p(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),a=!1,c=this._isInitialized?Promise.resolve():this._initializationPromise;if(Q(c,this,"internal-error"),c.then(()=>{a||s(this.currentUser)}),typeof t=="function"){let l=e.addObserver(t,r,i);return()=>{a=!0,l()}}else{let l=e.addObserver(t);return()=>{a=!0,l()}}}directlySetCurrentUser(e){return p(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Q(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ap(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return p(this,null,function*(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=yield this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let r=yield this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e})}_getAppCheckToken(){return p(this,null,function*(){if(gn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=yield this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&Pv(`Error while retrieving App Check token: ${e.error}`),e?.token})}};function Yv(n){return Zn(n)}var Ds=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=Yf(t=>this.observer=t)}get next(){return Q(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var Xv={loadJS(){return p(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Zv(n){Xv=n}function ew(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function tw(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(yn);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function bc(n,e,t,r){return Zn(n).onAuthStateChanged(e,t,r)}var aC=ew("rcb"),cC=new In(3e4,6e4);var uC=new In(2e3,1e4);var lC=10*60*1e3;var hC=new In(3e4,6e4);var dC=new In(5e3,15e3);var fC=encodeURIComponent("fac");var hp="@firebase/auth",dp="1.11.0";var wc=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}getToken(e){return p(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Q(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function nw(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function rw(n){nr(new Et("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:c}=r.options;Q(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let l={apiKey:a,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ap(n)},d=new vc(r,i,s,l);return tw(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),nr(new Et("auth-internal",e=>{let t=Yv(e.getProvider("auth").getImmediate());return(r=>new wc(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),tr(hp,dp,nw(n)),tr(hp,dp,"esm2020")}var iw=5*60,pC=Wf("authIdTokenMaxAge")||iw;function sw(){return document.getElementsByTagName("head")?.[0]??document}Zv({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let s=Tc("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",sw().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});rw("Browser");function bp(n){return new ln(function(e){var t=bc(n,e.next.bind(e),e.error.bind(e),e.complete.bind(e));return{unsubscribe:t}})}function qp(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var $p=qp,jp=new ze("auth","Firebase",qp());var Fs=new tt("@firebase/auth");function cw(n,...e){Fs.logLevel<=z.WARN&&Fs.warn(`Auth (${jt}): ${n}`,...e)}function Ls(n,...e){Fs.logLevel<=z.ERROR&&Fs.error(`Auth (${jt}): ${n}`,...e)}function Be(n,...e){throw Gc(n,...e)}function Qe(n,...e){return Gc(n,...e)}function Hc(n,e,t){let r=Object.assign(Object.assign({},$p()),{[e]:t});return new ze("auth","Firebase",r).create(e,{appName:n.name})}function At(n){return Hc(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function uw(n,e,t){let r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Be(n,"argument-error"),Hc(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Gc(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return jp.create(n,...e)}function V(n,e,...t){if(!n)throw Gc(e,...t)}function wt(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Ls(e),new Error(e)}function bt(n,e){n||wt(e)}function Pc(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function lw(){return Sp()==="http:"||Sp()==="https:"}function Sp(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function hw(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(lw()||cf()||"connection"in navigator)?navigator.onLine:!0}function dw(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var En=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,bt(t>e,"Short delay should be less than long delay!"),this.isMobile=of()||uf()}get(){return hw()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Kc(n,e){bt(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var Us=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;wt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;wt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;wt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var fw={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var pw=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],mw=new En(3e4,6e4);function St(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function Je(s,a,c,l){return p(this,arguments,function*(n,e,t,r,i={}){return Wp(n,i,()=>p(null,null,function*(){let d={},m={};r&&(e==="GET"?m=r:d={body:JSON.stringify(r)});let I=Hn(Object.assign({key:n.config.apiKey},m)).slice(1),E=yield n._getAdditionalHeaders();E["Content-Type"]="application/json",n.languageCode&&(E["X-Firebase-Locale"]=n.languageCode);let S=Object.assign({method:e,headers:E},d);return af()||(S.referrerPolicy="no-referrer"),n.emulatorConfig&&qt(n.emulatorConfig.host)&&(S.credentials="include"),Us.fetch()(yield zp(n,n.config.apiHost,t,I),S)}))})}function Wp(n,e,t){return p(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},fw),e);try{let i=new Cc(n),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let a=yield s.json();if("needConfirmation"in a)throw Os(n,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{let c=s.ok?a.errorMessage:a.error.message,[l,d]=c.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Os(n,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw Os(n,"email-already-in-use",a);if(l==="USER_DISABLED")throw Os(n,"user-disabled",a);let m=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Hc(n,m,d);Be(n,m)}}catch(i){if(i instanceof xe)throw i;Be(n,"network-request-failed",{message:String(i)})}})}function Ii(s,a,c,l){return p(this,arguments,function*(n,e,t,r,i={}){let d=yield Je(n,e,t,r,i);return"mfaPendingCredential"in d&&Be(n,"multi-factor-auth-required",{_serverResponse:d}),d})}function zp(n,e,t,r){return p(this,null,function*(){let i=`${e}${t}?${r}`,s=n,a=s.config.emulator?Kc(n.config,i):`${n.config.apiScheme}://${i}`;return pw.includes(t)&&(yield s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(a).toString():a})}function gw(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var Cc=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Qe(this.auth,"network-request-failed")),mw.get())})}};function Os(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=Qe(n,e,r);return i.customData._tokenResponse=t,i}function Rp(n){return n!==void 0&&n.enterprise!==void 0}var kc=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return gw(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}};function _w(n,e){return p(this,null,function*(){return Je(n,"GET","/v2/recaptchaConfig",St(n,e))})}function yw(n,e){return p(this,null,function*(){return Je(n,"POST","/v1/accounts:delete",e)})}function Bs(n,e){return p(this,null,function*(){return Je(n,"POST","/v1/accounts:lookup",e)})}function hi(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Qc(n,e=!1){return p(this,null,function*(){let t=ie(n),r=yield t.getIdToken(e),i=Jc(r);V(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,a=s?.sign_in_provider;return{claims:i,token:r,authTime:hi(Sc(i.auth_time)),issuedAtTime:hi(Sc(i.iat)),expirationTime:hi(Sc(i.exp)),signInProvider:a||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function Sc(n){return Number(n)*1e3}function Jc(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Ls("JWT malformed, contained fewer than 3 sections"),null;try{let i=ls(t);return i?JSON.parse(i):(Ls("Failed to decode base64 JWT payload"),null)}catch(i){return Ls("Caught error parsing JWT payload as JSON",i?.toString()),null}}function Pp(n){let e=Jc(n);return V(e,"internal-error"),V(typeof e.exp<"u","internal-error"),V(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function vn(n,e,t=!1){return p(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof xe&&Iw(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function Iw({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var Dc=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>p(this,null,function*(){yield this.iteration()}),t)}iteration(){return p(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var fi=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=hi(this.lastLoginAt),this.creationTime=hi(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function qs(n){return p(this,null,function*(){var e;let t=n.auth,r=yield n.getIdToken(),i=yield vn(n,Bs(t,{idToken:r}));V(i?.users.length,t,"internal-error");let s=i.users[0];n._notifyReloadListener(s);let a=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?Hp(s.providerUserInfo):[],c=Ew(n.providerData,a),l=n.isAnonymous,d=!(n.email&&s.passwordHash)&&!c?.length,m=l?d:!1,I={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new fi(s.createdAt,s.lastLoginAt),isAnonymous:m};Object.assign(n,I)})}function Yc(n){return p(this,null,function*(){let e=ie(n);yield qs(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function Ew(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function Hp(n){return n.map(e=>{var{providerId:t}=e,r=ss(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function vw(n,e){return p(this,null,function*(){let t=yield Wp(n,{},()=>p(null,null,function*(){let r=Hn({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,a=yield zp(n,i,"/v1/token",`key=${s}`),c=yield n._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";let l={method:"POST",headers:c,body:r};return n.emulatorConfig&&qt(n.emulatorConfig.host)&&(l.credentials="include"),Us.fetch()(a,l)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function ww(n,e){return p(this,null,function*(){return Je(n,"POST","/v2/accounts:revokeToken",St(n,e))})}var di=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){V(e.idToken,"internal-error"),V(typeof e.idToken<"u","internal-error"),V(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Pp(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){V(e.length!==0,"internal-error");let t=Pp(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return p(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(V(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return p(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:s}=yield vw(e,t);this.updateTokensAndExpiration(r,i,Number(s))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:s}=t,a=new n;return r&&(V(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(V(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),s&&(V(typeof s=="number","internal-error",{appName:e}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return wt("not implemented")}};function Kt(n,e){V(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var Qt=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=ss(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Dc(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new fi(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return p(this,null,function*(){let t=yield vn(this,this.stsTokenManager.getToken(this.auth,e));return V(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return Qc(this,e)}reload(){return Yc(this)}_assign(e){this!==e&&(V(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){V(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return p(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield qs(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return p(this,null,function*(){if(Oe(this.auth.app))return Promise.reject(At(this.auth));let e=yield this.getIdToken();return yield vn(this,yw(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,a,c,l,d,m;let I=(r=t.displayName)!==null&&r!==void 0?r:void 0,E=(i=t.email)!==null&&i!==void 0?i:void 0,S=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,k=(a=t.photoURL)!==null&&a!==void 0?a:void 0,L=(c=t.tenantId)!==null&&c!==void 0?c:void 0,D=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,$=(d=t.createdAt)!==null&&d!==void 0?d:void 0,U=(m=t.lastLoginAt)!==null&&m!==void 0?m:void 0,{uid:j,emailVerified:X,isAnonymous:Pe,providerData:Y,stsTokenManager:w}=t;V(j&&w,e,"internal-error");let g=di.fromJSON(this.name,w);V(typeof j=="string",e,"internal-error"),Kt(I,e.name),Kt(E,e.name),V(typeof X=="boolean",e,"internal-error"),V(typeof Pe=="boolean",e,"internal-error"),Kt(S,e.name),Kt(k,e.name),Kt(L,e.name),Kt(D,e.name),Kt($,e.name),Kt(U,e.name);let y=new n({uid:j,auth:e,email:E,emailVerified:X,displayName:I,isAnonymous:Pe,photoURL:k,phoneNumber:S,tenantId:L,stsTokenManager:g,createdAt:$,lastLoginAt:U});return Y&&Array.isArray(Y)&&(y.providerData=Y.map(v=>Object.assign({},v))),D&&(y._redirectEventId=D),y}static _fromIdTokenResponse(e,t,r=!1){return p(this,null,function*(){let i=new di;i.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield qs(s),s})}static _fromGetAccountInfoResponse(e,t,r){return p(this,null,function*(){let i=t.users[0];V(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?Hp(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!s?.length,c=new di;c.updateFromIdToken(r);let l=new n({uid:i.localId,auth:e,stsTokenManager:c,isAnonymous:a}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new fi(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(l,d),l})}};var Cp=new Map;function Tt(n){bt(n instanceof Function,"Expected a class definition");let e=Cp.get(n);return e?(bt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Cp.set(n,e),e)}var Tw=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return p(this,null,function*(){return!0})}_set(t,r){return p(this,null,function*(){this.storage[t]=r})}_get(t){return p(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return p(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),Nc=Tw;function xs(n,e,t){return`firebase:${n}:${e}:${t}`}var $s=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=xs(this.userKey,i.apiKey,s),this.fullPersistenceKey=xs("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return p(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield Bs(this.auth,{idToken:e}).catch(()=>{});return t?Qt._fromGetAccountInfoResponse(this.auth,t,e):null}return Qt._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return p(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return p(this,null,function*(){if(!t.length)return new n(Tt(Nc),e,r);let i=(yield Promise.all(t.map(d=>p(null,null,function*(){if(yield d._isAvailable())return d})))).filter(d=>d),s=i[0]||Tt(Nc),a=xs(r,e.config.apiKey,e.name),c=null;for(let d of t)try{let m=yield d._get(a);if(m){let I;if(typeof m=="string"){let E=yield Bs(e,{idToken:m}).catch(()=>{});if(!E)break;I=yield Qt._fromGetAccountInfoResponse(e,E,m)}else I=Qt._fromJSON(e,m);d!==s&&(c=I),s=d;break}}catch{}let l=i.filter(d=>d._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new n(s,e,r):(s=l[0],c&&(yield s._set(a,c.toJSON())),yield Promise.all(t.map(d=>p(null,null,function*(){if(d!==s)try{yield d._remove(a)}catch{}}))),new n(s,e,r))})}};function kp(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Jp(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Gp(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Xp(e))return"Blackberry";if(Zp(e))return"Webos";if(Kp(e))return"Safari";if((e.includes("chrome/")||Qp(e))&&!e.includes("edge/"))return"Chrome";if(Yp(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Gp(n=pe()){return/firefox\//i.test(n)}function Kp(n=pe()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Qp(n=pe()){return/crios\//i.test(n)}function Jp(n=pe()){return/iemobile/i.test(n)}function Yp(n=pe()){return/android/i.test(n)}function Xp(n=pe()){return/blackberry/i.test(n)}function Zp(n=pe()){return/webos/i.test(n)}function Xc(n=pe()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Aw(n=pe()){var e;return Xc(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function bw(){return lf()&&document.documentMode===10}function em(n=pe()){return Xc(n)||Yp(n)||Zp(n)||Xp(n)||/windows phone/i.test(n)||Jp(n)}function tm(n,e=[]){let t;switch(n){case"Browser":t=kp(pe());break;case"Worker":t=`${kp(pe())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${jt}/${r}`}var Oc=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=s=>new Promise((a,c)=>{try{let l=e(s);a(l)}catch(l){c(l)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return p(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function Sw(t){return p(this,arguments,function*(n,e={}){return Je(n,"GET","/v2/passwordPolicy",St(n,e))})}var Rw=6,Lc=class{constructor(e){var t,r,i,s;let a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:Rw,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,a,c;let l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(i=l.containsLowercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(s=l.containsUppercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(a=l.containsNumericCharacter)!==null&&a!==void 0?a:!0),l.isValid&&(l.isValid=(c=l.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),l}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var xc=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new js(this),this.idTokenSubscription=new js(this),this.beforeStateQueue=new Oc(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=jp,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Tt(t)),this._initializationPromise=this.queue(()=>p(this,null,function*(){var r,i,s;if(!this._deleted&&(this.persistenceManager=yield $s.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return p(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return p(this,null,function*(){try{let t=yield Bs(this,{idToken:e}),r=yield Qt._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return p(this,null,function*(){var t;if(Oe(this.app)){let a=this.app.settings.authIdToken;return a?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(c,c))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=i?._redirectEventId,l=yield this.tryRedirectSignIn(e);(!a||a===c)&&l?.user&&(i=l.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(i)}catch(a){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return V(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return p(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return p(this,null,function*(){try{yield qs(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=dw()}_delete(){return p(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return p(this,null,function*(){if(Oe(this.app))return Promise.reject(At(this));let t=e?ie(e):null;return t&&V(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return p(this,null,function*(){if(!this._deleted)return e&&V(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>p(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return p(this,null,function*(){return Oe(this.app)?Promise.reject(At(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Oe(this.app)?Promise.reject(At(this)):this.queue(()=>p(this,null,function*(){yield this.assertedPersistence.setPersistence(Tt(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return p(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return p(this,null,function*(){let e=yield Sw(this),t=new Lc(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ze("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return p(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield ww(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return p(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return p(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&Tt(e)||this._popupRedirectResolver;V(t,this,"argument-error"),this.redirectPersistenceManager=yield $s.create(this,[Tt(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return p(this,null,function*(){var t,r;return this._isInitialized&&(yield this.queue(()=>p(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return p(this,null,function*(){if(e===this.currentUser)return this.queue(()=>p(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),a=!1,c=this._isInitialized?Promise.resolve():this._initializationPromise;if(V(c,this,"internal-error"),c.then(()=>{a||s(this.currentUser)}),typeof t=="function"){let l=e.addObserver(t,r,i);return()=>{a=!0,l()}}else{let l=e.addObserver(t);return()=>{a=!0,l()}}}directlySetCurrentUser(e){return p(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return V(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=tm(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return p(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(t["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return p(this,null,function*(){var e;if(Oe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&cw(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function Rt(n){return ie(n)}var js=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=pf(t=>this.observer=t)}get next(){return V(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var Ys={loadJS(){return p(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Pw(n){Ys=n}function nm(n){return Ys.loadJS(n)}function Cw(){return Ys.recaptchaEnterpriseScript}function kw(){return Ys.gapiScript}function rm(n){return`__${n}${Math.floor(Math.random()*1e6)}`}var Vc=class{constructor(){this.enterprise=new Mc}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},Mc=class{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}};var Dw="recaptcha-enterprise",im="NO_RECAPTCHA",Fc=class{constructor(e){this.type=Dw,this.auth=Rt(e)}verify(e="verify",t=!1){return p(this,null,function*(){function r(s){return p(this,null,function*(){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise((a,c)=>p(null,null,function*(){_w(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{let d=new kc(l);return s.tenantId==null?s._agentRecaptchaConfig=d:s._tenantRecaptchaConfigs[s.tenantId]=d,a(d.siteKey)}}).catch(l=>{c(l)})}))})}function i(s,a,c){let l=window.grecaptcha;Rp(l)?l.enterprise.ready(()=>{l.enterprise.execute(s,{action:e}).then(d=>{a(d)}).catch(()=>{a(im)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Vc().execute("siteKey",{action:"verify"}):new Promise((s,a)=>{r(this.auth).then(c=>{if(!t&&Rp(window.grecaptcha))i(c,s,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let l=Cw();l.length!==0&&(l+=c),nm(l).then(()=>{i(c,s,a)}).catch(d=>{a(d)})}}).catch(c=>{a(c)})})})}};function li(n,e,t,r=!1,i=!1){return p(this,null,function*(){let s=new Fc(n),a;if(i)a=im;else try{a=yield s.verify(t)}catch{a=yield s.verify(t,!0)}let c=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){let l=c.phoneEnrollmentInfo.phoneNumber,d=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){let l=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return r?Object.assign(c,{captchaResp:a}):Object.assign(c,{captchaResponse:a}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c})}function Ws(n,e,t,r,i){return p(this,null,function*(){var s,a;if(i==="EMAIL_PASSWORD_PROVIDER")if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let c=yield li(n,e,t,t==="getOobCode");return r(n,c)}else return r(n,e).catch(c=>p(null,null,function*(){if(c.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let l=yield li(n,e,t,t==="getOobCode");return r(n,l)}else return Promise.reject(c)}));else if(i==="PHONE_PROVIDER")if(!((a=n._getRecaptchaConfig())===null||a===void 0)&&a.isProviderEnabled("PHONE_PROVIDER")){let c=yield li(n,e,t);return r(n,c).catch(l=>p(null,null,function*(){var d;if(((d=n._getRecaptchaConfig())===null||d===void 0?void 0:d.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(l.code==="auth/missing-recaptcha-token"||l.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);let m=yield li(n,e,t,!1,!0);return r(n,m)}return Promise.reject(l)}))}else{let c=yield li(n,e,t,!1,!0);return r(n,c)}else return Promise.reject(i+" provider is not supported.")})}function Zc(n,e){let t=Qn(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),s=t.getOptions();if(et(s,e??{}))return i;Be(i,"already-initialized")}return t.initialize({options:e})}function Nw(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(Tt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function eu(n,e,t){let r=Rt(n);V(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,s=sm(e),{host:a,port:c}=Ow(e),l=c===null?"":`:${c}`,d={url:`${s}//${a}${l}/`},m=Object.freeze({host:a,port:c,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){V(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),V(et(d,r.config.emulator)&&et(m,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=m,r.settings.appVerificationDisabledForTesting=!0,qt(a)?(ds(`${s}//${a}${l}`),fs("Auth",!0)):i||Lw()}function sm(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Ow(n){let e=sm(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let s=i[1];return{host:s,port:Dp(r.substr(s.length+1))}}else{let[s,a]=r.split(":");return{host:s,port:Dp(a)}}}function Dp(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function Lw(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var ir=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return wt("not implemented")}_getIdTokenResponse(e){return wt("not implemented")}_linkToIdToken(e,t){return wt("not implemented")}_getReauthenticationResolver(e){return wt("not implemented")}};function xw(n,e){return p(this,null,function*(){return Je(n,"POST","/v1/accounts:update",e)})}function Vw(n,e){return p(this,null,function*(){return Je(n,"POST","/v1/accounts:signUp",e)})}function Mw(n,e){return p(this,null,function*(){return Ii(n,"POST","/v1/accounts:signInWithPassword",St(n,e))})}function om(n,e){return p(this,null,function*(){return Je(n,"POST","/v1/accounts:sendOobCode",St(n,e))})}function Fw(n,e){return p(this,null,function*(){return om(n,e)})}function Uw(n,e){return p(this,null,function*(){return om(n,e)})}function Bw(n,e){return p(this,null,function*(){return Ii(n,"POST","/v1/accounts:signInWithEmailLink",St(n,e))})}function qw(n,e){return p(this,null,function*(){return Ii(n,"POST","/v1/accounts:signInWithEmailLink",St(n,e))})}var pi=class n extends ir{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new n(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new n(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return p(this,null,function*(){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ws(e,t,"signInWithPassword",Mw,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return Bw(e,{email:this._email,oobCode:this._password});default:Be(e,"internal-error")}})}_linkToIdToken(e,t){return p(this,null,function*(){switch(this.signInMethod){case"password":let r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ws(e,r,"signUpPassword",Vw,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return qw(e,{idToken:t,email:this._email,oobCode:this._password});default:Be(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};function rr(n,e){return p(this,null,function*(){return Ii(n,"POST","/v1/accounts:signInWithIdp",St(n,e))})}var $w="http://localhost",mi=class n extends ir{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new n(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Be("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,s=ss(t,["providerId","signInMethod"]);if(!r||!i)return null;let a=new n(r,i);return a.idToken=s.idToken||void 0,a.accessToken=s.accessToken||void 0,a.secret=s.secret,a.nonce=s.nonce,a.pendingToken=s.pendingToken||null,a}_getIdTokenResponse(e){let t=this.buildRequest();return rr(e,t)}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,rr(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,rr(e,t)}buildRequest(){let e={requestUri:$w,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Hn(t)}return e}};function jw(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Ww(n){let e=Gn(Kn(n)).link,t=e?Gn(Kn(e)).deep_link_id:null,r=Gn(Kn(n)).deep_link_id;return(r?Gn(Kn(r)).link:null)||r||t||e||n}var zs=class n{constructor(e){var t,r,i,s,a,c;let l=Gn(Kn(e)),d=(t=l.apiKey)!==null&&t!==void 0?t:null,m=(r=l.oobCode)!==null&&r!==void 0?r:null,I=jw((i=l.mode)!==null&&i!==void 0?i:null);V(d&&m&&I,"argument-error"),this.apiKey=d,this.operation=I,this.code=m,this.continueUrl=(s=l.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(a=l.lang)!==null&&a!==void 0?a:null,this.tenantId=(c=l.tenantId)!==null&&c!==void 0?c:null}static parseLink(e){let t=Ww(e);try{return new n(t)}catch{return null}}};var Xs=(()=>{class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(t,r){return pi._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){let i=zs.parseLink(r);return V(i,"argument-error"),pi._fromEmailAndCode(t,i.code,i.tenantId)}}n.PROVIDER_ID="password",n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return n})(),gi=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var _i=class extends gi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};var tu=(()=>{class n extends _i{constructor(){super("facebook.com")}static credential(t){return mi._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return n.credential(t.oauthAccessToken)}catch{return null}}}n.FACEBOOK_SIGN_IN_METHOD="facebook.com",n.PROVIDER_ID="facebook.com";return n})(),nu=(()=>{class n extends _i{constructor(){super("google.com"),this.addScope("profile")}static credential(t,r){return mi._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:r})}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;let{oauthIdToken:r,oauthAccessToken:i}=t;if(!r&&!i)return null;try{return n.credential(r,i)}catch{return null}}}n.GOOGLE_SIGN_IN_METHOD="google.com",n.PROVIDER_ID="google.com";return n})();function zw(n,e){return p(this,null,function*(){return Ii(n,"POST","/v1/accounts:signUp",St(n,e))})}var sr=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r,i=!1){return p(this,null,function*(){let s=yield Qt._fromIdTokenResponse(e,r,i),a=Np(r);return new n({user:s,providerId:a,_tokenResponse:r,operationType:t})})}static _forOperation(e,t,r){return p(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=Np(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})})}};function Np(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var Uc=class n extends xe{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function am(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Uc._fromErrorAndOperation(n,s,e,r):s})}function Hw(n,e,t=!1){return p(this,null,function*(){let r=yield vn(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return sr._forOperation(n,"link",r)})}function cm(n,e,t=!1){return p(this,null,function*(){let{auth:r}=n;if(Oe(r.app))return Promise.reject(At(r));let i="reauthenticate";try{let s=yield vn(n,am(r,i,e,n),t);V(s.idToken,r,"internal-error");let a=Jc(s.idToken);V(a,r,"internal-error");let{sub:c}=a;return V(n.uid===c,r,"user-mismatch"),sr._forOperation(n,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&Be(r,"user-mismatch"),s}})}function um(n,e,t=!1){return p(this,null,function*(){if(Oe(n.app))return Promise.reject(At(n));let r="signIn",i=yield am(n,r,e),s=yield sr._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(s.user)),s})}function ru(n,e){return p(this,null,function*(){return um(Rt(n),e)})}function iu(n,e){return p(this,null,function*(){return cm(ie(n),e)})}function lm(n,e,t){var r;V(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),V(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),V(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(V(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(V(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}function hm(n){return p(this,null,function*(){let e=Rt(n);e._getPasswordPolicyInternal()&&(yield e._updatePasswordPolicy())})}function su(n,e,t){return p(this,null,function*(){let r=Rt(n),i={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&lm(r,i,t),yield Ws(r,i,"getOobCode",Uw,"EMAIL_PASSWORD_PROVIDER")})}function ou(n,e,t){return p(this,null,function*(){if(Oe(n.app))return Promise.reject(At(n));let r=Rt(n),a=yield Ws(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",zw,"EMAIL_PASSWORD_PROVIDER").catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&hm(n),l}),c=yield sr._fromIdTokenResponse(r,"signIn",a);return yield r._updateCurrentUser(c.user),c})}function au(n,e,t){return Oe(n.app)?Promise.reject(At(n)):ru(ie(n),Xs.credential(e,t)).catch(r=>p(null,null,function*(){throw r.code==="auth/password-does-not-meet-requirements"&&hm(n),r}))}function cu(n,e){return p(this,null,function*(){let t=ie(n),i={requestType:"VERIFY_EMAIL",idToken:yield n.getIdToken()};e&&lm(t.auth,i,e);let{email:s}=yield Fw(t.auth,i);s!==n.email&&(yield n.reload())})}function Gw(n,e){return p(this,null,function*(){return Je(n,"POST","/v1/accounts:update",e)})}function uu(r,i){return p(this,arguments,function*(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;let s=ie(n),c={idToken:yield s.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},l=yield vn(s,Gw(s.auth,c));s.displayName=l.displayName||null,s.photoURL=l.photoUrl||null;let d=s.providerData.find(({providerId:m})=>m==="password");d&&(d.displayName=s.displayName,d.photoURL=s.photoURL),yield s._updateTokensIfNecessary(l)})}function lu(n,e){return Kw(ie(n),null,e)}function Kw(n,e,t){return p(this,null,function*(){let{auth:r}=n,s={idToken:yield n.getIdToken(),returnSecureToken:!0};e&&(s.email=e),t&&(s.password=t);let a=yield vn(n,xw(r,s));yield n._updateTokensIfNecessary(a,!0)})}function hu(n,e,t,r){return ie(n).onIdTokenChanged(e,t,r)}function du(n,e,t){return ie(n).beforeAuthStateChanged(e,t)}function fu(n){return ie(n).signOut()}var Hs="__sak";var Gs=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Hs,"1"),this.storage.removeItem(Hs),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var Qw=1e3,Jw=10,Yw=(()=>{class n extends Gs{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=em(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),s=this.localCache[r];i!==s&&t(r,s,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((c,l,d)=>{this.notifyListeners(c,d)});return}let i=t.key;r?this.detachListener():this.stopPolling();let s=()=>{let c=this.storage.getItem(i);!r&&this.localCache[i]===c||this.notifyListeners(i,c)},a=this.storage.getItem(i);bw()&&a!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,Jw):s()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},Qw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,r){return p(this,null,function*(){yield mt(n.prototype,this,"_set").call(this,t,r),this.localCache[t]=JSON.stringify(r)})}_get(t){return p(this,null,function*(){let r=yield mt(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(r),r})}_remove(t){return p(this,null,function*(){yield mt(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),dm=Yw;var Xw=(()=>{class n extends Gs{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),pu=Xw;function Zw(n){return Promise.all(n.map(e=>p(null,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var eT=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(s=>s.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return p(this,null,function*(){let r=t,{eventId:i,eventType:s,data:a}=r.data,c=this.handlersMap[s];if(!c?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:s});let l=Array.from(c).map(m=>p(this,null,function*(){return m(r.origin,a)})),d=yield Zw(l);r.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:d})})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function mu(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var Bc=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,r=50){return p(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,a;return new Promise((c,l)=>{let d=mu("",20);i.port1.start();let m=setTimeout(()=>{l(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(I){let E=I;if(E.data.eventId===d)switch(E.data.status){case"ack":clearTimeout(m),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),c(E.data.response);break;default:clearTimeout(m),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})})}};function it(){return window}function tT(n){it().location.href=n}function fm(){return typeof it().WorkerGlobalScope<"u"&&typeof it().importScripts=="function"}function nT(){return p(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function rT(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function iT(){return fm()?self:null}var pm="firebaseLocalStorageDb",sT=1,Ks="firebaseLocalStorage",mm="fbase_key",wn=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function Zs(n,e){return n.transaction([Ks],e?"readwrite":"readonly").objectStore(Ks)}function oT(){let n=indexedDB.deleteDatabase(pm);return new wn(n).toPromise()}function qc(){let n=indexedDB.open(pm,sT);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(Ks,{keyPath:mm})}catch(i){t(i)}}),n.addEventListener("success",()=>p(null,null,function*(){let r=n.result;r.objectStoreNames.contains(Ks)?e(r):(r.close(),yield oT(),e(yield qc()))}))})}function Op(n,e,t){return p(this,null,function*(){let r=Zs(n,!0).put({[mm]:e,value:t});return new wn(r).toPromise()})}function aT(n,e){return p(this,null,function*(){let t=Zs(n,!1).get(e),r=yield new wn(t).toPromise();return r===void 0?null:r.value})}function Lp(n,e){let t=Zs(n,!0).delete(e);return new wn(t).toPromise()}var cT=800,uT=3,lT=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return p(this,null,function*(){return this.db?this.db:(this.db=yield qc(),this.db)})}_withRetries(t){return p(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(r++>uT)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return p(this,null,function*(){return fm()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return p(this,null,function*(){this.receiver=eT._getInstance(iT()),this.receiver._subscribe("keyChanged",(t,r)=>p(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(t,r)=>p(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return p(this,null,function*(){var t,r;if(this.activeServiceWorker=yield nT(),!this.activeServiceWorker)return;this.sender=new Bc(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((t=i[0])===null||t===void 0)&&t.fulfilled&&!((r=i[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return p(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||rT()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return p(this,null,function*(){try{if(!indexedDB)return!1;let t=yield qc();return yield Op(t,Hs,"1"),yield Lp(t,Hs),!0}catch{}return!1})}_withPendingWrite(t){return p(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,r){return p(this,null,function*(){return this._withPendingWrite(()=>p(this,null,function*(){return yield this._withRetries(i=>Op(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)}))})}_get(t){return p(this,null,function*(){let r=yield this._withRetries(i=>aT(i,t));return this.localCache[t]=r,r})}_remove(t){return p(this,null,function*(){return this._withPendingWrite(()=>p(this,null,function*(){return yield this._withRetries(r=>Lp(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return p(this,null,function*(){let t=yield this._withRetries(s=>{let a=Zs(s,!1).getAll();return new wn(a).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:s,value:a}of t)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(a)&&(this.notifyListeners(s,a),r.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r})}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>p(this,null,function*(){return this._poll()}),cT)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),gm=lT;var ik=rm("rcb"),sk=new En(3e4,6e4);function _m(n,e){return e?Tt(e):(V(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var yi=class extends ir{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return rr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return rr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return rr(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function hT(n){return um(n.auth,new yi(n),n.bypassAuthState)}function dT(n){let{auth:e,user:t}=n;return V(t,e,"internal-error"),cm(t,new yi(n),n.bypassAuthState)}function fT(n){return p(this,null,function*(){let{auth:e,user:t}=n;return V(t,e,"internal-error"),Hw(t,new yi(n),n.bypassAuthState)})}var Qs=class{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>p(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return p(this,null,function*(){let{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:a,type:c}=e;if(a){this.reject(a);return}let l={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(c)(l))}catch(d){this.reject(d)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return hT;case"linkViaPopup":case"linkViaRedirect":return fT;case"reauthViaPopup":case"reauthViaRedirect":return dT;default:Be(this.auth,"internal-error")}}resolve(e){bt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){bt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var pT=new En(2e3,1e4);function gu(n,e,t){return p(this,null,function*(){if(Oe(n.app))return Promise.reject(Qe(n,"operation-not-supported-in-this-environment"));let r=Rt(n);uw(n,e,gi);let i=_m(r,t);return new mT(r,"signInViaPopup",e,i).executeNotNull()})}var mT=(()=>{class n extends Qs{constructor(t,r,i,s,a){super(t,r,s,a),this.provider=i,this.authWindow=null,this.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=this}executeNotNull(){return p(this,null,function*(){let t=yield this.execute();return V(t,this.auth,"internal-error"),t})}onExecution(){return p(this,null,function*(){bt(this.filter.length===1,"Popup operations only handle one event");let t=mu();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(Qe(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(Qe(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}pollUserCancellation(){let t=()=>{var r,i;if(!((i=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Qe(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,pT.get())};t()}}n.currentPopupAction=null;return n})(),gT="pendingRedirect",Vs=new Map,$c=class n extends Qs{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){return p(this,null,function*(){let e=Vs.get(this.auth._key());if(!e){try{let r=(yield _T(this.resolver,this.auth))?yield mt(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Vs.set(this.auth._key(),e)}return this.bypassAuthState||Vs.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return p(this,null,function*(){if(e.type==="signInViaRedirect")return mt(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,mt(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return p(this,null,function*(){})}cleanUp(){}};function _T(n,e){return p(this,null,function*(){let t=ET(e),r=IT(n);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(t))==="true";return yield r._remove(t),i})}function yT(n,e){Vs.set(n._key(),e)}function IT(n){return Tt(n._redirectPersistence)}function ET(n){return xs(gT,n.config.apiKey,n.name)}function vT(n,e,t=!1){return p(this,null,function*(){if(Oe(n.app))return Promise.reject(At(n));let r=Rt(n),i=_m(r,e),a=yield new $c(r,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,yield r._persistUserIfCurrent(a.user),yield r._setRedirectUser(null,e)),a})}var wT=10*60*1e3,jc=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!TT(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!ym(e)){let i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Qe(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=wT&&this.cachedEventUids.clear(),this.cachedEventUids.has(xp(e))}saveEventToCache(e){this.cachedEventUids.add(xp(e)),this.lastProcessedEventTime=Date.now()}};function xp(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function ym({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function TT(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ym(n);default:return!1}}function AT(t){return p(this,arguments,function*(n,e={}){return Je(n,"GET","/v1/projects",e)})}var bT=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ST=/^https?/;function RT(n){return p(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield AT(n);for(let t of e)try{if(PT(t))return}catch{}Be(n,"unauthorized-domain")})}function PT(n){let e=Pc(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!ST.test(t))return!1;if(bT.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var CT=new En(3e4,6e4);function Vp(){let n=it().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function kT(n){return new Promise((e,t)=>{var r,i,s;function a(){Vp(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Vp(),t(Qe(n,"network-request-failed"))},timeout:CT.get()})}if(!((i=(r=it().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=it().gapi)===null||s===void 0)&&s.load)a();else{let c=rm("iframefcb");return it()[c]=()=>{gapi.load?a():t(Qe(n,"network-request-failed"))},nm(`${kw()}?onload=${c}`).catch(l=>t(l))}}).catch(e=>{throw Ms=null,e})}var Ms=null;function DT(n){return Ms=Ms||kT(n),Ms}var NT=new En(5e3,15e3),OT="__/auth/iframe",LT="emulator/auth/iframe",xT={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},VT=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function MT(n){let e=n.config;V(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?Kc(e,LT):`https://${n.config.authDomain}/${OT}`,r={apiKey:e.apiKey,appName:n.name,v:jt},i=VT.get(n.config.apiHost);i&&(r.eid=i);let s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${Hn(r).slice(1)}`}function FT(n){return p(this,null,function*(){let e=yield DT(n),t=it().gapi;return V(t,n,"internal-error"),e.open({where:document.body,url:MT(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:xT,dontclear:!0},r=>new Promise((i,s)=>p(null,null,function*(){yield r.restyle({setHideOnLeave:!1});let a=Qe(n,"network-request-failed"),c=it().setTimeout(()=>{s(a)},NT.get());function l(){it().clearTimeout(c),i(r)}r.ping(l).then(l,()=>{s(a)})})))})}var UT={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},BT=500,qT=600,$T="_blank",jT="http://localhost",Js=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function WT(n,e,t,r=BT,i=qT){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString(),c="",l=Object.assign(Object.assign({},UT),{width:r.toString(),height:i.toString(),top:s,left:a}),d=pe().toLowerCase();t&&(c=Qp(d)?$T:t),Gp(d)&&(e=e||jT,l.scrollbars="yes");let m=Object.entries(l).reduce((E,[S,k])=>`${E}${S}=${k},`,"");if(Aw(d)&&c!=="_self")return zT(e||"",c),new Js(null);let I=window.open(e||"",c,m);V(I,n,"popup-blocked");try{I.focus()}catch{}return new Js(I)}function zT(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var HT="__/auth/handler",GT="emulator/auth/handler",KT=encodeURIComponent("fac");function Mp(n,e,t,r,i,s){return p(this,null,function*(){V(n.config.authDomain,n,"auth-domain-config-required"),V(n.config.apiKey,n,"invalid-api-key");let a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:jt,eventId:i};if(e instanceof gi){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",ff(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(let[m,I]of Object.entries(s||{}))a[m]=I}if(e instanceof _i){let m=e.getScopes().filter(I=>I!=="");m.length>0&&(a.scopes=m.join(","))}n.tenantId&&(a.tid=n.tenantId);let c=a;for(let m of Object.keys(c))c[m]===void 0&&delete c[m];let l=yield n._getAppCheckToken(),d=l?`#${KT}=${encodeURIComponent(l)}`:"";return`${QT(n)}?${Hn(c).slice(1)}${d}`})}function QT({config:n}){return n.emulator?Kc(n,GT):`https://${n.authDomain}/${HT}`}var Rc="webStorageSupport",Wc=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=pu,this._completeRedirectFn=vT,this._overrideRedirectResult=yT}_openPopup(e,t,r,i){return p(this,null,function*(){var s;bt((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let a=yield Mp(e,t,r,Pc(),i);return WT(e,a,mu())})}_openRedirect(e,t,r,i){return p(this,null,function*(){yield this._originValidation(e);let s=yield Mp(e,t,r,Pc(),i);return tT(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(bt(s,"If manager is not set, promise should be"),s)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){return p(this,null,function*(){let t=yield FT(e),r=new jc(e);return t.register("authEvent",i=>(V(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Rc,{type:Rc},i=>{var s;let a=(s=i?.[0])===null||s===void 0?void 0:s[Rc];a!==void 0&&t(!!a),Be(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=RT(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return em()||Kp()||Xc()}},Im=Wc;var Fp="@firebase/auth",Up="1.10.8";var zc=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return p(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){V(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function JT(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function YT(n){He(new Ne("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:c}=r.options;V(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let l={apiKey:a,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:tm(n)},d=new xc(r,i,s,l);return Nw(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),He(new Ne("auth-internal",e=>{let t=Rt(e.getProvider("auth").getImmediate());return(r=>new zc(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),se(Fp,Up,JT(n)),se(Fp,Up,"esm2017")}var XT=5*60,ZT=Na("authIdTokenMaxAge")||XT,Bp=null,eA=n=>e=>p(null,null,function*(){let t=e&&(yield e.getIdTokenResult()),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>ZT)return;let i=t?.token;Bp!==i&&(Bp=i,yield fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});function _u(n=fn()){let e=Qn(n,"auth");if(e.isInitialized())return e.getImmediate();let t=Zc(n,{popupRedirectResolver:Im,persistence:[gm,dm,pu]}),r=Na("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(r,location.origin);if(location.origin===s.origin){let a=eA(s.toString());du(t,a,()=>a(t.currentUser)),hu(t,c=>a(c))}}let i=ka("auth");return i&&eu(t,`http://${i}`),t}function tA(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}Pw({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let s=Qe("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",tA().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});YT("Browser");var Em="auth",Tn=class{constructor(e){return e}},Ei=class{constructor(){return Yn(Em)}};var yu=new Wn("angularfire2.auth-instances");function FA(n,e){let t=ni(Em,n,e);return t&&new Tn(t)}function UA(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Tn(r)}}var BA={provide:Ei,deps:[[new Ue,yu]]},qA={provide:Tn,useFactory:FA,deps:[[new Ue,yu],yt]};function zk(n,...e){return se("angularfire",Wt.full,"auth"),zn([qA,BA,{provide:yu,useFactory:UA(n),multi:!0,deps:[Ze,Bt,zt,mn,[new Ue,Xn],...e]}])}var vm=ae(bp,!0);var wm=ae(ou,!0,2);var Hk=ae(_u,!0);var Tm=ae(iu,!0,2);var Iu=ae(cu,!0,2),Am=ae(su,!0,2);var bm=ae(au,!0,2);var Eu=ae(gu,!0,2);var eo=ae(fu,!0,2);var Sm=ae(lu,!0,2);var vu=ae(uu,!0,2);var Rm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Pm={};var Pt,wu;(function(){var n;function e(w,g){function y(){}y.prototype=g.prototype,w.D=g.prototype,w.prototype=new y,w.prototype.constructor=w,w.C=function(v,T,b){for(var _=Array(arguments.length-2),dt=2;dt<arguments.length;dt++)_[dt-2]=arguments[dt];return g.prototype[T].apply(v,_)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,g,y){y||(y=0);var v=Array(16);if(typeof g=="string")for(var T=0;16>T;++T)v[T]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(T=0;16>T;++T)v[T]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=w.g[0],y=w.g[1],T=w.g[2];var b=w.g[3],_=g+(b^y&(T^b))+v[0]+3614090360&4294967295;g=y+(_<<7&4294967295|_>>>25),_=b+(T^g&(y^T))+v[1]+3905402710&4294967295,b=g+(_<<12&4294967295|_>>>20),_=T+(y^b&(g^y))+v[2]+606105819&4294967295,T=b+(_<<17&4294967295|_>>>15),_=y+(g^T&(b^g))+v[3]+3250441966&4294967295,y=T+(_<<22&4294967295|_>>>10),_=g+(b^y&(T^b))+v[4]+4118548399&4294967295,g=y+(_<<7&4294967295|_>>>25),_=b+(T^g&(y^T))+v[5]+1200080426&4294967295,b=g+(_<<12&4294967295|_>>>20),_=T+(y^b&(g^y))+v[6]+2821735955&4294967295,T=b+(_<<17&4294967295|_>>>15),_=y+(g^T&(b^g))+v[7]+4249261313&4294967295,y=T+(_<<22&4294967295|_>>>10),_=g+(b^y&(T^b))+v[8]+1770035416&4294967295,g=y+(_<<7&4294967295|_>>>25),_=b+(T^g&(y^T))+v[9]+2336552879&4294967295,b=g+(_<<12&4294967295|_>>>20),_=T+(y^b&(g^y))+v[10]+4294925233&4294967295,T=b+(_<<17&4294967295|_>>>15),_=y+(g^T&(b^g))+v[11]+2304563134&4294967295,y=T+(_<<22&4294967295|_>>>10),_=g+(b^y&(T^b))+v[12]+1804603682&4294967295,g=y+(_<<7&4294967295|_>>>25),_=b+(T^g&(y^T))+v[13]+4254626195&4294967295,b=g+(_<<12&4294967295|_>>>20),_=T+(y^b&(g^y))+v[14]+2792965006&4294967295,T=b+(_<<17&4294967295|_>>>15),_=y+(g^T&(b^g))+v[15]+1236535329&4294967295,y=T+(_<<22&4294967295|_>>>10),_=g+(T^b&(y^T))+v[1]+4129170786&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^T&(g^y))+v[6]+3225465664&4294967295,b=g+(_<<9&4294967295|_>>>23),_=T+(g^y&(b^g))+v[11]+643717713&4294967295,T=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(T^b))+v[0]+3921069994&4294967295,y=T+(_<<20&4294967295|_>>>12),_=g+(T^b&(y^T))+v[5]+3593408605&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^T&(g^y))+v[10]+38016083&4294967295,b=g+(_<<9&4294967295|_>>>23),_=T+(g^y&(b^g))+v[15]+3634488961&4294967295,T=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(T^b))+v[4]+3889429448&4294967295,y=T+(_<<20&4294967295|_>>>12),_=g+(T^b&(y^T))+v[9]+568446438&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^T&(g^y))+v[14]+3275163606&4294967295,b=g+(_<<9&4294967295|_>>>23),_=T+(g^y&(b^g))+v[3]+4107603335&4294967295,T=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(T^b))+v[8]+1163531501&4294967295,y=T+(_<<20&4294967295|_>>>12),_=g+(T^b&(y^T))+v[13]+2850285829&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^T&(g^y))+v[2]+4243563512&4294967295,b=g+(_<<9&4294967295|_>>>23),_=T+(g^y&(b^g))+v[7]+1735328473&4294967295,T=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(T^b))+v[12]+2368359562&4294967295,y=T+(_<<20&4294967295|_>>>12),_=g+(y^T^b)+v[5]+4294588738&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^T)+v[8]+2272392833&4294967295,b=g+(_<<11&4294967295|_>>>21),_=T+(b^g^y)+v[11]+1839030562&4294967295,T=b+(_<<16&4294967295|_>>>16),_=y+(T^b^g)+v[14]+4259657740&4294967295,y=T+(_<<23&4294967295|_>>>9),_=g+(y^T^b)+v[1]+2763975236&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^T)+v[4]+1272893353&4294967295,b=g+(_<<11&4294967295|_>>>21),_=T+(b^g^y)+v[7]+4139469664&4294967295,T=b+(_<<16&4294967295|_>>>16),_=y+(T^b^g)+v[10]+3200236656&4294967295,y=T+(_<<23&4294967295|_>>>9),_=g+(y^T^b)+v[13]+681279174&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^T)+v[0]+3936430074&4294967295,b=g+(_<<11&4294967295|_>>>21),_=T+(b^g^y)+v[3]+3572445317&4294967295,T=b+(_<<16&4294967295|_>>>16),_=y+(T^b^g)+v[6]+76029189&4294967295,y=T+(_<<23&4294967295|_>>>9),_=g+(y^T^b)+v[9]+3654602809&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^T)+v[12]+3873151461&4294967295,b=g+(_<<11&4294967295|_>>>21),_=T+(b^g^y)+v[15]+530742520&4294967295,T=b+(_<<16&4294967295|_>>>16),_=y+(T^b^g)+v[2]+3299628645&4294967295,y=T+(_<<23&4294967295|_>>>9),_=g+(T^(y|~b))+v[0]+4096336452&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~T))+v[7]+1126891415&4294967295,b=g+(_<<10&4294967295|_>>>22),_=T+(g^(b|~y))+v[14]+2878612391&4294967295,T=b+(_<<15&4294967295|_>>>17),_=y+(b^(T|~g))+v[5]+4237533241&4294967295,y=T+(_<<21&4294967295|_>>>11),_=g+(T^(y|~b))+v[12]+1700485571&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~T))+v[3]+2399980690&4294967295,b=g+(_<<10&4294967295|_>>>22),_=T+(g^(b|~y))+v[10]+4293915773&4294967295,T=b+(_<<15&4294967295|_>>>17),_=y+(b^(T|~g))+v[1]+2240044497&4294967295,y=T+(_<<21&4294967295|_>>>11),_=g+(T^(y|~b))+v[8]+1873313359&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~T))+v[15]+4264355552&4294967295,b=g+(_<<10&4294967295|_>>>22),_=T+(g^(b|~y))+v[6]+2734768916&4294967295,T=b+(_<<15&4294967295|_>>>17),_=y+(b^(T|~g))+v[13]+1309151649&4294967295,y=T+(_<<21&4294967295|_>>>11),_=g+(T^(y|~b))+v[4]+4149444226&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~T))+v[11]+3174756917&4294967295,b=g+(_<<10&4294967295|_>>>22),_=T+(g^(b|~y))+v[2]+718787259&4294967295,T=b+(_<<15&4294967295|_>>>17),_=y+(b^(T|~g))+v[9]+3951481745&4294967295,w.g[0]=w.g[0]+g&4294967295,w.g[1]=w.g[1]+(T+(_<<21&4294967295|_>>>11))&4294967295,w.g[2]=w.g[2]+T&4294967295,w.g[3]=w.g[3]+b&4294967295}r.prototype.u=function(w,g){g===void 0&&(g=w.length);for(var y=g-this.blockSize,v=this.B,T=this.h,b=0;b<g;){if(T==0)for(;b<=y;)i(this,w,b),b+=this.blockSize;if(typeof w=="string"){for(;b<g;)if(v[T++]=w.charCodeAt(b++),T==this.blockSize){i(this,v),T=0;break}}else for(;b<g;)if(v[T++]=w[b++],T==this.blockSize){i(this,v),T=0;break}}this.h=T,this.o+=g},r.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var g=1;g<w.length-8;++g)w[g]=0;var y=8*this.o;for(g=w.length-8;g<w.length;++g)w[g]=y&255,y/=256;for(this.u(w),w=Array(16),g=y=0;4>g;++g)for(var v=0;32>v;v+=8)w[y++]=this.g[g]>>>v&255;return w};function s(w,g){var y=c;return Object.prototype.hasOwnProperty.call(y,w)?y[w]:y[w]=g(w)}function a(w,g){this.h=g;for(var y=[],v=!0,T=w.length-1;0<=T;T--){var b=w[T]|0;v&&b==g||(y[T]=b,v=!1)}this.g=y}var c={};function l(w){return-128<=w&&128>w?s(w,function(g){return new a([g|0],0>g?-1:0)}):new a([w|0],0>w?-1:0)}function d(w){if(isNaN(w)||!isFinite(w))return I;if(0>w)return D(d(-w));for(var g=[],y=1,v=0;w>=y;v++)g[v]=w/y|0,y*=4294967296;return new a(g,0)}function m(w,g){if(w.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(w.charAt(0)=="-")return D(m(w.substring(1),g));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=d(Math.pow(g,8)),v=I,T=0;T<w.length;T+=8){var b=Math.min(8,w.length-T),_=parseInt(w.substring(T,T+b),g);8>b?(b=d(Math.pow(g,b)),v=v.j(b).add(d(_))):(v=v.j(y),v=v.add(d(_)))}return v}var I=l(0),E=l(1),S=l(16777216);n=a.prototype,n.m=function(){if(L(this))return-D(this).m();for(var w=0,g=1,y=0;y<this.g.length;y++){var v=this.i(y);w+=(0<=v?v:4294967296+v)*g,g*=4294967296}return w},n.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(k(this))return"0";if(L(this))return"-"+D(this).toString(w);for(var g=d(Math.pow(w,6)),y=this,v="";;){var T=X(y,g).g;y=$(y,T.j(g));var b=((0<y.g.length?y.g[0]:y.h)>>>0).toString(w);if(y=T,k(y))return b+v;for(;6>b.length;)b="0"+b;v=b+v}},n.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function k(w){if(w.h!=0)return!1;for(var g=0;g<w.g.length;g++)if(w.g[g]!=0)return!1;return!0}function L(w){return w.h==-1}n.l=function(w){return w=$(this,w),L(w)?-1:k(w)?0:1};function D(w){for(var g=w.g.length,y=[],v=0;v<g;v++)y[v]=~w.g[v];return new a(y,~w.h).add(E)}n.abs=function(){return L(this)?D(this):this},n.add=function(w){for(var g=Math.max(this.g.length,w.g.length),y=[],v=0,T=0;T<=g;T++){var b=v+(this.i(T)&65535)+(w.i(T)&65535),_=(b>>>16)+(this.i(T)>>>16)+(w.i(T)>>>16);v=_>>>16,b&=65535,_&=65535,y[T]=_<<16|b}return new a(y,y[y.length-1]&-2147483648?-1:0)};function $(w,g){return w.add(D(g))}n.j=function(w){if(k(this)||k(w))return I;if(L(this))return L(w)?D(this).j(D(w)):D(D(this).j(w));if(L(w))return D(this.j(D(w)));if(0>this.l(S)&&0>w.l(S))return d(this.m()*w.m());for(var g=this.g.length+w.g.length,y=[],v=0;v<2*g;v++)y[v]=0;for(v=0;v<this.g.length;v++)for(var T=0;T<w.g.length;T++){var b=this.i(v)>>>16,_=this.i(v)&65535,dt=w.i(T)>>>16,Nr=w.i(T)&65535;y[2*v+2*T]+=_*Nr,U(y,2*v+2*T),y[2*v+2*T+1]+=b*Nr,U(y,2*v+2*T+1),y[2*v+2*T+1]+=_*dt,U(y,2*v+2*T+1),y[2*v+2*T+2]+=b*dt,U(y,2*v+2*T+2)}for(v=0;v<g;v++)y[v]=y[2*v+1]<<16|y[2*v];for(v=g;v<2*g;v++)y[v]=0;return new a(y,0)};function U(w,g){for(;(w[g]&65535)!=w[g];)w[g+1]+=w[g]>>>16,w[g]&=65535,g++}function j(w,g){this.g=w,this.h=g}function X(w,g){if(k(g))throw Error("division by zero");if(k(w))return new j(I,I);if(L(w))return g=X(D(w),g),new j(D(g.g),D(g.h));if(L(g))return g=X(w,D(g)),new j(D(g.g),g.h);if(30<w.g.length){if(L(w)||L(g))throw Error("slowDivide_ only works with positive integers.");for(var y=E,v=g;0>=v.l(w);)y=Pe(y),v=Pe(v);var T=Y(y,1),b=Y(v,1);for(v=Y(v,2),y=Y(y,2);!k(v);){var _=b.add(v);0>=_.l(w)&&(T=T.add(y),b=_),v=Y(v,1),y=Y(y,1)}return g=$(w,T.j(g)),new j(T,g)}for(T=I;0<=w.l(g);){for(y=Math.max(1,Math.floor(w.m()/g.m())),v=Math.ceil(Math.log(y)/Math.LN2),v=48>=v?1:Math.pow(2,v-48),b=d(y),_=b.j(g);L(_)||0<_.l(w);)y-=v,b=d(y),_=b.j(g);k(b)&&(b=E),T=T.add(b),w=$(w,_)}return new j(T,w)}n.A=function(w){return X(this,w).h},n.and=function(w){for(var g=Math.max(this.g.length,w.g.length),y=[],v=0;v<g;v++)y[v]=this.i(v)&w.i(v);return new a(y,this.h&w.h)},n.or=function(w){for(var g=Math.max(this.g.length,w.g.length),y=[],v=0;v<g;v++)y[v]=this.i(v)|w.i(v);return new a(y,this.h|w.h)},n.xor=function(w){for(var g=Math.max(this.g.length,w.g.length),y=[],v=0;v<g;v++)y[v]=this.i(v)^w.i(v);return new a(y,this.h^w.h)};function Pe(w){for(var g=w.g.length+1,y=[],v=0;v<g;v++)y[v]=w.i(v)<<1|w.i(v-1)>>>31;return new a(y,w.h)}function Y(w,g){var y=g>>5;g%=32;for(var v=w.g.length-y,T=[],b=0;b<v;b++)T[b]=0<g?w.i(b+y)>>>g|w.i(b+y+1)<<32-g:w.i(b+y);return new a(T,w.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,wu=Pm.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=m,Pt=Pm.Integer=a}).apply(typeof Rm<"u"?Rm:typeof self<"u"?self:typeof window<"u"?window:{});var to=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ct={};var Tu,$A,or,Au,vi,no,bu,Su,Ru;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,u,h){return o==Array.prototype||o==Object.prototype||(o[u]=h.value),o};function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof to=="object"&&to];for(var u=0;u<o.length;++u){var h=o[u];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var r=t(this);function i(o,u){if(u)e:{var h=r;o=o.split(".");for(var f=0;f<o.length-1;f++){var A=o[f];if(!(A in h))break e;h=h[A]}o=o[o.length-1],f=h[o],u=u(f),u!=f&&u!=null&&e(h,o,{configurable:!0,writable:!0,value:u})}}function s(o,u){o instanceof String&&(o+="");var h=0,f=!1,A={next:function(){if(!f&&h<o.length){var R=h++;return{value:u(R,o[R]),done:!1}}return f=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}i("Array.prototype.values",function(o){return o||function(){return s(this,function(u,h){return h})}});var a=a||{},c=this||self;function l(o){var u=typeof o;return u=u!="object"?u:o?Array.isArray(o)?"array":u:"null",u=="array"||u=="object"&&typeof o.length=="number"}function d(o){var u=typeof o;return u=="object"&&o!=null||u=="function"}function m(o,u,h){return o.call.apply(o.bind,arguments)}function I(o,u,h){if(!o)throw Error();if(2<arguments.length){var f=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,f),o.apply(u,A)}}return function(){return o.apply(u,arguments)}}function E(o,u,h){return E=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?m:I,E.apply(null,arguments)}function S(o,u){var h=Array.prototype.slice.call(arguments,1);return function(){var f=h.slice();return f.push.apply(f,arguments),o.apply(this,f)}}function k(o,u){function h(){}h.prototype=u.prototype,o.aa=u.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(f,A,R){for(var N=Array(arguments.length-2),Z=2;Z<arguments.length;Z++)N[Z-2]=arguments[Z];return u.prototype[A].apply(f,N)}}function L(o){let u=o.length;if(0<u){let h=Array(u);for(let f=0;f<u;f++)h[f]=o[f];return h}return[]}function D(o,u){for(let h=1;h<arguments.length;h++){let f=arguments[h];if(l(f)){let A=o.length||0,R=f.length||0;o.length=A+R;for(let N=0;N<R;N++)o[A+N]=f[N]}else o.push(f)}}class ${constructor(u,h){this.i=u,this.j=h,this.h=0,this.g=null}get(){let u;return 0<this.h?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function U(o){return/^[\s\xa0]*$/.test(o)}function j(){var o=c.navigator;return o&&(o=o.userAgent)?o:""}function X(o){return X[" "](o),o}X[" "]=function(){};var Pe=j().indexOf("Gecko")!=-1&&!(j().toLowerCase().indexOf("webkit")!=-1&&j().indexOf("Edge")==-1)&&!(j().indexOf("Trident")!=-1||j().indexOf("MSIE")!=-1)&&j().indexOf("Edge")==-1;function Y(o,u,h){for(let f in o)u.call(h,o[f],f,o)}function w(o,u){for(let h in o)u.call(void 0,o[h],h,o)}function g(o){let u={};for(let h in o)u[h]=o[h];return u}let y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function v(o,u){let h,f;for(let A=1;A<arguments.length;A++){f=arguments[A];for(h in f)o[h]=f[h];for(let R=0;R<y.length;R++)h=y[R],Object.prototype.hasOwnProperty.call(f,h)&&(o[h]=f[h])}}function T(o){var u=1;o=o.split(":");let h=[];for(;0<u&&o.length;)h.push(o.shift()),u--;return o.length&&h.push(o.join(":")),h}function b(o){c.setTimeout(()=>{throw o},0)}function _(){var o=Jo;let u=null;return o.g&&(u=o.g,o.g=o.g.next,o.g||(o.h=null),u.next=null),u}class dt{constructor(){this.h=this.g=null}add(u,h){let f=Nr.get();f.set(u,h),this.h?this.h.next=f:this.g=f,this.h=f}}var Nr=new $(()=>new Q_,o=>o.reset());class Q_{constructor(){this.next=this.g=this.h=null}set(u,h){this.h=u,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let Or,Lr=!1,Jo=new dt,Wh=()=>{let o=c.Promise.resolve(void 0);Or=()=>{o.then(J_)}};var J_=()=>{for(var o;o=_();){try{o.h.call(o.g)}catch(h){b(h)}var u=Nr;u.j(o),100>u.h&&(u.h++,o.next=u.g,u.g=o)}Lr=!1};function xt(){this.s=this.s,this.C=this.C}xt.prototype.s=!1,xt.prototype.ma=function(){this.s||(this.s=!0,this.N())},xt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ie(o,u){this.type=o,this.g=this.target=u,this.defaultPrevented=!1}Ie.prototype.h=function(){this.defaultPrevented=!0};var Y_=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var o=!1,u=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};c.addEventListener("test",h,u),c.removeEventListener("test",h,u)}catch{}return o}();function xr(o,u){if(Ie.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,f=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=u,u=o.relatedTarget){if(Pe){e:{try{X(u.nodeName);var A=!0;break e}catch{}A=!1}A||(u=null)}}else h=="mouseover"?u=o.fromElement:h=="mouseout"&&(u=o.toElement);this.relatedTarget=u,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:X_[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&xr.aa.h.call(this)}}k(xr,Ie);var X_={2:"touch",3:"pen",4:"mouse"};xr.prototype.h=function(){xr.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Vr="closure_listenable_"+(1e6*Math.random()|0),Z_=0;function ey(o,u,h,f,A){this.listener=o,this.proxy=null,this.src=u,this.type=h,this.capture=!!f,this.ha=A,this.key=++Z_,this.da=this.fa=!1}function $i(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function ji(o){this.src=o,this.g={},this.h=0}ji.prototype.add=function(o,u,h,f,A){var R=o.toString();o=this.g[R],o||(o=this.g[R]=[],this.h++);var N=Xo(o,u,f,A);return-1<N?(u=o[N],h||(u.fa=!1)):(u=new ey(u,this.src,R,!!f,A),u.fa=h,o.push(u)),u};function Yo(o,u){var h=u.type;if(h in o.g){var f=o.g[h],A=Array.prototype.indexOf.call(f,u,void 0),R;(R=0<=A)&&Array.prototype.splice.call(f,A,1),R&&($i(u),o.g[h].length==0&&(delete o.g[h],o.h--))}}function Xo(o,u,h,f){for(var A=0;A<o.length;++A){var R=o[A];if(!R.da&&R.listener==u&&R.capture==!!h&&R.ha==f)return A}return-1}var Zo="closure_lm_"+(1e6*Math.random()|0),ea={};function zh(o,u,h,f,A){if(f&&f.once)return Gh(o,u,h,f,A);if(Array.isArray(u)){for(var R=0;R<u.length;R++)zh(o,u[R],h,f,A);return null}return h=ia(h),o&&o[Vr]?o.K(u,h,d(f)?!!f.capture:!!f,A):Hh(o,u,h,!1,f,A)}function Hh(o,u,h,f,A,R){if(!u)throw Error("Invalid event type");var N=d(A)?!!A.capture:!!A,Z=na(o);if(Z||(o[Zo]=Z=new ji(o)),h=Z.add(u,h,f,N,R),h.proxy)return h;if(f=ty(),h.proxy=f,f.src=o,f.listener=h,o.addEventListener)Y_||(A=N),A===void 0&&(A=!1),o.addEventListener(u.toString(),f,A);else if(o.attachEvent)o.attachEvent(Qh(u.toString()),f);else if(o.addListener&&o.removeListener)o.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return h}function ty(){function o(h){return u.call(o.src,o.listener,h)}let u=ny;return o}function Gh(o,u,h,f,A){if(Array.isArray(u)){for(var R=0;R<u.length;R++)Gh(o,u[R],h,f,A);return null}return h=ia(h),o&&o[Vr]?o.L(u,h,d(f)?!!f.capture:!!f,A):Hh(o,u,h,!0,f,A)}function Kh(o,u,h,f,A){if(Array.isArray(u))for(var R=0;R<u.length;R++)Kh(o,u[R],h,f,A);else f=d(f)?!!f.capture:!!f,h=ia(h),o&&o[Vr]?(o=o.i,u=String(u).toString(),u in o.g&&(R=o.g[u],h=Xo(R,h,f,A),-1<h&&($i(R[h]),Array.prototype.splice.call(R,h,1),R.length==0&&(delete o.g[u],o.h--)))):o&&(o=na(o))&&(u=o.g[u.toString()],o=-1,u&&(o=Xo(u,h,f,A)),(h=-1<o?u[o]:null)&&ta(h))}function ta(o){if(typeof o!="number"&&o&&!o.da){var u=o.src;if(u&&u[Vr])Yo(u.i,o);else{var h=o.type,f=o.proxy;u.removeEventListener?u.removeEventListener(h,f,o.capture):u.detachEvent?u.detachEvent(Qh(h),f):u.addListener&&u.removeListener&&u.removeListener(f),(h=na(u))?(Yo(h,o),h.h==0&&(h.src=null,u[Zo]=null)):$i(o)}}}function Qh(o){return o in ea?ea[o]:ea[o]="on"+o}function ny(o,u){if(o.da)o=!0;else{u=new xr(u,this);var h=o.listener,f=o.ha||o.src;o.fa&&ta(o),o=h.call(f,u)}return o}function na(o){return o=o[Zo],o instanceof ji?o:null}var ra="__closure_events_fn_"+(1e9*Math.random()>>>0);function ia(o){return typeof o=="function"?o:(o[ra]||(o[ra]=function(u){return o.handleEvent(u)}),o[ra])}function Ee(){xt.call(this),this.i=new ji(this),this.M=this,this.F=null}k(Ee,xt),Ee.prototype[Vr]=!0,Ee.prototype.removeEventListener=function(o,u,h,f){Kh(this,o,u,h,f)};function Ce(o,u){var h,f=o.F;if(f)for(h=[];f;f=f.F)h.push(f);if(o=o.M,f=u.type||u,typeof u=="string")u=new Ie(u,o);else if(u instanceof Ie)u.target=u.target||o;else{var A=u;u=new Ie(f,o),v(u,A)}if(A=!0,h)for(var R=h.length-1;0<=R;R--){var N=u.g=h[R];A=Wi(N,f,!0,u)&&A}if(N=u.g=o,A=Wi(N,f,!0,u)&&A,A=Wi(N,f,!1,u)&&A,h)for(R=0;R<h.length;R++)N=u.g=h[R],A=Wi(N,f,!1,u)&&A}Ee.prototype.N=function(){if(Ee.aa.N.call(this),this.i){var o=this.i,u;for(u in o.g){for(var h=o.g[u],f=0;f<h.length;f++)$i(h[f]);delete o.g[u],o.h--}}this.F=null},Ee.prototype.K=function(o,u,h,f){return this.i.add(String(o),u,!1,h,f)},Ee.prototype.L=function(o,u,h,f){return this.i.add(String(o),u,!0,h,f)};function Wi(o,u,h,f){if(u=o.i.g[String(u)],!u)return!0;u=u.concat();for(var A=!0,R=0;R<u.length;++R){var N=u[R];if(N&&!N.da&&N.capture==h){var Z=N.listener,_e=N.ha||N.src;N.fa&&Yo(o.i,N),A=Z.call(_e,f)!==!1&&A}}return A&&!f.defaultPrevented}function Jh(o,u,h){if(typeof o=="function")h&&(o=E(o,h));else if(o&&typeof o.handleEvent=="function")o=E(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(u)?-1:c.setTimeout(o,u||0)}function Yh(o){o.g=Jh(()=>{o.g=null,o.i&&(o.i=!1,Yh(o))},o.l);let u=o.h;o.h=null,o.m.apply(null,u)}class ry extends xt{constructor(u,h){super(),this.m=u,this.l=h,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:Yh(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Mr(o){xt.call(this),this.h=o,this.g={}}k(Mr,xt);var Xh=[];function Zh(o){Y(o.g,function(u,h){this.g.hasOwnProperty(h)&&ta(u)},o),o.g={}}Mr.prototype.N=function(){Mr.aa.N.call(this),Zh(this)},Mr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var sa=c.JSON.stringify,iy=c.JSON.parse,sy=class{stringify(o){return c.JSON.stringify(o,void 0)}parse(o){return c.JSON.parse(o,void 0)}};function oa(){}oa.prototype.h=null;function ed(o){return o.h||(o.h=o.i())}function td(){}var Fr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function aa(){Ie.call(this,"d")}k(aa,Ie);function ca(){Ie.call(this,"c")}k(ca,Ie);var on={},nd=null;function zi(){return nd=nd||new Ee}on.La="serverreachability";function rd(o){Ie.call(this,on.La,o)}k(rd,Ie);function Ur(o){let u=zi();Ce(u,new rd(u))}on.STAT_EVENT="statevent";function id(o,u){Ie.call(this,on.STAT_EVENT,o),this.stat=u}k(id,Ie);function ke(o){let u=zi();Ce(u,new id(u,o))}on.Ma="timingevent";function sd(o,u){Ie.call(this,on.Ma,o),this.size=u}k(sd,Ie);function Br(o,u){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){o()},u)}function qr(){this.g=!0}qr.prototype.xa=function(){this.g=!1};function oy(o,u,h,f,A,R){o.info(function(){if(o.g)if(R)for(var N="",Z=R.split("&"),_e=0;_e<Z.length;_e++){var K=Z[_e].split("=");if(1<K.length){var ve=K[0];K=K[1];var we=ve.split("_");N=2<=we.length&&we[1]=="type"?N+(ve+"="+K+"&"):N+(ve+"=redacted&")}}else N=null;else N=R;return"XMLHTTP REQ ("+f+") [attempt "+A+"]: "+u+`
`+h+`
`+N})}function ay(o,u,h,f,A,R,N){o.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+A+"]: "+u+`
`+h+`
`+R+" "+N})}function Un(o,u,h,f){o.info(function(){return"XMLHTTP TEXT ("+u+"): "+uy(o,h)+(f?" "+f:"")})}function cy(o,u){o.info(function(){return"TIMEOUT: "+u})}qr.prototype.info=function(){};function uy(o,u){if(!o.g)return u;if(!u)return null;try{var h=JSON.parse(u);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var f=h[o];if(!(2>f.length)){var A=f[1];if(Array.isArray(A)&&!(1>A.length)){var R=A[0];if(R!="noop"&&R!="stop"&&R!="close")for(var N=1;N<A.length;N++)A[N]=""}}}}return sa(h)}catch{return u}}var Hi={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},od={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ua;function Gi(){}k(Gi,oa),Gi.prototype.g=function(){return new XMLHttpRequest},Gi.prototype.i=function(){return{}},ua=new Gi;function Vt(o,u,h,f){this.j=o,this.i=u,this.l=h,this.R=f||1,this.U=new Mr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ad}function ad(){this.i=null,this.g="",this.h=!1}var cd={},la={};function ha(o,u,h){o.L=1,o.v=Yi(ft(u)),o.m=h,o.P=!0,ud(o,null)}function ud(o,u){o.F=Date.now(),Ki(o),o.A=ft(o.v);var h=o.A,f=o.R;Array.isArray(f)||(f=[String(f)]),Td(h.i,"t",f),o.C=0,h=o.j.J,o.h=new ad,o.g=qd(o.j,h?u:null,!o.m),0<o.O&&(o.M=new ry(E(o.Y,o,o.g),o.O)),u=o.U,h=o.g,f=o.ca;var A="readystatechange";Array.isArray(A)||(A&&(Xh[0]=A.toString()),A=Xh);for(var R=0;R<A.length;R++){var N=zh(h,A[R],f||u.handleEvent,!1,u.h||u);if(!N)break;u.g[N.key]=N}u=o.H?g(o.H):{},o.m?(o.u||(o.u="POST"),u["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,u)):(o.u="GET",o.g.ea(o.A,o.u,null,u)),Ur(),oy(o.i,o.u,o.A,o.l,o.R,o.m)}Vt.prototype.ca=function(o){o=o.target;let u=this.M;u&&pt(o)==3?u.j():this.Y(o)},Vt.prototype.Y=function(o){try{if(o==this.g)e:{let we=pt(this.g);var u=this.g.Ba();let $n=this.g.Z();if(!(3>we)&&(we!=3||this.g&&(this.h.h||this.g.oa()||kd(this.g)))){this.J||we!=4||u==7||(u==8||0>=$n?Ur(3):Ur(2)),da(this);var h=this.g.Z();this.X=h;t:if(ld(this)){var f=kd(this.g);o="";var A=f.length,R=pt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){an(this),$r(this);var N="";break t}this.h.i=new c.TextDecoder}for(u=0;u<A;u++)this.h.h=!0,o+=this.h.i.decode(f[u],{stream:!(R&&u==A-1)});f.length=0,this.h.g+=o,this.C=0,N=this.h.g}else N=this.g.oa();if(this.o=h==200,ay(this.i,this.u,this.A,this.l,this.R,we,h),this.o){if(this.T&&!this.K){t:{if(this.g){var Z,_e=this.g;if((Z=_e.g?_e.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(Z)){var K=Z;break t}}K=null}if(h=K)Un(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,fa(this,h);else{this.o=!1,this.s=3,ke(12),an(this),$r(this);break e}}if(this.P){h=!0;let je;for(;!this.J&&this.C<N.length;)if(je=ly(this,N),je==la){we==4&&(this.s=4,ke(14),h=!1),Un(this.i,this.l,null,"[Incomplete Response]");break}else if(je==cd){this.s=4,ke(15),Un(this.i,this.l,N,"[Invalid Chunk]"),h=!1;break}else Un(this.i,this.l,je,null),fa(this,je);if(ld(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),we!=4||N.length!=0||this.h.h||(this.s=1,ke(16),h=!1),this.o=this.o&&h,!h)Un(this.i,this.l,N,"[Invalid Chunked Response]"),an(this),$r(this);else if(0<N.length&&!this.W){this.W=!0;var ve=this.j;ve.g==this&&ve.ba&&!ve.M&&(ve.j.info("Great, no buffering proxy detected. Bytes received: "+N.length),Ia(ve),ve.M=!0,ke(11))}}else Un(this.i,this.l,N,null),fa(this,N);we==4&&an(this),this.o&&!this.J&&(we==4?Md(this.j,this):(this.o=!1,Ki(this)))}else Ry(this.g),h==400&&0<N.indexOf("Unknown SID")?(this.s=3,ke(12)):(this.s=0,ke(13)),an(this),$r(this)}}}catch{}finally{}};function ld(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function ly(o,u){var h=o.C,f=u.indexOf(`
`,h);return f==-1?la:(h=Number(u.substring(h,f)),isNaN(h)?cd:(f+=1,f+h>u.length?la:(u=u.slice(f,f+h),o.C=f+h,u)))}Vt.prototype.cancel=function(){this.J=!0,an(this)};function Ki(o){o.S=Date.now()+o.I,hd(o,o.I)}function hd(o,u){if(o.B!=null)throw Error("WatchDog timer not null");o.B=Br(E(o.ba,o),u)}function da(o){o.B&&(c.clearTimeout(o.B),o.B=null)}Vt.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(cy(this.i,this.A),this.L!=2&&(Ur(),ke(17)),an(this),this.s=2,$r(this)):hd(this,this.S-o)};function $r(o){o.j.G==0||o.J||Md(o.j,o)}function an(o){da(o);var u=o.M;u&&typeof u.ma=="function"&&u.ma(),o.M=null,Zh(o.U),o.g&&(u=o.g,o.g=null,u.abort(),u.ma())}function fa(o,u){try{var h=o.j;if(h.G!=0&&(h.g==o||pa(h.h,o))){if(!o.K&&pa(h.h,o)&&h.G==3){try{var f=h.Da.g.parse(u)}catch{f=null}if(Array.isArray(f)&&f.length==3){var A=f;if(A[0]==0){e:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)ns(h),es(h);else break e;ya(h),ke(18)}}else h.za=A[1],0<h.za-h.T&&37500>A[2]&&h.F&&h.v==0&&!h.C&&(h.C=Br(E(h.Za,h),6e3));if(1>=pd(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else un(h,11)}else if((o.K||h.g==o)&&ns(h),!U(u))for(A=h.Da.g.parse(u),u=0;u<A.length;u++){let K=A[u];if(h.T=K[0],K=K[1],h.G==2)if(K[0]=="c"){h.K=K[1],h.ia=K[2];let ve=K[3];ve!=null&&(h.la=ve,h.j.info("VER="+h.la));let we=K[4];we!=null&&(h.Aa=we,h.j.info("SVER="+h.Aa));let $n=K[5];$n!=null&&typeof $n=="number"&&0<$n&&(f=1.5*$n,h.L=f,h.j.info("backChannelRequestTimeoutMs_="+f)),f=h;let je=o.g;if(je){let is=je.g?je.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(is){var R=f.h;R.g||is.indexOf("spdy")==-1&&is.indexOf("quic")==-1&&is.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(ma(R,R.h),R.h=null))}if(f.D){let Ea=je.g?je.g.getResponseHeader("X-HTTP-Session-Id"):null;Ea&&(f.ya=Ea,te(f.I,f.D,Ea))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),f=h;var N=o;if(f.qa=Bd(f,f.J?f.ia:null,f.W),N.K){md(f.h,N);var Z=N,_e=f.L;_e&&(Z.I=_e),Z.B&&(da(Z),Ki(Z)),f.g=N}else xd(f);0<h.i.length&&ts(h)}else K[0]!="stop"&&K[0]!="close"||un(h,7);else h.G==3&&(K[0]=="stop"||K[0]=="close"?K[0]=="stop"?un(h,7):_a(h):K[0]!="noop"&&h.l&&h.l.ta(K),h.v=0)}}Ur(4)}catch{}}var hy=class{constructor(o,u){this.g=o,this.map=u}};function dd(o){this.l=o||10,c.PerformanceNavigationTiming?(o=c.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function fd(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function pd(o){return o.h?1:o.g?o.g.size:0}function pa(o,u){return o.h?o.h==u:o.g?o.g.has(u):!1}function ma(o,u){o.g?o.g.add(u):o.h=u}function md(o,u){o.h&&o.h==u?o.h=null:o.g&&o.g.has(u)&&o.g.delete(u)}dd.prototype.cancel=function(){if(this.i=gd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function gd(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let u=o.i;for(let h of o.g.values())u=u.concat(h.D);return u}return L(o.i)}function dy(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(l(o)){for(var u=[],h=o.length,f=0;f<h;f++)u.push(o[f]);return u}u=[],h=0;for(f in o)u[h++]=o[f];return u}function fy(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(l(o)||typeof o=="string"){var u=[];o=o.length;for(var h=0;h<o;h++)u.push(h);return u}u=[],h=0;for(let f in o)u[h++]=f;return u}}}function _d(o,u){if(o.forEach&&typeof o.forEach=="function")o.forEach(u,void 0);else if(l(o)||typeof o=="string")Array.prototype.forEach.call(o,u,void 0);else for(var h=fy(o),f=dy(o),A=f.length,R=0;R<A;R++)u.call(void 0,f[R],h&&h[R],o)}var yd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function py(o,u){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var f=o[h].indexOf("="),A=null;if(0<=f){var R=o[h].substring(0,f);A=o[h].substring(f+1)}else R=o[h];u(R,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function cn(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof cn){this.h=o.h,Qi(this,o.j),this.o=o.o,this.g=o.g,Ji(this,o.s),this.l=o.l;var u=o.i,h=new zr;h.i=u.i,u.g&&(h.g=new Map(u.g),h.h=u.h),Id(this,h),this.m=o.m}else o&&(u=String(o).match(yd))?(this.h=!1,Qi(this,u[1]||"",!0),this.o=jr(u[2]||""),this.g=jr(u[3]||"",!0),Ji(this,u[4]),this.l=jr(u[5]||"",!0),Id(this,u[6]||"",!0),this.m=jr(u[7]||"")):(this.h=!1,this.i=new zr(null,this.h))}cn.prototype.toString=function(){var o=[],u=this.j;u&&o.push(Wr(u,Ed,!0),":");var h=this.g;return(h||u=="file")&&(o.push("//"),(u=this.o)&&o.push(Wr(u,Ed,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(Wr(h,h.charAt(0)=="/"?_y:gy,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",Wr(h,Iy)),o.join("")};function ft(o){return new cn(o)}function Qi(o,u,h){o.j=h?jr(u,!0):u,o.j&&(o.j=o.j.replace(/:$/,""))}function Ji(o,u){if(u){if(u=Number(u),isNaN(u)||0>u)throw Error("Bad port number "+u);o.s=u}else o.s=null}function Id(o,u,h){u instanceof zr?(o.i=u,Ey(o.i,o.h)):(h||(u=Wr(u,yy)),o.i=new zr(u,o.h))}function te(o,u,h){o.i.set(u,h)}function Yi(o){return te(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function jr(o,u){return o?u?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Wr(o,u,h){return typeof o=="string"?(o=encodeURI(o).replace(u,my),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function my(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Ed=/[#\/\?@]/g,gy=/[#\?:]/g,_y=/[#\?]/g,yy=/[#\?@]/g,Iy=/#/g;function zr(o,u){this.h=this.g=null,this.i=o||null,this.j=!!u}function Mt(o){o.g||(o.g=new Map,o.h=0,o.i&&py(o.i,function(u,h){o.add(decodeURIComponent(u.replace(/\+/g," ")),h)}))}n=zr.prototype,n.add=function(o,u){Mt(this),this.i=null,o=Bn(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(u),this.h+=1,this};function vd(o,u){Mt(o),u=Bn(o,u),o.g.has(u)&&(o.i=null,o.h-=o.g.get(u).length,o.g.delete(u))}function wd(o,u){return Mt(o),u=Bn(o,u),o.g.has(u)}n.forEach=function(o,u){Mt(this),this.g.forEach(function(h,f){h.forEach(function(A){o.call(u,A,f,this)},this)},this)},n.na=function(){Mt(this);let o=Array.from(this.g.values()),u=Array.from(this.g.keys()),h=[];for(let f=0;f<u.length;f++){let A=o[f];for(let R=0;R<A.length;R++)h.push(u[f])}return h},n.V=function(o){Mt(this);let u=[];if(typeof o=="string")wd(this,o)&&(u=u.concat(this.g.get(Bn(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)u=u.concat(o[h])}return u},n.set=function(o,u){return Mt(this),this.i=null,o=Bn(this,o),wd(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[u]),this.h+=1,this},n.get=function(o,u){return o?(o=this.V(o),0<o.length?String(o[0]):u):u};function Td(o,u,h){vd(o,u),0<h.length&&(o.i=null,o.g.set(Bn(o,u),L(h)),o.h+=h.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],u=Array.from(this.g.keys());for(var h=0;h<u.length;h++){var f=u[h];let R=encodeURIComponent(String(f)),N=this.V(f);for(f=0;f<N.length;f++){var A=R;N[f]!==""&&(A+="="+encodeURIComponent(String(N[f]))),o.push(A)}}return this.i=o.join("&")};function Bn(o,u){return u=String(u),o.j&&(u=u.toLowerCase()),u}function Ey(o,u){u&&!o.j&&(Mt(o),o.i=null,o.g.forEach(function(h,f){var A=f.toLowerCase();f!=A&&(vd(this,f),Td(this,A,h))},o)),o.j=u}function vy(o,u){let h=new qr;if(c.Image){let f=new Image;f.onload=S(Ft,h,"TestLoadImage: loaded",!0,u,f),f.onerror=S(Ft,h,"TestLoadImage: error",!1,u,f),f.onabort=S(Ft,h,"TestLoadImage: abort",!1,u,f),f.ontimeout=S(Ft,h,"TestLoadImage: timeout",!1,u,f),c.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=o}else u(!1)}function wy(o,u){let h=new qr,f=new AbortController,A=setTimeout(()=>{f.abort(),Ft(h,"TestPingServer: timeout",!1,u)},1e4);fetch(o,{signal:f.signal}).then(R=>{clearTimeout(A),R.ok?Ft(h,"TestPingServer: ok",!0,u):Ft(h,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(A),Ft(h,"TestPingServer: error",!1,u)})}function Ft(o,u,h,f,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),f(h)}catch{}}function Ty(){this.g=new sy}function Ay(o,u,h){let f=h||"";try{_d(o,function(A,R){let N=A;d(A)&&(N=sa(A)),u.push(f+R+"="+encodeURIComponent(N))})}catch(A){throw u.push(f+"type="+encodeURIComponent("_badmap")),A}}function Hr(o){this.l=o.Ub||null,this.j=o.eb||!1}k(Hr,oa),Hr.prototype.g=function(){return new Xi(this.l,this.j)},Hr.prototype.i=function(o){return function(){return o}}({});function Xi(o,u){Ee.call(this),this.D=o,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(Xi,Ee),n=Xi.prototype,n.open=function(o,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=u,this.readyState=1,Kr(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let u={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(u.body=o),(this.D||c).fetch(new Request(this.A,u)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Gr(this)),this.readyState=0},n.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Kr(this)),this.g&&(this.readyState=3,Kr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ad(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ad(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}n.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var u=o.value?o.value:new Uint8Array(0);(u=this.v.decode(u,{stream:!o.done}))&&(this.response=this.responseText+=u)}o.done?Gr(this):Kr(this),this.readyState==3&&Ad(this)}},n.Ra=function(o){this.g&&(this.response=this.responseText=o,Gr(this))},n.Qa=function(o){this.g&&(this.response=o,Gr(this))},n.ga=function(){this.g&&Gr(this)};function Gr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Kr(o)}n.setRequestHeader=function(o,u){this.u.append(o,u)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],u=this.h.entries();for(var h=u.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=u.next();return o.join(`\r
`)};function Kr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Xi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function bd(o){let u="";return Y(o,function(h,f){u+=f,u+=":",u+=h,u+=`\r
`}),u}function ga(o,u,h){e:{for(f in h){var f=!1;break e}f=!0}f||(h=bd(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):te(o,u,h))}function re(o){Ee.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(re,Ee);var by=/^https?$/i,Sy=["POST","PUT"];n=re.prototype,n.Ha=function(o){this.J=o},n.ea=function(o,u,h,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);u=u?u.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ua.g(),this.v=this.o?ed(this.o):ed(ua),this.g.onreadystatechange=E(this.Ea,this);try{this.B=!0,this.g.open(u,String(o),!0),this.B=!1}catch(R){Sd(this,R);return}if(o=h||"",h=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var A in f)h.set(A,f[A]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let R of f.keys())h.set(R,f.get(R));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(h.keys()).find(R=>R.toLowerCase()=="content-type"),A=c.FormData&&o instanceof c.FormData,!(0<=Array.prototype.indexOf.call(Sy,u,void 0))||f||A||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[R,N]of h)this.g.setRequestHeader(R,N);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Cd(this),this.u=!0,this.g.send(o),this.u=!1}catch(R){Sd(this,R)}};function Sd(o,u){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=u,o.m=5,Rd(o),Zi(o)}function Rd(o){o.A||(o.A=!0,Ce(o,"complete"),Ce(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Ce(this,"complete"),Ce(this,"abort"),Zi(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Zi(this,!0)),re.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Pd(this):this.bb())},n.bb=function(){Pd(this)};function Pd(o){if(o.h&&typeof a<"u"&&(!o.v[1]||pt(o)!=4||o.Z()!=2)){if(o.u&&pt(o)==4)Jh(o.Ea,0,o);else if(Ce(o,"readystatechange"),pt(o)==4){o.h=!1;try{let N=o.Z();e:switch(N){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var h;if(!(h=u)){var f;if(f=N===0){var A=String(o.D).match(yd)[1]||null;!A&&c.self&&c.self.location&&(A=c.self.location.protocol.slice(0,-1)),f=!by.test(A?A.toLowerCase():"")}h=f}if(h)Ce(o,"complete"),Ce(o,"success");else{o.m=6;try{var R=2<pt(o)?o.g.statusText:""}catch{R=""}o.l=R+" ["+o.Z()+"]",Rd(o)}}finally{Zi(o)}}}}function Zi(o,u){if(o.g){Cd(o);let h=o.g,f=o.v[0]?()=>{}:null;o.g=null,o.v=null,u||Ce(o,"ready");try{h.onreadystatechange=f}catch{}}}function Cd(o){o.I&&(c.clearTimeout(o.I),o.I=null)}n.isActive=function(){return!!this.g};function pt(o){return o.g?o.g.readyState:0}n.Z=function(){try{return 2<pt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(o){if(this.g){var u=this.g.responseText;return o&&u.indexOf(o)==0&&(u=u.substring(o.length)),iy(u)}};function kd(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Ry(o){let u={};o=(o.g&&2<=pt(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<o.length;f++){if(U(o[f]))continue;var h=T(o[f]);let A=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let R=u[A]||[];u[A]=R,R.push(h)}w(u,function(f){return f.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Qr(o,u,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||u}function Dd(o){this.Aa=0,this.i=[],this.j=new qr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Qr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Qr("baseRetryDelayMs",5e3,o),this.cb=Qr("retryDelaySeedMs",1e4,o),this.Wa=Qr("forwardChannelMaxRetries",2,o),this.wa=Qr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new dd(o&&o.concurrentRequestLimit),this.Da=new Ty,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Dd.prototype,n.la=8,n.G=1,n.connect=function(o,u,h,f){ke(0),this.W=o,this.H=u||{},h&&f!==void 0&&(this.H.OSID=h,this.H.OAID=f),this.F=this.X,this.I=Bd(this,null,this.W),ts(this)};function _a(o){if(Nd(o),o.G==3){var u=o.U++,h=ft(o.I);if(te(h,"SID",o.K),te(h,"RID",u),te(h,"TYPE","terminate"),Jr(o,h),u=new Vt(o,o.j,u),u.L=2,u.v=Yi(ft(h)),h=!1,c.navigator&&c.navigator.sendBeacon)try{h=c.navigator.sendBeacon(u.v.toString(),"")}catch{}!h&&c.Image&&(new Image().src=u.v,h=!0),h||(u.g=qd(u.j,null),u.g.ea(u.v)),u.F=Date.now(),Ki(u)}Ud(o)}function es(o){o.g&&(Ia(o),o.g.cancel(),o.g=null)}function Nd(o){es(o),o.u&&(c.clearTimeout(o.u),o.u=null),ns(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&c.clearTimeout(o.s),o.s=null)}function ts(o){if(!fd(o.h)&&!o.s){o.s=!0;var u=o.Ga;Or||Wh(),Lr||(Or(),Lr=!0),Jo.add(u,o),o.B=0}}function Py(o,u){return pd(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=u.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=Br(E(o.Ga,o,u),Fd(o,o.B)),o.B++,!0)}n.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let A=new Vt(this,this.j,o),R=this.o;if(this.S&&(R?(R=g(R),v(R,this.S)):R=this.S),this.m!==null||this.O||(A.H=R,R=null),this.P)e:{for(var u=0,h=0;h<this.i.length;h++){t:{var f=this.i[h];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(u+=f,4096<u){u=h;break e}if(u===4096||h===this.i.length-1){u=h+1;break e}}u=1e3}else u=1e3;u=Ld(this,A,u),h=ft(this.I),te(h,"RID",o),te(h,"CVER",22),this.D&&te(h,"X-HTTP-Session-Id",this.D),Jr(this,h),R&&(this.O?u="headers="+encodeURIComponent(String(bd(R)))+"&"+u:this.m&&ga(h,this.m,R)),ma(this.h,A),this.Ua&&te(h,"TYPE","init"),this.P?(te(h,"$req",u),te(h,"SID","null"),A.T=!0,ha(A,h,null)):ha(A,h,u),this.G=2}}else this.G==3&&(o?Od(this,o):this.i.length==0||fd(this.h)||Od(this))};function Od(o,u){var h;u?h=u.l:h=o.U++;let f=ft(o.I);te(f,"SID",o.K),te(f,"RID",h),te(f,"AID",o.T),Jr(o,f),o.m&&o.o&&ga(f,o.m,o.o),h=new Vt(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),u&&(o.i=u.D.concat(o.i)),u=Ld(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),ma(o.h,h),ha(h,f,u)}function Jr(o,u){o.H&&Y(o.H,function(h,f){te(u,f,h)}),o.l&&_d({},function(h,f){te(u,f,h)})}function Ld(o,u,h){h=Math.min(o.i.length,h);var f=o.l?E(o.l.Na,o.l,o):null;e:{var A=o.i;let R=-1;for(;;){let N=["count="+h];R==-1?0<h?(R=A[0].g,N.push("ofs="+R)):R=0:N.push("ofs="+R);let Z=!0;for(let _e=0;_e<h;_e++){let K=A[_e].g,ve=A[_e].map;if(K-=R,0>K)R=Math.max(0,A[_e].g-100),Z=!1;else try{Ay(ve,N,"req"+K+"_")}catch{f&&f(ve)}}if(Z){f=N.join("&");break e}}}return o=o.i.splice(0,h),u.D=o,f}function xd(o){if(!o.g&&!o.u){o.Y=1;var u=o.Fa;Or||Wh(),Lr||(Or(),Lr=!0),Jo.add(u,o),o.v=0}}function ya(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=Br(E(o.Fa,o),Fd(o,o.v)),o.v++,!0)}n.Fa=function(){if(this.u=null,Vd(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=Br(E(this.ab,this),o)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ke(10),es(this),Vd(this))};function Ia(o){o.A!=null&&(c.clearTimeout(o.A),o.A=null)}function Vd(o){o.g=new Vt(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var u=ft(o.qa);te(u,"RID","rpc"),te(u,"SID",o.K),te(u,"AID",o.T),te(u,"CI",o.F?"0":"1"),!o.F&&o.ja&&te(u,"TO",o.ja),te(u,"TYPE","xmlhttp"),Jr(o,u),o.m&&o.o&&ga(u,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=Yi(ft(u)),h.m=null,h.P=!0,ud(h,o)}n.Za=function(){this.C!=null&&(this.C=null,es(this),ya(this),ke(19))};function ns(o){o.C!=null&&(c.clearTimeout(o.C),o.C=null)}function Md(o,u){var h=null;if(o.g==u){ns(o),Ia(o),o.g=null;var f=2}else if(pa(o.h,u))h=u.D,md(o.h,u),f=1;else return;if(o.G!=0){if(u.o)if(f==1){h=u.m?u.m.length:0,u=Date.now()-u.F;var A=o.B;f=zi(),Ce(f,new sd(f,h)),ts(o)}else xd(o);else if(A=u.s,A==3||A==0&&0<u.X||!(f==1&&Py(o,u)||f==2&&ya(o)))switch(h&&0<h.length&&(u=o.h,u.i=u.i.concat(h)),A){case 1:un(o,5);break;case 4:un(o,10);break;case 3:un(o,6);break;default:un(o,2)}}}function Fd(o,u){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*u}function un(o,u){if(o.j.info("Error code "+u),u==2){var h=E(o.fb,o),f=o.Xa;let A=!f;f=new cn(f||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Qi(f,"https"),Yi(f),A?vy(f.toString(),h):wy(f.toString(),h)}else ke(2);o.G=0,o.l&&o.l.sa(u),Ud(o),Nd(o)}n.fb=function(o){o?(this.j.info("Successfully pinged google.com"),ke(2)):(this.j.info("Failed to ping google.com"),ke(1))};function Ud(o){if(o.G=0,o.ka=[],o.l){let u=gd(o.h);(u.length!=0||o.i.length!=0)&&(D(o.ka,u),D(o.ka,o.i),o.h.i.length=0,L(o.i),o.i.length=0),o.l.ra()}}function Bd(o,u,h){var f=h instanceof cn?ft(h):new cn(h);if(f.g!="")u&&(f.g=u+"."+f.g),Ji(f,f.s);else{var A=c.location;f=A.protocol,u=u?u+"."+A.hostname:A.hostname,A=+A.port;var R=new cn(null);f&&Qi(R,f),u&&(R.g=u),A&&Ji(R,A),h&&(R.l=h),f=R}return h=o.D,u=o.ya,h&&u&&te(f,h,u),te(f,"VER",o.la),Jr(o,f),f}function qd(o,u,h){if(u&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return u=o.Ca&&!o.pa?new re(new Hr({eb:h})):new re(o.pa),u.Ha(o.J),u}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function $d(){}n=$d.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function rs(){}rs.prototype.g=function(o,u){return new Le(o,u)};function Le(o,u){Ee.call(this),this.g=new Dd(u),this.l=o,this.h=u&&u.messageUrlParams||null,o=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(o?o["X-WebChannel-Content-Type"]=u.messageContentType:o={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.va&&(o?o["X-WebChannel-Client-Profile"]=u.va:o={"X-WebChannel-Client-Profile":u.va}),this.g.S=o,(o=u&&u.Sb)&&!U(o)&&(this.g.m=o),this.v=u&&u.supportsCrossDomainXhr||!1,this.u=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!U(u)&&(this.g.D=u,o=this.h,o!==null&&u in o&&(o=this.h,u in o&&delete o[u])),this.j=new qn(this)}k(Le,Ee),Le.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Le.prototype.close=function(){_a(this.g)},Le.prototype.o=function(o){var u=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=sa(o),o=h);u.i.push(new hy(u.Ya++,o)),u.G==3&&ts(u)},Le.prototype.N=function(){this.g.l=null,delete this.j,_a(this.g),delete this.g,Le.aa.N.call(this)};function jd(o){aa.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var u=o.__sm__;if(u){e:{for(let h in u){o=h;break e}o=void 0}(this.i=o)&&(o=this.i,u=u!==null&&o in u?u[o]:void 0),this.data=u}else this.data=o}k(jd,aa);function Wd(){ca.call(this),this.status=1}k(Wd,ca);function qn(o){this.g=o}k(qn,$d),qn.prototype.ua=function(){Ce(this.g,"a")},qn.prototype.ta=function(o){Ce(this.g,new jd(o))},qn.prototype.sa=function(o){Ce(this.g,new Wd)},qn.prototype.ra=function(){Ce(this.g,"b")},rs.prototype.createWebChannel=rs.prototype.g,Le.prototype.send=Le.prototype.o,Le.prototype.open=Le.prototype.m,Le.prototype.close=Le.prototype.close,Ru=Ct.createWebChannelTransport=function(){return new rs},Su=Ct.getStatEventTarget=function(){return zi()},bu=Ct.Event=on,no=Ct.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Hi.NO_ERROR=0,Hi.TIMEOUT=8,Hi.HTTP_ERROR=6,vi=Ct.ErrorCode=Hi,od.COMPLETE="complete",Au=Ct.EventType=od,td.EventType=Fr,Fr.OPEN="a",Fr.CLOSE="b",Fr.ERROR="c",Fr.MESSAGE="d",Ee.prototype.listen=Ee.prototype.K,or=Ct.WebChannel=td,$A=Ct.FetchXmlHttpFactory=Hr,re.prototype.listenOnce=re.prototype.L,re.prototype.getLastError=re.prototype.Ka,re.prototype.getLastErrorCode=re.prototype.Ba,re.prototype.getStatus=re.prototype.Z,re.prototype.getResponseJson=re.prototype.Oa,re.prototype.getResponseText=re.prototype.oa,re.prototype.send=re.prototype.ea,re.prototype.setWithCredentials=re.prototype.Ha,Tu=Ct.XhrIo=re}).apply(typeof to<"u"?to:typeof self<"u"?self:typeof window<"u"?window:{});var Cm="@firebase/firestore",km="4.8.0";var me=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};me.UNAUTHENTICATED=new me(null),me.GOOGLE_CREDENTIALS=new me("google-credentials-uid"),me.FIRST_PARTY=new me("first-party-uid"),me.MOCK_USER=new me("mock-user");var Pr="11.10.0";var Pn=new tt("@firebase/firestore");function ar(){return Pn.logLevel}function O(n,...e){if(Pn.logLevel<=z.DEBUG){let t=e.map(yh);Pn.debug(`Firestore (${Pr}): ${n}`,...t)}}function kt(n,...e){if(Pn.logLevel<=z.ERROR){let t=e.map(yh);Pn.error(`Firestore (${Pr}): ${n}`,...t)}}function en(n,...e){if(Pn.logLevel<=z.WARN){let t=e.map(yh);Pn.warn(`Firestore (${Pr}): ${n}`,...t)}}function yh(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function M(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,_g(n,r,t)}function _g(n,e,t){let r=`FIRESTORE (${Pr}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw kt(r),new Error(r)}function J(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||_g(e,i,r)}function B(n,e){return n}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends xe{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var st=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var uo=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Nu=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(me.UNAUTHENTICATED))}shutdown(){}},Ou=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Lu=class{constructor(e){this.t=e,this.currentUser=me.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){J(this.o===void 0,42304);let r=this.i,i=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve(),s=new st;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new st,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let l=s;e.enqueueRetryable(()=>p(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},c=l=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>c(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?c(l):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new st)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(J(typeof r.accessToken=="string",31837,{l:r}),new uo(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return J(e===null||typeof e=="string",2055,{h:e}),new me(e)}},xu=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=me.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},Vu=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new xu(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(me.FIRST_PARTY))}shutdown(){}invalidateToken(){}},lo=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Mu=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Oe(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){J(this.o===void 0,3512);let r=s=>{s.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.m;return this.m=s.token,O("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new lo(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(J(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new lo(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function jA(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}function yg(){return new TextEncoder}var Pi=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=jA(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}};function W(n,e){return n<e?-1:n>e?1:0}function Fu(n,e){let t=0;for(;t<n.length&&t<e.length;){let r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return W(r,i);{let s=yg(),a=WA(s.encode(Dm(n,t)),s.encode(Dm(e,t)));return a!==0?a:W(r,i)}}t+=r>65535?2:1}return W(n.length,e.length)}function Dm(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function WA(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return W(n[t],e[t]);return W(n.length,e.length)}function pr(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var Nm="__name__",ho=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&M(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&M(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=n.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return W(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):Fu(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Pt.fromString(e.substring(4,e.length-2))}},ce=class n extends ho{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new x(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},zA=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Me=class n extends ho{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return zA.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Nm}static keyField(){return new n([Nm])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let c=e[i];if(c==="\\"){if(i+1===e.length)throw new x(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new x(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else c==="`"?(a=!a,i++):c!=="."||a?(r+=c,i++):(s(),i++)}if(s(),a)throw new x(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var F=class n{constructor(e){this.path=e}static fromPath(e){return new n(ce.fromString(e))}static fromName(e){return new n(ce.fromString(e).popFirst(5))}static empty(){return new n(ce.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ce.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ce.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new ce(e.slice()))}};function HA(n,e,t){if(!t)throw new x(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function GA(n,e,t,r){if(e===!0&&r===!0)throw new x(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Om(n){if(!F.isDocumentKey(n))throw new x(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Ig(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Ih(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":M(12329,{type:typeof n})}function Cn(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new x(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Ih(n);throw new x(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function he(n,e){let t={typeString:n};return e&&(t.value=e),t}function Ui(n,e){if(!Ig(n))throw new x(P.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let a=n[r];if(i&&typeof a!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&a!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new x(P.INVALID_ARGUMENT,t);return!0}var Lm=-62135596800,xm=1e6,de=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*xm);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Lm)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/xm}_compareTo(e){return this.seconds===e.seconds?W(this.nanoseconds,e.nanoseconds):W(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ui(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-Lm;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};de._jsonSchemaVersion="firestore/timestamp/1.0",de._jsonSchema={type:he("string",de._jsonSchemaVersion),seconds:he("number"),nanoseconds:he("number")};var q=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new de(0,0))}static max(){return new n(new de(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Ci=-1,Uu=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};Uu.UNKNOWN_ID=-1;function KA(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=q.fromTimestamp(r===1e9?new de(t+1,0):new de(t,r));return new kn(i,F.empty(),e)}function QA(n){return new kn(n.readTime,n.key,Ci)}var kn=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(q.min(),F.empty(),Ci)}static max(){return new n(q.max(),F.empty(),Ci)}};function JA(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=F.comparator(n.documentKey,e.documentKey),t!==0?t:W(n.largestBatchId,e.largestBatchId))}var YA="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Bu=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Cr(n){return p(this,null,function*(){if(n.code!==P.FAILED_PRECONDITION||n.message!==YA)throw n;O("LocalStore","Unexpectedly lost primary lease")})}var C=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&M(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,a=!1;e.forEach(c=>{++i,c.next(()=>{++s,a&&s===i&&t()},l=>r(l))}),a=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,a=new Array(s),c=0;for(let l=0;l<s;l++){let d=l;t(e[d]).next(m=>{a[d]=m,++c,c===s&&r(a)},m=>i(m))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};function XA(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function kr(n){return n.name==="IndexedDbTransactionError"}var Eh=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this._e(i),this.ae=i=>r.writeSequenceNumber(i))}_e(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ae&&this.ae(t),t}}n.ue=-1;return n})(),vh=-1;function $o(n){return n==null}function ki(n){return n===0&&1/n==-1/0}function ZA(n){return typeof n=="number"&&Number.isInteger(n)&&!ki(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var Eg="";function eb(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Vm(e)),e=tb(n.get(t),e);return Vm(e)}function tb(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case Eg:t+="";break;default:t+=s}}return t}function Vm(n){return n+Eg+""}var nb="remoteDocuments",vg="owner";var wg="mutationQueues";var Tg="mutations";var Ag="documentMutations",rb="remoteDocumentsV14";var bg="remoteDocumentGlobal";var Sg="targets";var Rg="targetDocuments";var Pg="targetGlobal",Cg="collectionParents";var kg="clientMetadata";var Dg="bundles";var Ng="namedQueries";var ib="indexConfiguration";var sb="indexState";var ob="indexEntries";var Og="documentOverlays";var ab="globals";var cb=[wg,Tg,Ag,nb,Sg,vg,Pg,Rg,kg,bg,Cg,Dg,Ng],aD=[...cb,Og],ub=[wg,Tg,Ag,rb,Sg,vg,Pg,Rg,kg,bg,Cg,Dg,Ng,Og],lb=ub,hb=[...lb,ib,sb,ob];var cD=[...hb,ab];function Mm(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function sn(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Lg(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var oe=class n{constructor(e,t){this.comparator=e,this.root=t||ot.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ot.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ot.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new hr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new hr(this.root,e,this.comparator,!1)}getReverseIterator(){return new hr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new hr(this.root,e,this.comparator,!0)}},hr=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},ot=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw M(43730,{key:this.key,value:this.value});if(this.right.isRed())throw M(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw M(27949);return e+(this.isRed()?0:1)}};ot.EMPTY=null,ot.RED=!0,ot.BLACK=!1;ot.EMPTY=new class{constructor(){this.size=0}get key(){throw M(57766)}get value(){throw M(16141)}get color(){throw M(16727)}get left(){throw M(29726)}get right(){throw M(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new ot(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var ge=class n{constructor(e){this.comparator=e,this.data=new oe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new fo(this.data.getIterator())}getIteratorFrom(e){return new fo(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},fo=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var $e=class n{constructor(e){this.fields=e,e.sort(Me.comparator)}static empty(){return new n([])}unionWith(e){let t=new ge(Me.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return pr(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var po=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Se=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new po("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return W(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Se.EMPTY_BYTE_STRING=new Se("");var db=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Dt(n){if(J(!!n,39018),typeof n=="string"){let e=0,t=db.exec(n);if(J(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ne(n.seconds),nanos:ne(n.nanos)}}function ne(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Nt(n){return typeof n=="string"?Se.fromBase64String(n):Se.fromUint8Array(n)}var xg="server_timestamp",Vg="__type__",Mg="__previous_value__",Fg="__local_write_time__";function wh(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Vg])===null||t===void 0?void 0:t.stringValue)===xg}function jo(n){let e=n.mapValue.fields[Mg];return wh(e)?jo(e):e}function Di(n){let e=Dt(n.mapValue.fields[Fg].timestampValue);return new de(e.seconds,e.nanos)}var qu=class{constructor(e,t,r,i,s,a,c,l,d,m){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=l,this.useFetchStreams=d,this.isUsingEmulator=m}},mo="(default)",go=class n{constructor(e,t){this.projectId=e,this.database=t||mo}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===mo}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Th="__type__",Ug="__max__",ro={mapValue:{fields:{__type__:{stringValue:Ug}}}},Ah="__vector__",mr="value";function tn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?wh(n)?4:qg(n)?9007199254740991:Bg(n)?10:11:M(28295,{value:n})}function ut(n,e){if(n===e)return!0;let t=tn(n);if(t!==tn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Di(n).isEqual(Di(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=Dt(i.timestampValue),c=Dt(s.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return Nt(i.bytesValue).isEqual(Nt(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return ne(i.geoPointValue.latitude)===ne(s.geoPointValue.latitude)&&ne(i.geoPointValue.longitude)===ne(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ne(i.integerValue)===ne(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=ne(i.doubleValue),c=ne(s.doubleValue);return a===c?ki(a)===ki(c):isNaN(a)&&isNaN(c)}return!1}(n,e);case 9:return pr(n.arrayValue.values||[],e.arrayValue.values||[],ut);case 10:case 11:return function(i,s){let a=i.mapValue.fields||{},c=s.mapValue.fields||{};if(Mm(a)!==Mm(c))return!1;for(let l in a)if(a.hasOwnProperty(l)&&(c[l]===void 0||!ut(a[l],c[l])))return!1;return!0}(n,e);default:return M(52216,{left:n})}}function Ni(n,e){return(n.values||[]).find(t=>ut(t,e))!==void 0}function gr(n,e){if(n===e)return 0;let t=tn(n),r=tn(e);if(t!==r)return W(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return W(n.booleanValue,e.booleanValue);case 2:return function(s,a){let c=ne(s.integerValue||s.doubleValue),l=ne(a.integerValue||a.doubleValue);return c<l?-1:c>l?1:c===l?0:isNaN(c)?isNaN(l)?0:-1:1}(n,e);case 3:return Fm(n.timestampValue,e.timestampValue);case 4:return Fm(Di(n),Di(e));case 5:return Fu(n.stringValue,e.stringValue);case 6:return function(s,a){let c=Nt(s),l=Nt(a);return c.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(s,a){let c=s.split("/"),l=a.split("/");for(let d=0;d<c.length&&d<l.length;d++){let m=W(c[d],l[d]);if(m!==0)return m}return W(c.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,a){let c=W(ne(s.latitude),ne(a.latitude));return c!==0?c:W(ne(s.longitude),ne(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Um(n.arrayValue,e.arrayValue);case 10:return function(s,a){var c,l,d,m;let I=s.fields||{},E=a.fields||{},S=(c=I[mr])===null||c===void 0?void 0:c.arrayValue,k=(l=E[mr])===null||l===void 0?void 0:l.arrayValue,L=W(((d=S?.values)===null||d===void 0?void 0:d.length)||0,((m=k?.values)===null||m===void 0?void 0:m.length)||0);return L!==0?L:Um(S,k)}(n.mapValue,e.mapValue);case 11:return function(s,a){if(s===ro.mapValue&&a===ro.mapValue)return 0;if(s===ro.mapValue)return 1;if(a===ro.mapValue)return-1;let c=s.fields||{},l=Object.keys(c),d=a.fields||{},m=Object.keys(d);l.sort(),m.sort();for(let I=0;I<l.length&&I<m.length;++I){let E=Fu(l[I],m[I]);if(E!==0)return E;let S=gr(c[l[I]],d[m[I]]);if(S!==0)return S}return W(l.length,m.length)}(n.mapValue,e.mapValue);default:throw M(23264,{le:t})}}function Fm(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return W(n,e);let t=Dt(n),r=Dt(e),i=W(t.seconds,r.seconds);return i!==0?i:W(t.nanos,r.nanos)}function Um(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=gr(t[i],r[i]);if(s)return s}return W(t.length,r.length)}function _r(n){return $u(n)}function $u(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=Dt(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Nt(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return F.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=$u(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let a of r)s?s=!1:i+=",",i+=`${a}:${$u(t.fields[a])}`;return i+"}"}(n.mapValue):M(61005,{value:n})}function oo(n){switch(tn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=jo(n);return e?16+oo(e):16;case 5:return 2*n.stringValue.length;case 6:return Nt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,s)=>i+oo(s),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return sn(r.fields,(s,a)=>{i+=s.length+oo(a)}),i}(n.mapValue);default:throw M(13486,{value:n})}}function ju(n){return!!n&&"integerValue"in n}function bh(n){return!!n&&"arrayValue"in n}function Bm(n){return!!n&&"nullValue"in n}function qm(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ao(n){return!!n&&"mapValue"in n}function Bg(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Th])===null||t===void 0?void 0:t.stringValue)===Ah}function Ti(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return sn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ti(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ti(n.arrayValue.values[t]);return e}return Object.assign({},n)}function qg(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Ug}var lD={mapValue:{fields:{[Th]:{stringValue:Ah},[mr]:{arrayValue:{}}}}};var Ve=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ao(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ti(t)}setAll(e){let t=Me.emptyPath(),r={},i=[];e.forEach((a,c)=>{if(!t.isImmediateParentOf(c)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=c.popLast()}a?r[c.lastSegment()]=Ti(a):i.push(c.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());ao(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ut(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];ao(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){sn(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Ti(this.value))}};function $g(n){let e=[];return sn(n.fields,(t,r)=>{let i=new Me([t]);if(ao(r)){let s=$g(r.mapValue).fields;if(s.length===0)e.push(i);else for(let a of s)e.push(i.child(a))}else e.push(i)}),new $e(e)}var Ye=class n{constructor(e,t,r,i,s,a,c){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=c}static newInvalidDocument(e){return new n(e,0,q.min(),q.min(),q.min(),Ve.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,q.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,q.min(),q.min(),Ve.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,q.min(),q.min(),Ve.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(q.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ve.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ve.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var yr=class{constructor(e,t){this.position=e,this.inclusive=t}};function $m(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],a=n.position[i];if(s.field.isKeyField()?r=F.comparator(F.fromName(a.referenceValue),t.key):r=gr(a,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function jm(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ut(n.position[t],e.position[t]))return!1;return!0}var Ir=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function fb(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var _o=class{},fe=class n extends _o{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new zu(e,t,r):t==="array-contains"?new Ku(e,r):t==="in"?new Qu(e,r):t==="not-in"?new Ju(e,r):t==="array-contains-any"?new Yu(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Hu(e,r):new Gu(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(gr(t,this.value)):t!==null&&tn(this.value)===tn(t)&&this.matchesComparison(gr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return M(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},lt=class n extends _o{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new n(e,t)}matches(e){return jg(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};function jg(n){return n.op==="and"}function Wg(n){return pb(n)&&jg(n)}function pb(n){for(let e of n.filters)if(e instanceof lt)return!1;return!0}function Wu(n){if(n instanceof fe)return n.field.canonicalString()+n.op.toString()+_r(n.value);if(Wg(n))return n.filters.map(e=>Wu(e)).join(",");{let e=n.filters.map(t=>Wu(t)).join(",");return`${n.op}(${e})`}}function zg(n,e){return n instanceof fe?function(r,i){return i instanceof fe&&r.op===i.op&&r.field.isEqual(i.field)&&ut(r.value,i.value)}(n,e):n instanceof lt?function(r,i){return i instanceof lt&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,a,c)=>s&&zg(a,i.filters[c]),!0):!1}(n,e):void M(19439)}function Hg(n){return n instanceof fe?function(t){return`${t.field.canonicalString()} ${t.op} ${_r(t.value)}`}(n):n instanceof lt?function(t){return t.op.toString()+" {"+t.getFilters().map(Hg).join(" ,")+"}"}(n):"Filter"}var zu=class extends fe{constructor(e,t,r){super(e,t,r),this.key=F.fromName(r.referenceValue)}matches(e){let t=F.comparator(e.key,this.key);return this.matchesComparison(t)}},Hu=class extends fe{constructor(e,t){super(e,"in",t),this.keys=Gg("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Gu=class extends fe{constructor(e,t){super(e,"not-in",t),this.keys=Gg("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Gg(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>F.fromName(r.referenceValue))}var Ku=class extends fe{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return bh(t)&&Ni(t.arrayValue,this.value)}},Qu=class extends fe{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Ni(this.value.arrayValue,t)}},Ju=class extends fe{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ni(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Ni(this.value.arrayValue,t)}},Yu=class extends fe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!bh(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Ni(this.value.arrayValue,r))}};var Xu=class{constructor(e,t=null,r=[],i=[],s=null,a=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=c,this.Pe=null}};function Wm(n,e=null,t=[],r=[],i=null,s=null,a=null){return new Xu(n,e,t,r,i,s,a)}function Sh(n){let e=B(n);if(e.Pe===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Wu(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),$o(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>_r(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>_r(r)).join(",")),e.Pe=t}return e.Pe}function Rh(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!fb(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!zg(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!jm(n.startAt,e.startAt)&&jm(n.endAt,e.endAt)}function Zu(n){return F.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var Er=class{constructor(e,t=null,r=[],i=[],s=null,a="F",c=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=c,this.endAt=l,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};function mb(n,e,t,r,i,s,a,c){return new Er(n,e,t,r,i,s,a,c)}function Ph(n){return new Er(n)}function zm(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function gb(n){return n.collectionGroup!==null}function Ai(n){let e=B(n);if(e.Te===null){e.Te=[];let t=new Set;for(let s of e.explicitOrderBy)e.Te.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new ge(Me.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(d=>{d.isInequality()&&(c=c.add(d.field))})}),c})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Te.push(new Ir(s,r))}),t.has(Me.keyField().canonicalString())||e.Te.push(new Ir(Me.keyField(),r))}return e.Te}function at(n){let e=B(n);return e.Ie||(e.Ie=_b(e,Ai(n))),e.Ie}function _b(n,e){if(n.limitType==="F")return Wm(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Ir(i.field,s)});let t=n.endAt?new yr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new yr(n.startAt.position,n.startAt.inclusive):null;return Wm(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function el(n,e,t){return new Er(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Wo(n,e){return Rh(at(n),at(e))&&n.limitType===e.limitType}function Kg(n){return`${Sh(at(n))}|lt:${n.limitType}`}function cr(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Hg(i)).join(", ")}]`),$o(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>_r(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>_r(i)).join(",")),`Target(${r})`}(at(n))}; limitType=${n.limitType})`}function zo(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):F.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of Ai(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(a,c,l){let d=$m(a,c,l);return a.inclusive?d<=0:d<0}(r.startAt,Ai(r),i)||r.endAt&&!function(a,c,l){let d=$m(a,c,l);return a.inclusive?d>=0:d>0}(r.endAt,Ai(r),i))}(n,e)}function yb(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Qg(n){return(e,t)=>{let r=!1;for(let i of Ai(n)){let s=Ib(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function Ib(n,e,t){let r=n.field.isKeyField()?F.comparator(e.key,t.key):function(s,a,c){let l=a.data.field(s),d=c.data.field(s);return l!==null&&d!==null?gr(l,d):M(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return M(19790,{direction:n.dir})}}var Ot=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){sn(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return Lg(this.inner)}size(){return this.innerSize}};var Eb=new oe(F.comparator);function Lt(){return Eb}var Jg=new oe(F.comparator);function wi(...n){let e=Jg;for(let t of n)e=e.insert(t.key,t);return e}function Yg(n){let e=Jg;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function An(){return bi()}function Xg(){return bi()}function bi(){return new Ot(n=>n.toString(),(n,e)=>n.isEqual(e))}var vb=new oe(F.comparator),wb=new ge(F.comparator);function H(...n){let e=wb;for(let t of n)e=e.add(t);return e}var Tb=new ge(W);function Ab(){return Tb}function Ch(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ki(e)?"-0":e}}function Zg(n){return{integerValue:""+n}}function bb(n,e){return ZA(e)?Zg(e):Ch(n,e)}var vr=class{constructor(){this._=void 0}};function Sb(n,e,t){return n instanceof Dn?function(i,s){let a={fields:{[Vg]:{stringValue:xg},[Fg]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&wh(s)&&(s=jo(s)),s&&(a.fields[Mg]=s),{mapValue:a}}(t,e):n instanceof Nn?t_(n,e):n instanceof On?n_(n,e):function(i,s){let a=e_(i,s),c=Hm(a)+Hm(i.Ee);return ju(a)&&ju(i.Ee)?Zg(c):Ch(i.serializer,c)}(n,e)}function Rb(n,e,t){return n instanceof Nn?t_(n,e):n instanceof On?n_(n,e):t}function e_(n,e){return n instanceof wr?function(r){return ju(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var Dn=class extends vr{},Nn=class extends vr{constructor(e){super(),this.elements=e}};function t_(n,e){let t=r_(e);for(let r of n.elements)t.some(i=>ut(i,r))||t.push(r);return{arrayValue:{values:t}}}var On=class extends vr{constructor(e){super(),this.elements=e}};function n_(n,e){let t=r_(e);for(let r of n.elements)t=t.filter(i=>!ut(i,r));return{arrayValue:{values:t}}}var wr=class extends vr{constructor(e,t){super(),this.serializer=e,this.Ee=t}};function Hm(n){return ne(n.integerValue||n.doubleValue)}function r_(n){return bh(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var tl=class{constructor(e,t){this.field=e,this.transform=t}};function Pb(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Nn&&i instanceof Nn||r instanceof On&&i instanceof On?pr(r.elements,i.elements,ut):r instanceof wr&&i instanceof wr?ut(r.Ee,i.Ee):r instanceof Dn&&i instanceof Dn}(n.transform,e.transform)}var nl=class{constructor(e,t){this.version=e,this.transformResults=t}},Jt=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function co(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Tr=class{};function i_(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new yo(n.key,Jt.none()):new Ln(n.key,n.data,Jt.none());{let t=n.data,r=Ve.empty(),i=new ge(Me.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?r.delete(s):r.set(s,a),i=i.add(s)}return new ht(n.key,r,new $e(i.toArray()),Jt.none())}}function Cb(n,e,t){n instanceof Ln?function(i,s,a){let c=i.value.clone(),l=Km(i.fieldTransforms,s,a.transformResults);c.setAll(l),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(n,e,t):n instanceof ht?function(i,s,a){if(!co(i.precondition,s))return void s.convertToUnknownDocument(a.version);let c=Km(i.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(s_(i)),l.setAll(c),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,e,t):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Si(n,e,t,r){return n instanceof Ln?function(s,a,c,l){if(!co(s.precondition,a))return c;let d=s.value.clone(),m=Qm(s.fieldTransforms,l,a);return d.setAll(m),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(n,e,t,r):n instanceof ht?function(s,a,c,l){if(!co(s.precondition,a))return c;let d=Qm(s.fieldTransforms,l,a),m=a.data;return m.setAll(s_(s)),m.setAll(d),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),c===null?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(I=>I.field))}(n,e,t,r):function(s,a,c){return co(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c}(n,e,t)}function kb(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=e_(r.transform,i||null);s!=null&&(t===null&&(t=Ve.empty()),t.set(r.field,s))}return t||null}function Gm(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&pr(r,i,(s,a)=>Pb(s,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Ln=class extends Tr{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},ht=class extends Tr{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function s_(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function Km(n,e,t){let r=new Map;J(n.length===t.length,32656,{Ae:t.length,Re:n.length});for(let i=0;i<t.length;i++){let s=n[i],a=s.transform,c=e.data.field(s.field);r.set(s.field,Rb(a,c,t[i]))}return r}function Qm(n,e,t){let r=new Map;for(let i of n){let s=i.transform,a=t.data.field(i.field);r.set(i.field,Sb(s,a,e))}return r}var yo=class extends Tr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},rl=class extends Tr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var il=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&Cb(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Si(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Si(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=Xg();return this.mutations.forEach(i=>{let s=e.get(i.key),a=s.overlayedDocument,c=this.applyToLocalView(a,s.mutatedFields);c=t.has(i.key)?null:c;let l=i_(a,c);l!==null&&r.set(i.key,l),a.isValidDocument()||a.convertToNoDocument(q.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),H())}isEqual(e){return this.batchId===e.batchId&&pr(this.mutations,e.mutations,(t,r)=>Gm(t,r))&&pr(this.baseMutations,e.baseMutations,(t,r)=>Gm(t,r))}},sl=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){J(e.mutations.length===r.length,58842,{Ve:e.mutations.length,me:r.length});let i=function(){return vb}(),s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new n(e,t,r,i)}};var ol=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var al=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var ue,G;function Db(n){switch(n){case P.OK:return M(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return M(15467,{code:n})}}function o_(n){if(n===void 0)return kt("GRPC error has no .code"),P.UNKNOWN;switch(n){case ue.OK:return P.OK;case ue.CANCELLED:return P.CANCELLED;case ue.UNKNOWN:return P.UNKNOWN;case ue.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case ue.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case ue.INTERNAL:return P.INTERNAL;case ue.UNAVAILABLE:return P.UNAVAILABLE;case ue.UNAUTHENTICATED:return P.UNAUTHENTICATED;case ue.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case ue.NOT_FOUND:return P.NOT_FOUND;case ue.ALREADY_EXISTS:return P.ALREADY_EXISTS;case ue.PERMISSION_DENIED:return P.PERMISSION_DENIED;case ue.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case ue.ABORTED:return P.ABORTED;case ue.OUT_OF_RANGE:return P.OUT_OF_RANGE;case ue.UNIMPLEMENTED:return P.UNIMPLEMENTED;case ue.DATA_LOSS:return P.DATA_LOSS;default:return M(39323,{code:n})}}(G=ue||(ue={}))[G.OK=0]="OK",G[G.CANCELLED=1]="CANCELLED",G[G.UNKNOWN=2]="UNKNOWN",G[G.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",G[G.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",G[G.NOT_FOUND=5]="NOT_FOUND",G[G.ALREADY_EXISTS=6]="ALREADY_EXISTS",G[G.PERMISSION_DENIED=7]="PERMISSION_DENIED",G[G.UNAUTHENTICATED=16]="UNAUTHENTICATED",G[G.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",G[G.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",G[G.ABORTED=10]="ABORTED",G[G.OUT_OF_RANGE=11]="OUT_OF_RANGE",G[G.UNIMPLEMENTED=12]="UNIMPLEMENTED",G[G.INTERNAL=13]="INTERNAL",G[G.UNAVAILABLE=14]="UNAVAILABLE",G[G.DATA_LOSS=15]="DATA_LOSS";var Jm=null;var Nb=new Pt([4294967295,4294967295],0);function Ym(n){let e=yg().encode(n),t=new wu;return t.update(e),new Uint8Array(t.digest())}function Xm(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Pt([t,r],0),new Pt([i,s],0)]}var cl=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new bn(`Invalid padding: ${t}`);if(r<0)throw new bn(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new bn(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new bn(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=Pt.fromNumber(this.fe)}pe(e,t,r){let i=e.add(t.multiply(Pt.fromNumber(r)));return i.compare(Nb)===1&&(i=new Pt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;let t=Ym(e),[r,i]=Xm(t);for(let s=0;s<this.hashCount;s++){let a=this.pe(r,i,s);if(!this.ye(a))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new n(s,i,t);return r.forEach(c=>a.insert(c)),a}insert(e){if(this.fe===0)return;let t=Ym(e),[r,i]=Xm(t);for(let s=0;s<this.hashCount;s++){let a=this.pe(r,i,s);this.we(a)}}we(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},bn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Io=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Oi.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(q.min(),i,new oe(W),Lt(),H())}},Oi=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,H(),H(),H())}};var dr=class{constructor(e,t,r,i){this.Se=e,this.removedTargetIds=t,this.key=r,this.be=i}},Eo=class{constructor(e,t){this.targetId=e,this.De=t}},vo=class{constructor(e,t,r=Se.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},wo=class{constructor(){this.ve=0,this.Ce=Zm(),this.Fe=Se.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=H(),t=H(),r=H();return this.Ce.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:M(38017,{changeType:s})}}),new Oi(this.Fe,this.Me,e,t,r)}ke(){this.xe=!1,this.Ce=Zm()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,J(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},ul=class{constructor(e){this.We=e,this.Ge=new Map,this.ze=Lt(),this.je=io(),this.Je=io(),this.He=new oe(W)}Ye(e){for(let t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(let t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{let r=this.tt(t);switch(e.state){case 0:this.nt(t)&&r.Be(e.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(e.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(r.Ke(),r.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),r.Be(e.resumeToken));break;default:M(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((r,i)=>{this.nt(i)&&t(i)})}it(e){let t=e.targetId,r=e.De.count,i=this.st(t);if(i){let s=i.target;if(Zu(s))if(r===0){let a=new F(s.path);this.Xe(t,a,Ye.newNoDocument(a,q.min()))}else J(r===1,20013,{expectedCount:r});else{let a=this.ot(t);if(a!==r){let c=this._t(e),l=c?this.ut(c,e,a):1;if(l!==0){this.rt(t);let d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,d)}Jm?.ct(function(m,I,E,S,k){var L,D,$,U,j,X;let Pe={localCacheCount:m,existenceFilterCount:I.count,databaseId:E.database,projectId:E.projectId},Y=I.unchangedNames;return Y&&(Pe.bloomFilter={applied:k===0,hashCount:(L=Y?.hashCount)!==null&&L!==void 0?L:0,bitmapLength:(U=($=(D=Y?.bits)===null||D===void 0?void 0:D.bitmap)===null||$===void 0?void 0:$.length)!==null&&U!==void 0?U:0,padding:(X=(j=Y?.bits)===null||j===void 0?void 0:j.padding)!==null&&X!==void 0?X:0,mightContain:w=>{var g;return(g=S?.mightContain(w))!==null&&g!==void 0&&g}}),Pe}(a,e.De,this.We.lt(),c,l))}}}}_t(e){let t=e.De.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,a,c;try{a=Nt(r).toUint8Array()}catch(l){if(l instanceof po)return en("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{c=new cl(a,i,s)}catch(l){return en(l instanceof bn?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return c.fe===0?null:c}ut(e,t,r){return t.De.count===r-this.ht(e,t.targetId)?0:2}ht(e,t){let r=this.We.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let a=this.We.lt(),c=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.Xe(t,s,null),i++)}),i}Pt(e){let t=new Map;this.Ge.forEach((s,a)=>{let c=this.st(a);if(c){if(s.current&&Zu(c.target)){let l=new F(c.target.path);this.Tt(l).has(a)||this.It(a,l)||this.Xe(a,l,Ye.newNoDocument(l,e))}s.Ne&&(t.set(a,s.Le()),s.ke())}});let r=H();this.Je.forEach((s,a)=>{let c=!0;a.forEachWhile(l=>{let d=this.st(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(r=r.add(s))}),this.ze.forEach((s,a)=>a.setReadTime(e));let i=new Io(e,t,this.He,this.ze,r);return this.ze=Lt(),this.je=io(),this.Je=io(),this.He=new oe(W),i}Ze(e,t){if(!this.nt(e))return;let r=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,r),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,r){if(!this.nt(e))return;let i=this.tt(e);this.It(e,t)?i.qe(t,1):i.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),r&&(this.ze=this.ze.insert(t,r))}removeTarget(e){this.Ge.delete(e)}ot(e){let t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new wo,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new ge(W),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new ge(W),this.je=this.je.insert(e,t)),t}nt(e){let t=this.st(e)!==null;return t||O("WatchChangeAggregator","Detected inactive target",e),t}st(e){let t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new wo),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}};function io(){return new oe(F.comparator)}function Zm(){return new oe(F.comparator)}var Ob={asc:"ASCENDING",desc:"DESCENDING"},Lb={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},xb={and:"AND",or:"OR"},ll=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function hl(n,e){return n.useProto3Json||$o(e)?e:{value:e}}function To(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function a_(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Vb(n,e){return To(n,e.toTimestamp())}function ct(n){return J(!!n,49232),q.fromTimestamp(function(t){let r=Dt(t);return new de(r.seconds,r.nanos)}(n))}function kh(n,e){return dl(n,e).canonicalString()}function dl(n,e){let t=function(i){return new ce(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function c_(n){let e=ce.fromString(n);return J(f_(e),10190,{key:e.toString()}),e}function fl(n,e){return kh(n.databaseId,e.path)}function Pu(n,e){let t=c_(e);if(t.get(1)!==n.databaseId.projectId)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new F(l_(t))}function u_(n,e){return kh(n.databaseId,e)}function Mb(n){let e=c_(n);return e.length===4?ce.emptyPath():l_(e)}function pl(n){return new ce(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function l_(n){return J(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function eg(n,e,t){return{name:fl(n,e),fields:t.value.mapValue.fields}}function Fb(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:M(39313,{state:d})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(d,m){return d.useProto3Json?(J(m===void 0||typeof m=="string",58123),Se.fromBase64String(m||"")):(J(m===void 0||m instanceof Buffer||m instanceof Uint8Array,16193),Se.fromUint8Array(m||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&function(d){let m=d.code===void 0?P.UNKNOWN:o_(d.code);return new x(m,d.message||"")}(a);t=new vo(r,i,s,c||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Pu(n,r.document.name),s=ct(r.document.updateTime),a=r.document.createTime?ct(r.document.createTime):q.min(),c=new Ve({mapValue:{fields:r.document.fields}}),l=Ye.newFoundDocument(i,s,a,c),d=r.targetIds||[],m=r.removedTargetIds||[];t=new dr(d,m,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Pu(n,r.document),s=r.readTime?ct(r.readTime):q.min(),a=Ye.newNoDocument(i,s),c=r.removedTargetIds||[];t=new dr([],c,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Pu(n,r.document),s=r.removedTargetIds||[];t=new dr([],s,i,null)}else{if(!("filter"in e))return M(11601,{At:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,a=new al(i,s),c=r.targetId;t=new Eo(c,a)}}return t}function Ub(n,e){let t;if(e instanceof Ln)t={update:eg(n,e.key,e.value)};else if(e instanceof yo)t={delete:fl(n,e.key)};else if(e instanceof ht)t={update:eg(n,e.key,e.data),updateMask:Kb(e.fieldMask)};else{if(!(e instanceof rl))return M(16599,{Rt:e.type});t={verify:fl(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,a){let c=a.transform;if(c instanceof Dn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Nn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof On)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof wr)return{fieldPath:a.field.canonicalString(),increment:c.Ee};throw M(20930,{transform:a.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:Vb(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:M(27497)}(n,e.precondition)),t}function Bb(n,e){return n&&n.length>0?(J(e!==void 0,14353),n.map(t=>function(i,s){let a=i.updateTime?ct(i.updateTime):ct(s);return a.isEqual(q.min())&&(a=ct(s)),new nl(a,i.transformResults||[])}(t,e))):[]}function qb(n,e){return{documents:[u_(n,e.path)]}}function $b(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=u_(n,i);let s=function(d){if(d.length!==0)return d_(lt.create(d,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let a=function(d){if(d.length!==0)return d.map(m=>function(E){return{field:ur(E.field),direction:zb(E.dir)}}(m))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);let c=hl(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{Vt:t,parent:i}}function jb(n){let e=Mb(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){J(r===1,65062);let m=t.from[0];m.allDescendants?i=m.collectionId:e=e.child(m.collectionId)}let s=[];t.where&&(s=function(I){let E=h_(I);return E instanceof lt&&Wg(E)?E.getFilters():[E]}(t.where));let a=[];t.orderBy&&(a=function(I){return I.map(E=>function(k){return new Ir(lr(k.field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(k.direction))}(E))}(t.orderBy));let c=null;t.limit&&(c=function(I){let E;return E=typeof I=="object"?I.value:I,$o(E)?null:E}(t.limit));let l=null;t.startAt&&(l=function(I){let E=!!I.before,S=I.values||[];return new yr(S,E)}(t.startAt));let d=null;return t.endAt&&(d=function(I){let E=!I.before,S=I.values||[];return new yr(S,E)}(t.endAt)),mb(e,i,a,s,c,"F",l,d)}function Wb(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return M(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function h_(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=lr(t.unaryFilter.field);return fe.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=lr(t.unaryFilter.field);return fe.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=lr(t.unaryFilter.field);return fe.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=lr(t.unaryFilter.field);return fe.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return M(61313);default:return M(60726)}}(n):n.fieldFilter!==void 0?function(t){return fe.create(lr(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return M(58110);default:return M(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return lt.create(t.compositeFilter.filters.map(r=>h_(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return M(1026)}}(t.compositeFilter.op))}(n):M(30097,{filter:n})}function zb(n){return Ob[n]}function Hb(n){return Lb[n]}function Gb(n){return xb[n]}function ur(n){return{fieldPath:n.canonicalString()}}function lr(n){return Me.fromServerFormat(n.fieldPath)}function d_(n){return n instanceof fe?function(t){if(t.op==="=="){if(qm(t.value))return{unaryFilter:{field:ur(t.field),op:"IS_NAN"}};if(Bm(t.value))return{unaryFilter:{field:ur(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(qm(t.value))return{unaryFilter:{field:ur(t.field),op:"IS_NOT_NAN"}};if(Bm(t.value))return{unaryFilter:{field:ur(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ur(t.field),op:Hb(t.op),value:t.value}}}(n):n instanceof lt?function(t){let r=t.getFilters().map(i=>d_(i));return r.length===1?r[0]:{compositeFilter:{op:Gb(t.op),filters:r}}}(n):M(54877,{filter:n})}function Kb(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function f_(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Li=class n{constructor(e,t,r,i,s=q.min(),a=q.min(),c=Se.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var ml=class{constructor(e){this.gt=e}};function Qb(n){let e=jb({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?el(e,e.limit,"L"):e}var Ao=class{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(ne(e.integerValue));else if("doubleValue"in e){let r=ne(e.doubleValue);isNaN(r)?this.Ct(t,13):(this.Ct(t,15),ki(r)?t.Ft(0):t.Ft(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ct(t,20),typeof r=="string"&&(r=Dt(r)),t.Mt(`${r.seconds||""}`),t.Ft(r.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(Nt(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ct(t,45),t.Ft(r.latitude||0),t.Ft(r.longitude||0)}else"mapValue"in e?qg(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):Bg(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):M(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){let r=e.fields||{};this.Ct(t,55);for(let i of Object.keys(r))this.xt(i,t),this.Dt(r[i],t)}Lt(e,t){var r,i;let s=e.fields||{};this.Ct(t,53);let a=mr,c=((i=(r=s[a].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.Ct(t,15),t.Ft(ne(c)),this.xt(a,t),this.Dt(s[a],t)}qt(e,t){let r=e.values||[];this.Ct(t,50);for(let i of r)this.Dt(i,t)}Bt(e,t){this.Ct(t,37),F.fromName(e).path.forEach(r=>{this.Ct(t,60),this.$t(r,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}};Ao.Ut=new Ao;var gl=class{constructor(){this.Dn=new _l}addToCollectionParentIndex(e,t){return this.Dn.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(kn.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(kn.min())}updateCollectionGroup(e,t,r){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}},_l=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ge(ce.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ge(ce.comparator)).toArray()}};var hD=new Uint8Array(0);var tg={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},p_=41943040,qe=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};qe.DEFAULT_COLLECTION_PERCENTILE=10,qe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,qe.DEFAULT=new qe(p_,qe.DEFAULT_COLLECTION_PERCENTILE,qe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),qe.DISABLED=new qe(-1,0,0);var xi=class n{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new n(0)}static ur(){return new n(-1)}};var ng="LruGarbageCollector",Jb=1048576;function rg([n,e],[t,r]){let i=W(n,t);return i===0?W(e,r):i}var yl=class{constructor(e){this.Tr=e,this.buffer=new ge(rg),this.Ir=0}dr(){return++this.Ir}Er(e){let t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();rg(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},Il=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){O(ng,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>p(this,null,function*(){this.Ar=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){kr(t)?O(ng,"Ignoring IndexedDB error during garbage collection: ",t):yield Cr(t)}yield this.Rr(3e5)}))}},El=class{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return C.resolve(Eh.ue);let r=new yl(t);return this.Vr.forEachTarget(e,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.gr(e,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(O("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(tg)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),tg):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let r,i,s,a,c,l,d,m=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(I=>(I>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),i=this.params.maximumSequenceNumbersToCollect):i=I,a=Date.now(),this.nthSequenceNumber(e,i))).next(I=>(r=I,c=Date.now(),this.removeTargets(e,r,t))).next(I=>(s=I,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(I=>(d=Date.now(),ar()<=z.DEBUG&&O("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-m}ms
	Determined least recently used ${i} in `+(c-a)+`ms
	Removed ${s} targets in `+(l-c)+`ms
	Removed ${I} documents in `+(d-l)+`ms
Total Duration: ${d-m}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:I})))}};function Yb(n,e){return new El(n,e)}var vl=class{constructor(){this.changes=new Ot(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ye.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?C.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var wl=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Tl=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Si(r.mutation,i,$e.empty(),de.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,H()).next(()=>r))}getLocalViewOfDocuments(e,t,r=H()){let i=An();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let a=wi();return s.forEach((c,l)=>{a=a.insert(c,l.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=An();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,H()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,c)=>{t.set(a,c)})})}computeViews(e,t,r,i){let s=Lt(),a=bi(),c=function(){return bi()}();return t.forEach((l,d)=>{let m=r.get(d.key);i.has(d.key)&&(m===void 0||m.mutation instanceof ht)?s=s.insert(d.key,d):m!==void 0?(a.set(d.key,m.mutation.getFieldMask()),Si(m.mutation,d,m.mutation.getFieldMask(),de.now())):a.set(d.key,$e.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((d,m)=>a.set(d,m)),t.forEach((d,m)=>{var I;return c.set(d,new wl(m,(I=a.get(d))!==null&&I!==void 0?I:null))}),c))}recalculateAndSaveOverlays(e,t){let r=bi(),i=new oe((a,c)=>a-c),s=H();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let c of a)c.keys().forEach(l=>{let d=t.get(l);if(d===null)return;let m=r.get(l)||$e.empty();m=c.applyToLocalView(d,m),r.set(l,m);let I=(i.get(c.batchId)||H()).add(l);i=i.insert(c.batchId,I)})}).next(()=>{let a=[],c=i.getReverseIterator();for(;c.hasNext();){let l=c.getNext(),d=l.key,m=l.value,I=Xg();m.forEach(E=>{if(!s.has(E)){let S=i_(t.get(E),r.get(E));S!==null&&I.set(E,S),s=s.add(E)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,I))}return C.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(a){return F.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):gb(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):C.resolve(An()),c=Ci,l=s;return a.next(d=>C.forEach(d,(m,I)=>(c<I.largestBatchId&&(c=I.largestBatchId),s.get(m)?C.resolve():this.remoteDocumentCache.getEntry(e,m).next(E=>{l=l.insert(m,E)}))).next(()=>this.populateOverlays(e,d,s)).next(()=>this.computeViews(e,l,d,H())).next(m=>({batchId:c,changes:Yg(m)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new F(t)).next(r=>{let i=wi();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,a=wi();return this.indexManager.getCollectionParents(e,s).next(c=>C.forEach(c,l=>{let d=function(I,E){return new Er(E,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,d,r,i).next(m=>{m.forEach((I,E)=>{a=a.insert(I,E)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(a=>{s.forEach((l,d)=>{let m=d.getKey();a.get(m)===null&&(a=a.insert(m,Ye.newInvalidDocument(m)))});let c=wi();return a.forEach((l,d)=>{let m=s.get(l);m!==void 0&&Si(m.mutation,d,$e.empty(),de.now()),zo(t,d)&&(c=c.insert(l,d))}),c})}};var Al=class{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return C.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,function(i){return{id:i.id,version:i.version,createTime:ct(i.createTime)}}(t)),C.resolve()}getNamedQuery(e,t){return C.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,function(i){return{name:i.name,query:Qb(i.bundledQuery),readTime:ct(i.readTime)}}(t)),C.resolve()}};var bl=class{constructor(){this.overlays=new oe(F.comparator),this.kr=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){let r=An();return C.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.wt(e,t,s)}),C.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.kr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.kr.delete(r)),C.resolve()}getOverlaysForCollection(e,t,r){let i=An(),s=t.length+1,a=new F(t.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){let l=c.getNext().value,d=l.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===s&&l.largestBatchId>r&&i.set(l.getKey(),l)}return C.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new oe((d,m)=>d-m),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let m=s.get(d.largestBatchId);m===null&&(m=An(),s=s.insert(d.largestBatchId,m)),m.set(d.getKey(),d)}}let c=An(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,m)=>c.set(d,m)),!(c.size()>=i)););return C.resolve(c)}wt(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.kr.get(i.largestBatchId).delete(r.key);this.kr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new ol(t,r));let s=this.kr.get(t);s===void 0&&(s=H(),this.kr.set(t,s)),this.kr.set(t,s.add(r.key))}};var Sl=class{constructor(){this.sessionToken=Se.EMPTY_BYTE_STRING}getSessionToken(e){return C.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,C.resolve()}};var Vi=class{constructor(){this.qr=new ge(le.Qr),this.$r=new ge(le.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){let r=new le(e,t);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new le(e,t))}Gr(e,t){e.forEach(r=>this.removeReference(r,t))}zr(e){let t=new F(new ce([])),r=new le(t,e),i=new le(t,e+1),s=[];return this.$r.forEachInRange([r,i],a=>{this.Wr(a),s.push(a.key)}),s}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){let t=new F(new ce([])),r=new le(t,e),i=new le(t,e+1),s=H();return this.$r.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){let t=new le(e,0),r=this.qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},le=class{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return F.comparator(e.key,t.key)||W(e.Hr,t.Hr)}static Ur(e,t){return W(e.Hr,t.Hr)||F.comparator(e.key,t.key)}};var Rl=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new ge(le.Qr)}checkEmpty(e){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new il(s,t,r,i);this.mutationQueue.push(a);for(let c of i)this.Yr=this.Yr.add(new le(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return C.resolve(a)}lookupMutationBatch(e,t){return C.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Xr(r),s=i<0?0:i;return C.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?vh:this.er-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new le(t,0),i=new le(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([r,i],a=>{let c=this.Zr(a.Hr);s.push(c)}),C.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ge(W);return t.forEach(i=>{let s=new le(i,0),a=new le(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([s,a],c=>{r=r.add(c.Hr)})}),C.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;F.isDocumentKey(s)||(s=s.child(""));let a=new le(new F(s),0),c=new ge(W);return this.Yr.forEachWhile(l=>{let d=l.key.path;return!!r.isPrefixOf(d)&&(d.length===i&&(c=c.add(l.Hr)),!0)},a),C.resolve(this.ei(c))}ei(e){let t=[];return e.forEach(r=>{let i=this.Zr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){J(this.ti(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Yr;return C.forEach(t.mutations,i=>{let s=new le(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Yr=r})}rr(e){}containsKey(e,t){let r=new le(t,0),i=this.Yr.firstAfterOrEqual(r);return C.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Pl=class{constructor(e){this.ni=e,this.docs=function(){return new oe(F.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,a=this.ni(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return C.resolve(r?r.document.mutableCopy():Ye.newInvalidDocument(t))}getEntries(e,t){let r=Lt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ye.newInvalidDocument(i))}),C.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Lt(),a=t.path,c=new F(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(c);for(;l.hasNext();){let{key:d,value:{document:m}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||JA(QA(m),r)<=0||(i.has(m.key)||zo(t,m))&&(s=s.insert(m.key,m.mutableCopy()))}return C.resolve(s)}getAllFromCollectionGroup(e,t,r,i){M(9500)}ri(e,t){return C.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Cl(this)}getSize(e){return C.resolve(this.size)}},Cl=class extends vl{constructor(e){super(),this.Or=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Or.addEntry(e,i)):this.Or.removeEntry(r)}),C.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}};var kl=class{constructor(e){this.persistence=e,this.ii=new Ot(t=>Sh(t),Rh),this.lastRemoteSnapshotVersion=q.min(),this.highestTargetId=0,this.si=0,this.oi=new Vi,this.targetCount=0,this._i=xi.ar()}forEachTarget(e,t){return this.ii.forEach((r,i)=>t(i)),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.si&&(this.si=t),C.resolve()}hr(e){this.ii.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this._i=new xi(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.hr(t),C.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,C.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.ii.forEach((a,c)=>{c.sequenceNumber<=t&&r.get(c.targetId)===null&&(this.ii.delete(a),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),C.waitFor(s).next(()=>i)}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){let r=this.ii.get(t)||null;return C.resolve(r)}addMatchingKeys(e,t,r){return this.oi.Kr(t,r),C.resolve()}removeMatchingKeys(e,t,r){this.oi.Gr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),C.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),C.resolve()}getMatchingKeysForTargetId(e,t){let r=this.oi.Jr(t);return C.resolve(r)}containsKey(e,t){return C.resolve(this.oi.containsKey(t))}};var bo=class{constructor(e,t){this.ai={},this.overlays={},this.ui=new Eh(0),this.ci=!1,this.ci=!0,this.li=new Sl,this.referenceDelegate=e(this),this.hi=new kl(this),this.indexManager=new gl,this.remoteDocumentCache=function(i){return new Pl(i)}(r=>this.referenceDelegate.Pi(r)),this.serializer=new ml(t),this.Ti=new Al(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new bl,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ai[e.toKey()];return r||(r=new Rl(t,this.referenceDelegate),this.ai[e.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,r){O("MemoryPersistence","Starting transaction:",e);let i=new Dl(this.ui.next());return this.referenceDelegate.Ii(),r(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(e,t){return C.or(Object.values(this.ai).map(r=>()=>r.containsKey(e,t)))}},Dl=class extends Bu{constructor(e){super(),this.currentSequenceNumber=e}},Nl=class n{constructor(e){this.persistence=e,this.Ai=new Vi,this.Ri=null}static Vi(e){return new n(e)}get mi(){if(this.Ri)return this.Ri;throw M(60996)}addReference(e,t,r){return this.Ai.addReference(r,t),this.mi.delete(r.toString()),C.resolve()}removeReference(e,t,r){return this.Ai.removeReference(r,t),this.mi.add(r.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),C.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(i=>this.mi.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.mi.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.mi,r=>{let i=F.fromPath(r);return this.fi(e,i).next(s=>{s||t.removeEntry(i,q.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(r=>{r?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return C.or([()=>C.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}},So=class n{constructor(e,t){this.persistence=e,this.gi=new Ot(r=>eb(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=Yb(this,t)}static Vi(e,t){return new n(e,t)}Ii(){}di(e){return C.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){let t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}yr(e){let t=0;return this.gr(e,r=>{t++}).next(()=>t)}gr(e,t){return C.forEach(this.gi,(r,i)=>this.Sr(e,r,i).next(s=>s?C.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ri(e,a=>this.Sr(e,a,t).next(c=>{c||(r++,s.removeEntry(a,q.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),C.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),C.resolve()}removeReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),C.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),C.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=oo(e.data.value)),t}Sr(e,t,r){return C.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.gi.get(t);return C.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var Ol=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Is=r,this.ds=i}static Es(e,t){let r=H(),i=H();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var Ll=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var xl=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=function(){return hf()?8:XA(pe())>0?6:4}()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ps(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ys(e,t,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new Ll;return this.ws(e,t,a).next(c=>{if(s.result=c,this.Rs)return this.Ss(e,t,a,c.size)})}).next(()=>s.result)}Ss(e,t,r,i){return r.documentReadCount<this.Vs?(ar()<=z.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",cr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),C.resolve()):(ar()<=z.DEBUG&&O("QueryEngine","Query:",cr(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.fs*i?(ar()<=z.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",cr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,at(t))):C.resolve())}ps(e,t){if(zm(t))return C.resolve(null);let r=at(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=el(t,null,"F"),r=at(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let a=H(...s);return this.gs.getDocuments(e,a).next(c=>this.indexManager.getMinOffset(e,r).next(l=>{let d=this.bs(t,c);return this.Ds(t,d,a,l.readTime)?this.ps(e,el(t,null,"F")):this.vs(e,d,t,l)}))})))}ys(e,t,r,i){return zm(t)||i.isEqual(q.min())?C.resolve(null):this.gs.getDocuments(e,r).next(s=>{let a=this.bs(t,s);return this.Ds(t,a,r,i)?C.resolve(null):(ar()<=z.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),cr(t)),this.vs(e,a,t,KA(i,Ci)).next(c=>c))})}bs(e,t){let r=new ge(Qg(e));return t.forEach((i,s)=>{zo(e,s)&&(r=r.add(s))}),r}Ds(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ws(e,t,r){return ar()<=z.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",cr(t)),this.gs.getDocumentsMatchingQuery(e,t,kn.min(),r)}vs(e,t,r,i){return this.gs.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}};var Dh="LocalStore",Xb=3e8,Vl=class{constructor(e,t,r,i){this.persistence=e,this.Cs=t,this.serializer=i,this.Fs=new oe(W),this.Ms=new Ot(s=>Sh(s),Rh),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(r)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Tl(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}};function Zb(n,e,t,r){return new Vl(n,e,t,r)}function m_(n,e){return p(this,null,function*(){let t=B(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Ns(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let a=[],c=[],l=H();for(let d of i){a.push(d.batchId);for(let m of d.mutations)l=l.add(m.key)}for(let d of s){c.push(d.batchId);for(let m of d.mutations)l=l.add(m.key)}return t.localDocuments.getDocuments(r,l).next(d=>({Bs:d,removedBatchIds:a,addedBatchIds:c}))})})})}function eS(n,e){let t=B(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.Os.newChangeBuffer({trackRemovals:!0});return function(c,l,d,m){let I=d.batch,E=I.keys(),S=C.resolve();return E.forEach(k=>{S=S.next(()=>m.getEntry(l,k)).next(L=>{let D=d.docVersions.get(k);J(D!==null,48541),L.version.compareTo(D)<0&&(I.applyToRemoteDocument(L,d),L.isValidDocument()&&(L.setReadTime(d.commitVersion),m.addEntry(L)))})}),S.next(()=>c.mutationQueue.removeMutationBatch(l,I))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(c){let l=H();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(l=l.add(c.batch.mutations[d].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function g_(n){let e=B(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function tS(n,e){let t=B(n),r=e.snapshotVersion,i=t.Fs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=t.Os.newChangeBuffer({trackRemovals:!0});i=t.Fs;let c=[];e.targetChanges.forEach((m,I)=>{let E=i.get(I);if(!E)return;c.push(t.hi.removeMatchingKeys(s,m.removedDocuments,I).next(()=>t.hi.addMatchingKeys(s,m.addedDocuments,I)));let S=E.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(I)!==null?S=S.withResumeToken(Se.EMPTY_BYTE_STRING,q.min()).withLastLimboFreeSnapshotVersion(q.min()):m.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(m.resumeToken,r)),i=i.insert(I,S),function(L,D,$){return L.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-L.snapshotVersion.toMicroseconds()>=Xb?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0}(E,S,m)&&c.push(t.hi.updateTargetData(s,S))});let l=Lt(),d=H();if(e.documentUpdates.forEach(m=>{e.resolvedLimboDocuments.has(m)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,m))}),c.push(nS(s,a,e.documentUpdates).next(m=>{l=m.Ls,d=m.ks})),!r.isEqual(q.min())){let m=t.hi.getLastRemoteSnapshotVersion(s).next(I=>t.hi.setTargetsMetadata(s,s.currentSequenceNumber,r));c.push(m)}return C.waitFor(c).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,d)).next(()=>l)}).then(s=>(t.Fs=i,s))}function nS(n,e,t){let r=H(),i=H();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let a=Lt();return t.forEach((c,l)=>{let d=s.get(c);l.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(c)),l.isNoDocument()&&l.version.isEqual(q.min())?(e.removeEntry(c,l.readTime),a=a.insert(c,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(l),a=a.insert(c,l)):O(Dh,"Ignoring outdated watch update for ",c,". Current version:",d.version," Watch version:",l.version)}),{Ls:a,ks:i}})}function rS(n,e){let t=B(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=vh),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function iS(n,e){let t=B(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.hi.getTargetData(r,e).next(s=>s?(i=s,C.resolve(i)):t.hi.allocateTargetId(r).next(a=>(i=new Li(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.hi.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.Fs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Fs=t.Fs.insert(r.targetId,r),t.Ms.set(e,r.targetId)),r})}function Ml(n,e,t){return p(this,null,function*(){let r=B(n),i=r.Fs.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!kr(a))throw a;O(Dh,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Fs=r.Fs.remove(e),r.Ms.delete(i.target)})}function ig(n,e,t){let r=B(n),i=q.min(),s=H();return r.persistence.runTransaction("Execute query","readwrite",a=>function(l,d,m){let I=B(l),E=I.Ms.get(m);return E!==void 0?C.resolve(I.Fs.get(E)):I.hi.getTargetData(d,m)}(r,a,at(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(a,c.targetId).next(l=>{s=l})}).next(()=>r.Cs.getDocumentsMatchingQuery(a,e,t?i:q.min(),t?s:H())).next(c=>(sS(r,yb(e),c),{documents:c,qs:s})))}function sS(n,e,t){let r=n.xs.get(e)||q.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.xs.set(e,r)}var Ro=class{constructor(){this.activeTargetIds=Ab()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var Fl=class{constructor(){this.Fo=new Ro,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,r){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new Ro,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Ul=class{xo(e){}shutdown(){}};var sg="ConnectivityMonitor",Po=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){O(sg,"Network connectivity changed: AVAILABLE");for(let e of this.ko)e(0)}Lo(){O(sg,"Network connectivity changed: UNAVAILABLE");for(let e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var so=null;function Bl(){return so===null?so=function(){return 268435456+Math.round(2147483648*Math.random())}():so++,"0x"+so.toString(16)}var Cu="RestConnection",oS={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},ql=class{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.Ko=this.databaseId.database===mo?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,t,r,i,s){let a=Bl(),c=this.Go(e,t.toUriEncodedString());O(Cu,`Sending RPC '${e}' ${a}:`,c,r);let l={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(l,i,s);let{host:d}=new URL(c),m=qt(d);return this.jo(e,c,l,r,m).then(I=>(O(Cu,`Received RPC '${e}' ${a}: `,I),I),I=>{throw en(Cu,`RPC '${e}' ${a} failed with error: `,I,"url: ",c,"request:",r),I})}Jo(e,t,r,i,s,a){return this.Wo(e,t,r,i,s)}zo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Pr}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}Go(e,t){let r=oS[e];return`${this.$o}/v1/${t}:${r}`}terminate(){}};var $l=class{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}};var Ae="WebChannelConnection",jl=class extends ql{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,r,i,s){let a=Bl();return new Promise((c,l)=>{let d=new Tu;d.setWithCredentials(!0),d.listenOnce(Au.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case vi.NO_ERROR:let I=d.getResponseJson();O(Ae,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(I)),c(I);break;case vi.TIMEOUT:O(Ae,`RPC '${e}' ${a} timed out`),l(new x(P.DEADLINE_EXCEEDED,"Request time out"));break;case vi.HTTP_ERROR:let E=d.getStatus();if(O(Ae,`RPC '${e}' ${a} failed with status:`,E,"response text:",d.getResponseText()),E>0){let S=d.getResponseJson();Array.isArray(S)&&(S=S[0]);let k=S?.error;if(k&&k.status&&k.message){let L=function($){let U=$.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(U)>=0?U:P.UNKNOWN}(k.status);l(new x(L,k.message))}else l(new x(P.UNKNOWN,"Server responded with status "+d.getStatus()))}else l(new x(P.UNAVAILABLE,"Connection failed."));break;default:M(9055,{c_:e,streamId:a,l_:d.getLastErrorCode(),h_:d.getLastError()})}}finally{O(Ae,`RPC '${e}' ${a} completed.`)}});let m=JSON.stringify(i);O(Ae,`RPC '${e}' ${a} sending request:`,i),d.send(t,"POST",m,r,15)})}P_(e,t,r){let i=Bl(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Ru(),c=Su(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.useFetchStreams=!0),this.zo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;let m=s.join("");O(Ae,`Creating RPC '${e}' stream ${i}: ${m}`,l);let I=a.createWebChannel(m,l);this.T_(I);let E=!1,S=!1,k=new $l({Ho:D=>{S?O(Ae,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(E||(O(Ae,`Opening RPC '${e}' stream ${i} transport.`),I.open(),E=!0),O(Ae,`RPC '${e}' stream ${i} sending:`,D),I.send(D))},Yo:()=>I.close()}),L=(D,$,U)=>{D.listen($,j=>{try{U(j)}catch(X){setTimeout(()=>{throw X},0)}})};return L(I,or.EventType.OPEN,()=>{S||(O(Ae,`RPC '${e}' stream ${i} transport opened.`),k.s_())}),L(I,or.EventType.CLOSE,()=>{S||(S=!0,O(Ae,`RPC '${e}' stream ${i} transport closed`),k.__(),this.I_(I))}),L(I,or.EventType.ERROR,D=>{S||(S=!0,en(Ae,`RPC '${e}' stream ${i} transport errored. Name:`,D.name,"Message:",D.message),k.__(new x(P.UNAVAILABLE,"The operation could not be completed")))}),L(I,or.EventType.MESSAGE,D=>{var $;if(!S){let U=D.data[0];J(!!U,16349);let j=U,X=j?.error||(($=j[0])===null||$===void 0?void 0:$.error);if(X){O(Ae,`RPC '${e}' stream ${i} received error:`,X);let Pe=X.status,Y=function(y){let v=ue[y];if(v!==void 0)return o_(v)}(Pe),w=X.message;Y===void 0&&(Y=P.INTERNAL,w="Unknown error status: "+Pe+" with message "+X.message),S=!0,k.__(new x(Y,w)),I.close()}else O(Ae,`RPC '${e}' stream ${i} received:`,U),k.a_(U)}}),L(c,bu.STAT_EVENT,D=>{D.stat===no.PROXY?O(Ae,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===no.NOPROXY&&O(Ae,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{k.o_()},0),k}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}};function ku(){return typeof document<"u"?document:null}function Ho(n){return new ll(n,!0)}var Co=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=r,this.E_=i,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();let t=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),i=Math.max(0,t-r);i>0&&O("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};var og="PersistentStream",ko=class{constructor(e,t,r,i,s,a,c,l){this.Fi=e,this.w_=r,this.S_=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=l,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Co(e,t)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}stop(){return p(this,null,function*(){this.M_()&&(yield this.close(0))})}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}L_(){return p(this,null,function*(){if(this.x_())return this.close(0)})}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return p(this,null,function*(){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(kt(t.toString()),kt("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.n_(t)})}U_(){}auth(){this.state=1;let e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.b_===t&&this.W_(r,i)},r=>{e(()=>{let i=new x(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.G_(i)})})}W_(e,t){let r=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{r(()=>this.G_(i))}),this.stream.onMessage(i=>{r(()=>++this.C_==1?this.j_(i):this.onNext(i))})}O_(){this.state=5,this.F_.g_(()=>p(this,null,function*(){this.state=0,this.start()}))}G_(e){return O(og,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(O(og,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Wl=class extends ko{constructor(e,t,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();let t=Fb(this.serializer,e),r=function(s){if(!("targetChange"in s))return q.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?q.min():a.readTime?ct(a.readTime):q.min()}(e);return this.listener.J_(t,r)}H_(e){let t={};t.database=pl(this.serializer),t.addTarget=function(s,a){let c,l=a.target;if(c=Zu(l)?{documents:qb(s,l)}:{query:$b(s,l).Vt},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=a_(s,a.resumeToken);let d=hl(s,a.expectedCount);d!==null&&(c.expectedCount=d)}else if(a.snapshotVersion.compareTo(q.min())>0){c.readTime=To(s,a.snapshotVersion.toTimestamp());let d=hl(s,a.expectedCount);d!==null&&(c.expectedCount=d)}return c}(this.serializer,e);let r=Wb(this.serializer,e);r&&(t.labels=r),this.k_(t)}Y_(e){let t={};t.database=pl(this.serializer),t.removeTarget=e,this.k_(t)}},zl=class extends ko{constructor(e,t,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return J(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,J(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){J(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();let t=Bb(e.writeResults,e.commitTime),r=ct(e.commitTime);return this.listener.ta(r,t)}na(){let e={};e.database=pl(this.serializer),this.k_(e)}X_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Ub(this.serializer,r))};this.k_(t)}};var Hl=class{},Gl=class extends Hl{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Wo(e,dl(t,r),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new x(P.UNKNOWN,s.toString())})}Jo(e,t,r,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,c])=>this.connection.Jo(e,dl(t,r),i,a,c,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new x(P.UNKNOWN,a.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},Kl=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(kt(t),this._a=!1):O("OnlineStateTracker",t)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};var xn="RemoteStore",Ql=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(a=>{r.enqueueAndForget(()=>p(this,null,function*(){Vn(this)&&(O(xn,"Restarting streams for network reachability change."),yield function(l){return p(this,null,function*(){let d=B(l);d.Ia.add(4),yield Bi(d),d.Aa.set("Unknown"),d.Ia.delete(4),yield Go(d)})}(this))}))}),this.Aa=new Kl(r,i)}};function Go(n){return p(this,null,function*(){if(Vn(n))for(let e of n.da)yield e(!0)})}function Bi(n){return p(this,null,function*(){for(let e of n.da)yield e(!1)})}function __(n,e){let t=B(n);t.Ta.has(e.targetId)||(t.Ta.set(e.targetId,e),xh(t)?Lh(t):Dr(t).x_()&&Oh(t,e))}function Nh(n,e){let t=B(n),r=Dr(t);t.Ta.delete(e),r.x_()&&y_(t,e),t.Ta.size===0&&(r.x_()?r.B_():Vn(t)&&t.Aa.set("Unknown"))}function Oh(n,e){if(n.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(q.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Dr(n).H_(e)}function y_(n,e){n.Ra.$e(e),Dr(n).Y_(e)}function Lh(n){n.Ra=new ul({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Ta.get(e)||null,lt:()=>n.datastore.serializer.databaseId}),Dr(n).start(),n.Aa.aa()}function xh(n){return Vn(n)&&!Dr(n).M_()&&n.Ta.size>0}function Vn(n){return B(n).Ia.size===0}function I_(n){n.Ra=void 0}function aS(n){return p(this,null,function*(){n.Aa.set("Online")})}function cS(n){return p(this,null,function*(){n.Ta.forEach((e,t)=>{Oh(n,e)})})}function uS(n,e){return p(this,null,function*(){I_(n),xh(n)?(n.Aa.la(e),Lh(n)):n.Aa.set("Unknown")})}function lS(n,e,t){return p(this,null,function*(){if(n.Aa.set("Online"),e instanceof vo&&e.state===2&&e.cause)try{yield function(i,s){return p(this,null,function*(){let a=s.cause;for(let c of s.targetIds)i.Ta.has(c)&&(yield i.remoteSyncer.rejectListen(c,a),i.Ta.delete(c),i.Ra.removeTarget(c))})}(n,e)}catch(r){O(xn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Do(n,r)}else if(e instanceof dr?n.Ra.Ye(e):e instanceof Eo?n.Ra.it(e):n.Ra.et(e),!t.isEqual(q.min()))try{let r=yield g_(n.localStore);t.compareTo(r)>=0&&(yield function(s,a){let c=s.Ra.Pt(a);return c.targetChanges.forEach((l,d)=>{if(l.resumeToken.approximateByteSize()>0){let m=s.Ta.get(d);m&&s.Ta.set(d,m.withResumeToken(l.resumeToken,a))}}),c.targetMismatches.forEach((l,d)=>{let m=s.Ta.get(l);if(!m)return;s.Ta.set(l,m.withResumeToken(Se.EMPTY_BYTE_STRING,m.snapshotVersion)),y_(s,l);let I=new Li(m.target,l,d,m.sequenceNumber);Oh(s,I)}),s.remoteSyncer.applyRemoteEvent(c)}(n,t))}catch(r){O(xn,"Failed to raise snapshot:",r),yield Do(n,r)}})}function Do(n,e,t){return p(this,null,function*(){if(!kr(e))throw e;n.Ia.add(1),yield Bi(n),n.Aa.set("Offline"),t||(t=()=>g_(n.localStore)),n.asyncQueue.enqueueRetryable(()=>p(null,null,function*(){O(xn,"Retrying IndexedDB access"),yield t(),n.Ia.delete(1),yield Go(n)}))})}function E_(n,e){return e().catch(t=>Do(n,t,e))}function Ko(n){return p(this,null,function*(){let e=B(n),t=nn(e),r=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:vh;for(;hS(e);)try{let i=yield rS(e.localStore,r);if(i===null){e.Pa.length===0&&t.B_();break}r=i.batchId,dS(e,i)}catch(i){yield Do(e,i)}v_(e)&&w_(e)})}function hS(n){return Vn(n)&&n.Pa.length<10}function dS(n,e){n.Pa.push(e);let t=nn(n);t.x_()&&t.Z_&&t.X_(e.mutations)}function v_(n){return Vn(n)&&!nn(n).M_()&&n.Pa.length>0}function w_(n){nn(n).start()}function fS(n){return p(this,null,function*(){nn(n).na()})}function pS(n){return p(this,null,function*(){let e=nn(n);for(let t of n.Pa)e.X_(t.mutations)})}function mS(n,e,t){return p(this,null,function*(){let r=n.Pa.shift(),i=sl.from(r,e,t);yield E_(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Ko(n)})}function gS(n,e){return p(this,null,function*(){e&&nn(n).Z_&&(yield function(r,i){return p(this,null,function*(){if(function(a){return Db(a)&&a!==P.ABORTED}(i.code)){let s=r.Pa.shift();nn(r).N_(),yield E_(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Ko(r)}})}(n,e)),v_(n)&&w_(n)})}function ag(n,e){return p(this,null,function*(){let t=B(n);t.asyncQueue.verifyOperationInProgress(),O(xn,"RemoteStore received new credentials");let r=Vn(t);t.Ia.add(3),yield Bi(t),r&&t.Aa.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),yield Go(t)})}function _S(n,e){return p(this,null,function*(){let t=B(n);e?(t.Ia.delete(2),yield Go(t)):e||(t.Ia.add(2),yield Bi(t),t.Aa.set("Unknown"))})}function Dr(n){return n.Va||(n.Va=function(t,r,i){let s=B(t);return s.ia(),new Wl(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Zo:aS.bind(null,n),e_:cS.bind(null,n),n_:uS.bind(null,n),J_:lS.bind(null,n)}),n.da.push(e=>p(null,null,function*(){e?(n.Va.N_(),xh(n)?Lh(n):n.Aa.set("Unknown")):(yield n.Va.stop(),I_(n))}))),n.Va}function nn(n){return n.ma||(n.ma=function(t,r,i){let s=B(t);return s.ia(),new zl(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:fS.bind(null,n),n_:gS.bind(null,n),ea:pS.bind(null,n),ta:mS.bind(null,n)}),n.da.push(e=>p(null,null,function*(){e?(n.ma.N_(),yield Ko(n)):(yield n.ma.stop(),n.Pa.length>0&&(O(xn,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))}))),n.ma}var Jl=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new st,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let a=Date.now()+r,c=new n(e,t,a,i,s);return c.start(r),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Vh(n,e){if(kt("AsyncQueue",`${e}: ${n}`),kr(n))return new x(P.UNAVAILABLE,`${e}: ${n}`);throw n}var No=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||F.comparator(t.key,r.key):(t,r)=>F.comparator(t.key,r.key),this.keyedMap=wi(),this.sortedSet=new oe(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Oo=class{constructor(){this.fa=new oe(F.comparator)}track(e){let t=e.doc.key,r=this.fa.get(t);r?e.type!==0&&r.type===3?this.fa=this.fa.insert(t,e):e.type===3&&r.type!==1?this.fa=this.fa.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.fa=this.fa.remove(t):e.type===1&&r.type===2?this.fa=this.fa.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):M(63341,{At:e,ga:r}):this.fa=this.fa.insert(t,e)}pa(){let e=[];return this.fa.inorderTraversal((t,r)=>{e.push(r)}),e}},Ar=class n{constructor(e,t,r,i,s,a,c,l,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,i,s){let a=[];return t.forEach(c=>{a.push({type:0,doc:c})}),new n(e,t,No.emptySet(t),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Wo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Yl=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}},Xl=class{constructor(){this.queries=cg(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(t,r){let i=B(t),s=i.queries;i.queries=cg(),s.forEach((a,c)=>{for(let l of c.wa)l.onError(r)})})(this,new x(P.ABORTED,"Firestore shutting down"))}};function cg(){return new Ot(n=>Kg(n),Wo)}function yS(n,e){return p(this,null,function*(){let t=B(n),r=3,i=e.query,s=t.queries.get(i);s?!s.Sa()&&e.ba()&&(r=2):(s=new Yl,r=e.ba()?0:1);try{switch(r){case 0:s.ya=yield t.onListen(i,!0);break;case 1:s.ya=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let c=Vh(a,`Initialization of query '${cr(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.wa.push(e),e.va(t.onlineState),s.ya&&e.Ca(s.ya)&&Mh(t)})}function IS(n,e){return p(this,null,function*(){let t=B(n),r=e.query,i=3,s=t.queries.get(r);if(s){let a=s.wa.indexOf(e);a>=0&&(s.wa.splice(a,1),s.wa.length===0?i=e.ba()?0:1:!s.Sa()&&e.ba()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function ES(n,e){let t=B(n),r=!1;for(let i of e){let s=i.query,a=t.queries.get(s);if(a){for(let c of a.wa)c.Ca(i)&&(r=!0);a.ya=i}}r&&Mh(t)}function vS(n,e,t){let r=B(n),i=r.queries.get(e);if(i)for(let s of i.wa)s.onError(t);r.queries.delete(e)}function Mh(n){n.Da.forEach(e=>{e.next()})}var Zl,ug;(ug=Zl||(Zl={})).Fa="default",ug.Cache="cache";var eh=class{constructor(e,t,r){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Ar(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache||!this.ba())return!0;let r=t!=="Offline";return(!this.options.ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Na(e){if(e.docChanges.length>0)return!0;let t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}La(e){e=Ar.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==Zl.Cache}};var Lo=class{constructor(e){this.key=e}},xo=class{constructor(e){this.key=e}},th=class{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=H(),this.mutatedKeys=H(),this.Xa=Qg(e),this.eu=new No(this.Xa)}get tu(){return this.Ha}nu(e,t){let r=t?t.ru:new Oo,i=t?t.eu:this.eu,s=t?t.mutatedKeys:this.mutatedKeys,a=i,c=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((m,I)=>{let E=i.get(m),S=zo(this.query,I)?I:null,k=!!E&&this.mutatedKeys.has(E.key),L=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations),D=!1;E&&S?E.data.isEqual(S.data)?k!==L&&(r.track({type:3,doc:S}),D=!0):this.iu(E,S)||(r.track({type:2,doc:S}),D=!0,(l&&this.Xa(S,l)>0||d&&this.Xa(S,d)<0)&&(c=!0)):!E&&S?(r.track({type:0,doc:S}),D=!0):E&&!S&&(r.track({type:1,doc:E}),D=!0,(l||d)&&(c=!0)),D&&(S?(a=a.add(S),s=L?s.add(m):s.delete(m)):(a=a.delete(m),s=s.delete(m)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let m=this.query.limitType==="F"?a.last():a.first();a=a.delete(m.key),s=s.delete(m.key),r.track({type:1,doc:m})}return{eu:a,ru:r,Ds:c,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;let a=e.ru.pa();a.sort((m,I)=>function(S,k){let L=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M(20277,{At:D})}};return L(S)-L(k)}(m.type,I.type)||this.Xa(m.doc,I.doc)),this.su(r),i=i!=null&&i;let c=t&&!i?this.ou():[],l=this.Za.size===0&&this.current&&!i?1:0,d=l!==this.Ya;return this.Ya=l,a.length!==0||d?{snapshot:new Ar(this.query,e.eu,s,a,e.mutatedKeys,l===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:c}:{_u:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new Oo,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}ou(){if(!this.current)return[];let e=this.Za;this.Za=H(),this.eu.forEach(r=>{this.au(r.key)&&(this.Za=this.Za.add(r.key))});let t=[];return e.forEach(r=>{this.Za.has(r)||t.push(new xo(r))}),this.Za.forEach(r=>{e.has(r)||t.push(new Lo(r))}),t}uu(e){this.Ha=e.qs,this.Za=H();let t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return Ar.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},Fh="SyncEngine",nh=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},rh=class{constructor(e){this.key=e,this.lu=!1}},ih=class{constructor(e,t,r,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.hu={},this.Pu=new Ot(c=>Kg(c),Wo),this.Tu=new Map,this.Iu=new Set,this.du=new oe(F.comparator),this.Eu=new Map,this.Au=new Vi,this.Ru={},this.Vu=new Map,this.mu=xi.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};function wS(n,e,t=!0){return p(this,null,function*(){let r=P_(n),i,s=r.Pu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=yield T_(r,e,t,!0),i})}function TS(n,e){return p(this,null,function*(){let t=P_(n);yield T_(t,e,!0,!1)})}function T_(n,e,t,r){return p(this,null,function*(){let i=yield iS(n.localStore,at(e)),s=i.targetId,a=n.sharedClientState.addLocalQueryTarget(s,t),c;return r&&(c=yield AS(n,e,s,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&__(n.remoteStore,i),c})}function AS(n,e,t,r,i){return p(this,null,function*(){n.gu=(I,E,S)=>function(L,D,$,U){return p(this,null,function*(){let j=D.view.nu($);j.Ds&&(j=yield ig(L.localStore,D.query,!1).then(({documents:w})=>D.view.nu(w,j)));let X=U&&U.targetChanges.get(D.targetId),Pe=U&&U.targetMismatches.get(D.targetId)!=null,Y=D.view.applyChanges(j,L.isPrimaryClient,X,Pe);return hg(L,D.targetId,Y._u),Y.snapshot})}(n,I,E,S);let s=yield ig(n.localStore,e,!0),a=new th(e,s.qs),c=a.nu(s.documents),l=Oi.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),d=a.applyChanges(c,n.isPrimaryClient,l);hg(n,t,d._u);let m=new nh(e,t,a);return n.Pu.set(e,m),n.Tu.has(t)?n.Tu.get(t).push(e):n.Tu.set(t,[e]),d.snapshot})}function bS(n,e,t){return p(this,null,function*(){let r=B(n),i=r.Pu.get(e),s=r.Tu.get(i.targetId);if(s.length>1)return r.Tu.set(i.targetId,s.filter(a=>!Wo(a,e))),void r.Pu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Ml(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Nh(r.remoteStore,i.targetId),sh(r,i.targetId)}).catch(Cr))):(sh(r,i.targetId),yield Ml(r.localStore,i.targetId,!0))})}function SS(n,e){return p(this,null,function*(){let t=B(n),r=t.Pu.get(e),i=t.Tu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Nh(t.remoteStore,r.targetId))})}function RS(n,e,t){return p(this,null,function*(){let r=LS(n);try{let i=yield function(a,c){let l=B(a),d=de.now(),m=c.reduce((S,k)=>S.add(k.key),H()),I,E;return l.persistence.runTransaction("Locally write mutations","readwrite",S=>{let k=Lt(),L=H();return l.Os.getEntries(S,m).next(D=>{k=D,k.forEach(($,U)=>{U.isValidDocument()||(L=L.add($))})}).next(()=>l.localDocuments.getOverlayedDocuments(S,k)).next(D=>{I=D;let $=[];for(let U of c){let j=kb(U,I.get(U.key).overlayedDocument);j!=null&&$.push(new ht(U.key,j,$g(j.value.mapValue),Jt.exists(!0)))}return l.mutationQueue.addMutationBatch(S,d,$,c)}).next(D=>{E=D;let $=D.applyToLocalDocumentSet(I,L);return l.documentOverlayCache.saveOverlays(S,D.batchId,$)})}).then(()=>({batchId:E.batchId,changes:Yg(I)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,c,l){let d=a.Ru[a.currentUser.toKey()];d||(d=new oe(W)),d=d.insert(c,l),a.Ru[a.currentUser.toKey()]=d}(r,i.batchId,t),yield qi(r,i.changes),yield Ko(r.remoteStore)}catch(i){let s=Vh(i,"Failed to persist write");t.reject(s)}})}function A_(n,e){return p(this,null,function*(){let t=B(n);try{let r=yield tS(t.localStore,e);e.targetChanges.forEach((i,s)=>{let a=t.Eu.get(s);a&&(J(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.lu=!0:i.modifiedDocuments.size>0?J(a.lu,14607):i.removedDocuments.size>0&&(J(a.lu,42227),a.lu=!1))}),yield qi(t,r,e)}catch(r){yield Cr(r)}})}function lg(n,e,t){let r=B(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Pu.forEach((s,a)=>{let c=a.view.va(e);c.snapshot&&i.push(c.snapshot)}),function(a,c){let l=B(a);l.onlineState=c;let d=!1;l.queries.forEach((m,I)=>{for(let E of I.wa)E.va(c)&&(d=!0)}),d&&Mh(l)}(r.eventManager,e),i.length&&r.hu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function PS(n,e,t){return p(this,null,function*(){let r=B(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Eu.get(e),s=i&&i.key;if(s){let a=new oe(F.comparator);a=a.insert(s,Ye.newNoDocument(s,q.min()));let c=H().add(s),l=new Io(q.min(),new Map,new oe(W),a,c);yield A_(r,l),r.du=r.du.remove(s),r.Eu.delete(e),Uh(r)}else yield Ml(r.localStore,e,!1).then(()=>sh(r,e,t)).catch(Cr)})}function CS(n,e){return p(this,null,function*(){let t=B(n),r=e.batch.batchId;try{let i=yield eS(t.localStore,e);S_(t,r,null),b_(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield qi(t,i)}catch(i){yield Cr(i)}})}function kS(n,e,t){return p(this,null,function*(){let r=B(n);try{let i=yield function(a,c){let l=B(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let m;return l.mutationQueue.lookupMutationBatch(d,c).next(I=>(J(I!==null,37113),m=I.keys(),l.mutationQueue.removeMutationBatch(d,I))).next(()=>l.mutationQueue.performConsistencyCheck(d)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(d,m,c)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,m)).next(()=>l.localDocuments.getDocuments(d,m))})}(r.localStore,e);S_(r,e,t),b_(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield qi(r,i)}catch(i){yield Cr(i)}})}function b_(n,e){(n.Vu.get(e)||[]).forEach(t=>{t.resolve()}),n.Vu.delete(e)}function S_(n,e,t){let r=B(n),i=r.Ru[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ru[r.currentUser.toKey()]=i}}function sh(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Tu.get(e))n.Pu.delete(r),t&&n.hu.pu(r,t);n.Tu.delete(e),n.isPrimaryClient&&n.Au.zr(e).forEach(r=>{n.Au.containsKey(r)||R_(n,r)})}function R_(n,e){n.Iu.delete(e.path.canonicalString());let t=n.du.get(e);t!==null&&(Nh(n.remoteStore,t),n.du=n.du.remove(e),n.Eu.delete(t),Uh(n))}function hg(n,e,t){for(let r of t)r instanceof Lo?(n.Au.addReference(r.key,e),DS(n,r)):r instanceof xo?(O(Fh,"Document no longer in limbo: "+r.key),n.Au.removeReference(r.key,e),n.Au.containsKey(r.key)||R_(n,r.key)):M(19791,{yu:r})}function DS(n,e){let t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Iu.has(r)||(O(Fh,"New document in limbo: "+t),n.Iu.add(r),Uh(n))}function Uh(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let e=n.Iu.values().next().value;n.Iu.delete(e);let t=new F(ce.fromString(e)),r=n.mu.next();n.Eu.set(r,new rh(t)),n.du=n.du.insert(t,r),__(n.remoteStore,new Li(at(Ph(t.path)),r,"TargetPurposeLimboResolution",Eh.ue))}}function qi(n,e,t){return p(this,null,function*(){let r=B(n),i=[],s=[],a=[];r.Pu.isEmpty()||(r.Pu.forEach((c,l)=>{a.push(r.gu(l,e,t).then(d=>{var m;if((d||t)&&r.isPrimaryClient){let I=d?!d.fromCache:(m=t?.targetChanges.get(l.targetId))===null||m===void 0?void 0:m.current;r.sharedClientState.updateQueryState(l.targetId,I?"current":"not-current")}if(d){i.push(d);let I=Ol.Es(l.targetId,d);s.push(I)}}))}),yield Promise.all(a),r.hu.J_(i),yield function(l,d){return p(this,null,function*(){let m=B(l);try{yield m.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>C.forEach(d,E=>C.forEach(E.Is,S=>m.persistence.referenceDelegate.addReference(I,E.targetId,S)).next(()=>C.forEach(E.ds,S=>m.persistence.referenceDelegate.removeReference(I,E.targetId,S)))))}catch(I){if(!kr(I))throw I;O(Dh,"Failed to update sequence numbers: "+I)}for(let I of d){let E=I.targetId;if(!I.fromCache){let S=m.Fs.get(E),k=S.snapshotVersion,L=S.withLastLimboFreeSnapshotVersion(k);m.Fs=m.Fs.insert(E,L)}}})}(r.localStore,s))})}function NS(n,e){return p(this,null,function*(){let t=B(n);if(!t.currentUser.isEqual(e)){O(Fh,"User change. New user:",e.toKey());let r=yield m_(t.localStore,e);t.currentUser=e,function(s,a){s.Vu.forEach(c=>{c.forEach(l=>{l.reject(new x(P.CANCELLED,a))})}),s.Vu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield qi(t,r.Bs)}})}function OS(n,e){let t=B(n),r=t.Eu.get(e);if(r&&r.lu)return H().add(r.key);{let i=H(),s=t.Tu.get(e);if(!s)return i;for(let a of s){let c=t.Pu.get(a);i=i.unionWith(c.view.tu)}return i}}function P_(n){let e=B(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=A_.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=OS.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=PS.bind(null,e),e.hu.J_=ES.bind(null,e.eventManager),e.hu.pu=vS.bind(null,e.eventManager),e}function LS(n){let e=B(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=CS.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=kS.bind(null,e),e}var C_=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return p(this,null,function*(){this.serializer=Ho(t.databaseInfo.databaseId),this.sharedClientState=this.bu(t),this.persistence=this.Du(t),yield this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Cu(t,this.localStore),this.indexBackfillerScheduler=this.Fu(t,this.localStore)})}Cu(t,r){return null}Fu(t,r){return null}vu(t){return Zb(this.persistence,new xl,t.initialUser,this.serializer)}Du(t){return new bo(Nl.Vi,this.serializer)}bu(t){return new Fl}terminate(){return p(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),oh=class extends C_{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){J(this.persistence.referenceDelegate instanceof So,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new Il(r,e.asyncQueue,t)}Du(e){let t=this.cacheSizeBytes!==void 0?qe.withCacheSize(this.cacheSizeBytes):qe.DEFAULT;return new bo(r=>So.Vi(r,t),this.serializer)}};var xS=(()=>{class n{initialize(t,r){return p(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>lg(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=NS.bind(null,this.syncEngine),yield _S(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Xl}()}createDatastore(t){let r=Ho(t.databaseInfo.databaseId),i=function(a){return new jl(a)}(t.databaseInfo);return function(a,c,l,d){return new Gl(a,c,l,d)}(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return function(i,s,a,c,l){return new Ql(i,s,a,c,l)}(this.localStore,this.datastore,t.asyncQueue,r=>lg(this.syncEngine,r,0),function(){return Po.C()?new Po:new Ul}())}createSyncEngine(t,r){return function(s,a,c,l,d,m,I){let E=new ih(s,a,c,l,d,m);return I&&(E.fu=!0),E}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return p(this,null,function*(){var t,r;yield function(s){return p(this,null,function*(){let a=B(s);O(xn,"RemoteStore shutting down."),a.Ia.add(5),yield Bi(a),a.Ea.shutdown(),a.Aa.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();var ah=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):kt("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var rn="FirestoreClient",ch=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=me.UNAUTHENTICATED,this.clientId=Pi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,a=>p(this,null,function*(){O(rn,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,a=>(O(rn,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new st;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Vh(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Du(n,e){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),O(rn,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>p(null,null,function*(){r.isEqual(i)||(yield m_(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>{en("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then(()=>{O("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{en("Terminating Firestore due to IndexedDb database deletion failed",i)})}),n._offlineComponents=e})}function dg(n,e){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield VS(n);O(rn,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>ag(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>ag(e.remoteStore,i)),n._onlineComponents=e})}function VS(n){return p(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){O(rn,"Using user provided OfflineComponentProvider");try{yield Du(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===P.FAILED_PRECONDITION||i.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;en("Error using user provided cache. Falling back to memory cache: "+t),yield Du(n,new C_)}}else O(rn,"Using default OfflineComponentProvider"),yield Du(n,new oh(void 0));return n._offlineComponents})}function k_(n){return p(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(O(rn,"Using user provided OnlineComponentProvider"),yield dg(n,n._uninitializedComponentsProvider._online)):(O(rn,"Using default OnlineComponentProvider"),yield dg(n,new xS))),n._onlineComponents})}function MS(n){return k_(n).then(e=>e.syncEngine)}function FS(n){return p(this,null,function*(){let e=yield k_(n),t=e.eventManager;return t.onListen=wS.bind(null,e.syncEngine),t.onUnlisten=bS.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=TS.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=SS.bind(null,e.syncEngine),t})}function US(n,e,t={}){let r=new st;return n.asyncQueue.enqueueAndForget(()=>p(null,null,function*(){return function(s,a,c,l,d){let m=new ah({next:E=>{m.Ou(),a.enqueueAndForget(()=>IS(s,I));let S=E.docs.has(c);!S&&E.fromCache?d.reject(new x(P.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&E.fromCache&&l&&l.source==="server"?d.reject(new x(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(E)},error:E=>d.reject(E)}),I=new eh(Ph(c.path),m,{includeMetadataChanges:!0,ka:!0});return yS(s,I)}(yield FS(n),n.asyncQueue,e,t,r)})),r.promise}function D_(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var fg=new Map;var N_="firestore.googleapis.com",pg=!0,Vo=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new x(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=N_,this.ssl=pg}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:pg;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=p_;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Jb)throw new x(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}GA("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=D_((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Mi=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Vo({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new x(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Vo(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Nu;switch(r.type){case"firstParty":return new Vu(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new x(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return p(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=fg.get(t);r&&(O("ComponentProvider","Removing Datastore"),fg.delete(t),r.terminate())}(this),Promise.resolve()}};function O_(n,e,t,r={}){var i;n=Cn(n,Mi);let s=qt(e),a=n._getSettings(),c=Object.assign(Object.assign({},a),{emulatorOptions:n._getEmulatorOptions()}),l=`${e}:${t}`;s&&(ds(`https://${l}`),fs("Firestore",!0)),a.host!==N_&&a.host!==l&&en("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let d=Object.assign(Object.assign({},a),{host:l,ssl:s,emulatorOptions:r});if(!et(d,c)&&(n._setSettings(d),r.mockUserToken)){let m,I;if(typeof r.mockUserToken=="string")m=r.mockUserToken,I=me.MOCK_USER;else{m=sf(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let E=r.mockUserToken.sub||r.mockUserToken.user_id;if(!E)throw new x(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");I=new me(E)}n._authCredentials=new Ou(new uo(m,I))}}var uh=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},be=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Fi(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Ui(t,n._jsonSchema))return new n(e,r||null,new F(ce.fromString(t.referencePath)))}};be._jsonSchemaVersion="firestore/documentReference/1.0",be._jsonSchema={type:he("string",be._jsonSchemaVersion),referencePath:he("string")};var Fi=class n extends uh{constructor(e,t,r){super(e,t,Ph(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new be(this.firestore,null,new F(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function L_(n,e,...t){if(n=ie(n),arguments.length===1&&(e=Pi.newId()),HA("doc","path",e),n instanceof Mi){let r=ce.fromString(e,...t);return Om(r),new be(n,null,new F(r))}{if(!(n instanceof be||n instanceof Fi))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ce.fromString(e,...t));return Om(r),new be(n.firestore,n instanceof Fi?n.converter:null,new F(r))}}var mg="AsyncQueue",Mo=class{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Co(this,"async_queue_retry"),this.oc=()=>{let r=ku();r&&O(mg,"Visibility state changed to "+r.visibilityState),this.F_.y_()},this._c=e;let t=ku();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;let t=ku();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});let t=new st;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}cc(){return p(this,null,function*(){if(this.Zu.length!==0){try{yield this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!kr(e))throw e;O(mg,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}})}uc(e){let t=this._c.then(()=>(this.nc=!0,e().catch(r=>{throw this.tc=r,this.nc=!1,kt("INTERNAL UNHANDLED ERROR: ",gg(r)),r}).then(r=>(this.nc=!1,r))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.ac(),this.sc.indexOf(e)>-1&&(t=0);let i=Jl.createAndSchedule(this,e,t,r,s=>this.lc(s));return this.ec.push(i),i}ac(){this.tc&&M(47125,{hc:gg(this.tc)})}verifyOperationInProgress(){}Pc(){return p(this,null,function*(){let e;do e=this._c,yield e;while(e!==this._c)})}Tc(e){for(let t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.ec)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){let t=this.ec.indexOf(e);this.ec.splice(t,1)}};function gg(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}var br=class extends Mi{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Mo,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return p(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Mo(e),this._firestoreClient=void 0,yield e}})}};function x_(n,e){let t=typeof n=="object"?n:fn(),r=typeof n=="string"?n:e||mo,i=Qn(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=rf("firestore");s&&O_(i,...s)}return i}function V_(n){if(n._terminated)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||BS(n),n._firestoreClient}function BS(n){var e,t,r;let i=n._freezeSettings(),s=function(c,l,d,m){return new qu(c,l,d,m.host,m.ssl,m.experimentalForceLongPolling,m.experimentalAutoDetectLongPolling,D_(m.experimentalLongPollingOptions),m.useFetchStreams,m.isUsingEmulator)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new ch(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(c){let l=c?._online.build();return{_offline:c?._offline.build(l),_online:l}}(n._componentsProvider))}var Yt=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Se.fromBase64String(e))}catch(t){throw new x(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Se.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ui(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};Yt._jsonSchemaVersion="firestore/bytes/1.0",Yt._jsonSchema={type:he("string",Yt._jsonSchemaVersion),bytes:he("string")};var Sr=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new x(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Me(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Rr=class{constructor(e){this._methodName=e}};var Xt=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new x(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new x(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return W(this._lat,e._lat)||W(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(Ui(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};Xt._jsonSchemaVersion="firestore/geoPoint/1.0",Xt._jsonSchema={type:he("string",Xt._jsonSchemaVersion),latitude:he("number"),longitude:he("number")};var Zt=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ui(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new x(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Zt._jsonSchemaVersion="firestore/vectorValue/1.0",Zt._jsonSchema={type:he("string",Zt._jsonSchemaVersion),vectorValues:he("object")};var qS=/^__.*__$/,lh=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new ht(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ln(e,this.data,t,this.fieldTransforms)}},Fo=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ht(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function M_(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M(40011,{Ec:n})}}var hh=class n{constructor(e,t,r,i,s,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Ac(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.fc(e),i}gc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.Ac(),i}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return Bo(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(M_(this.Ec)&&qS.test(e))throw this.wc('Document fields cannot begin and end with "__"')}},dh=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Ho(e)}Dc(e,t,r,i=!1){return new hh({Ec:e,methodName:t,bc:r,path:Me.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function F_(n){let e=n._freezeSettings(),t=Ho(n._databaseId);return new dh(n._databaseId,!!e.ignoreUndefinedProperties,t)}function $S(n,e,t,r,i,s={}){let a=n.Dc(s.merge||s.mergeFields?2:0,e,t,i);Bh("Data must be an object, but it was:",a,r);let c=U_(r,a),l,d;if(s.merge)l=new $e(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){let m=[];for(let I of s.mergeFields){let E=ph(e,I,t);if(!a.contains(E))throw new x(P.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);q_(m,E)||m.push(E)}l=new $e(m),d=a.fieldTransforms.filter(I=>l.covers(I.field))}else l=null,d=a.fieldTransforms;return new lh(new Ve(c),l,d)}var Uo=class n extends Rr{_toFieldTransform(e){if(e.Ec!==2)throw e.Ec===1?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};var fh=class n extends Rr{_toFieldTransform(e){return new tl(e.path,new Dn)}isEqual(e){return e instanceof n}};function jS(n,e,t,r){let i=n.Dc(1,e,t);Bh("Data must be an object, but it was:",i,r);let s=[],a=Ve.empty();sn(r,(l,d)=>{let m=qh(e,l,t);d=ie(d);let I=i.gc(m);if(d instanceof Uo)s.push(m);else{let E=Qo(d,I);E!=null&&(s.push(m),a.set(m,E))}});let c=new $e(s);return new Fo(a,c,i.fieldTransforms)}function WS(n,e,t,r,i,s){let a=n.Dc(1,e,t),c=[ph(e,r,t)],l=[i];if(s.length%2!=0)throw new x(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let E=0;E<s.length;E+=2)c.push(ph(e,s[E])),l.push(s[E+1]);let d=[],m=Ve.empty();for(let E=c.length-1;E>=0;--E)if(!q_(d,c[E])){let S=c[E],k=l[E];k=ie(k);let L=a.gc(S);if(k instanceof Uo)d.push(S);else{let D=Qo(k,L);D!=null&&(d.push(S),m.set(S,D))}}let I=new $e(d);return new Fo(m,I,a.fieldTransforms)}function Qo(n,e){if(B_(n=ie(n)))return Bh("Unsupported field value:",e,n),U_(n,e);if(n instanceof Rr)return function(r,i){if(!M_(i.Ec))throw i.wc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return function(r,i){let s=[],a=0;for(let c of r){let l=Qo(c,i.yc(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=ie(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return bb(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=de.fromDate(r);return{timestampValue:To(i.serializer,s)}}if(r instanceof de){let s=new de(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:To(i.serializer,s)}}if(r instanceof Xt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Yt)return{bytesValue:a_(i.serializer,r._byteString)};if(r instanceof be){let s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.wc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:kh(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Zt)return function(a,c){return{mapValue:{fields:{[Th]:{stringValue:Ah},[mr]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw c.wc("VectorValues must only contain numeric values.");return Ch(c.serializer,d)})}}}}}}(r,i);throw i.wc(`Unsupported field value: ${Ih(r)}`)}(n,e)}function U_(n,e){let t={};return Lg(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):sn(n,(r,i)=>{let s=Qo(i,e.Vc(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function B_(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof de||n instanceof Xt||n instanceof Yt||n instanceof be||n instanceof Rr||n instanceof Zt)}function Bh(n,e,t){if(!B_(t)||!Ig(t)){let r=Ih(t);throw r==="an object"?e.wc(n+" a custom object"):e.wc(n+" "+r)}}function ph(n,e,t){if((e=ie(e))instanceof Sr)return e._internalPath;if(typeof e=="string")return qh(n,e);throw Bo("Field path arguments must be of type string or ",n,!1,void 0,t)}var zS=new RegExp("[~\\*/\\[\\]]");function qh(n,e,t){if(e.search(zS)>=0)throw Bo(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Sr(...e.split("."))._internalPath}catch{throw Bo(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Bo(n,e,t,r,i){let s=r&&!r.isEmpty(),a=i!==void 0,c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new x(P.INVALID_ARGUMENT,c+n+l)}function q_(n,e){return n.some(t=>t.isEqual(e))}var qo=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new be(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new mh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field($_("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},mh=class extends qo{data(){return super.data()}};function $_(n,e){return typeof e=="string"?qh(n,e):e instanceof Sr?e._internalPath:e._delegate._internalPath}var gh=class{convertValue(e,t="none"){switch(tn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ne(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Nt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw M(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return sn(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[mr].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(a=>ne(a.doubleValue));return new Zt(s)}convertGeoPoint(e){return new Xt(ne(e.latitude),ne(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=jo(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Di(e));default:return null}}convertTimestamp(e){let t=Dt(e);return new de(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ce.fromString(e);J(f_(r),9688,{name:e});let i=new go(r.get(1),r.get(3)),s=new F(r.popFirst(5));return i.isEqual(t)||kt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function HS(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Sn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Rn=class n extends qo{constructor(e,t,r,i,s,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new fr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field($_("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new x(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};Rn._jsonSchemaVersion="firestore/documentSnapshot/1.0",Rn._jsonSchema={type:he("string",Rn._jsonSchemaVersion),bundleSource:he("string","DocumentSnapshot"),bundleName:he("string"),bundle:he("string")};var fr=class extends Rn{data(e={}){return super.data(e)}},Ri=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Sn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new fr(this._firestore,this._userDataWriter,r.key,r,new Sn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new x(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(c=>{let l=new fr(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Sn(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);return c.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>s||c.type!==3).map(c=>{let l=new fr(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Sn(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,m=-1;return c.type!==0&&(d=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),m=a.indexOf(c.doc.key)),{type:GS(c.type),doc:l,oldIndex:d,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new x(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Pi.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function GS(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M(61501,{type:n})}}function j_(n){n=Cn(n,be);let e=Cn(n.firestore,br);return US(V_(e),n._key).then(t=>KS(e,n,t))}Ri._jsonSchemaVersion="firestore/querySnapshot/1.0",Ri._jsonSchema={type:he("string",Ri._jsonSchemaVersion),bundleSource:he("string","QuerySnapshot"),bundleName:he("string"),bundle:he("string")};var _h=class extends gh{constructor(e){super(),this.firestore=e}convertBytes(e){return new Yt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new be(this.firestore,null,t)}};function W_(n,e,t){n=Cn(n,be);let r=Cn(n.firestore,br),i=HS(n.converter,e,t);return H_(r,[$S(F_(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Jt.none())])}function z_(n,e,t,...r){n=Cn(n,be);let i=Cn(n.firestore,br),s=F_(i),a;return a=typeof(e=ie(e))=="string"||e instanceof Sr?WS(s,"updateDoc",n._key,e,t,r):jS(s,"updateDoc",n._key,e),H_(i,[a.toMutation(n._key,Jt.exists(!0))])}function H_(n,e){return function(r,i){let s=new st;return r.asyncQueue.enqueueAndForget(()=>p(null,null,function*(){return RS(yield MS(r),i,s)})),s.promise}(V_(n),e)}function KS(n,e,t){let r=t.docs.get(e._key),i=new _h(n);return new Rn(n,i,e._key,r,new Sn(t.hasPendingWrites,t.fromCache),e.converter)}function dD(){return new fh("serverTimestamp")}(function(e,t=!0){(function(i){Pr=i})(jt),He(new Ne("firestore",(r,{instanceIdentifier:i,options:s})=>{let a=r.getProvider("app").getImmediate(),c=new br(new Lu(r.getProvider("auth-internal")),new Mu(a,r.getProvider("app-check-internal")),function(d,m){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new x(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new go(d.options.projectId,m)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),c._setSettings(s),c},"PUBLIC").setMultipleInstances(!0)),se(Cm,km,e),se(Cm,km,"esm2017")})();var Mn=class{constructor(e){return e}},G_="firestore",$h=class{constructor(){return Yn(G_)}};var jh=new Wn("angularfire2.firestore-instances");function QS(n,e){let t=ni(G_,n,e);return t&&new Mn(t)}function JS(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Mn(r)}}var YS={provide:$h,deps:[[new Ue,jh]]},XS={provide:Mn,useFactory:QS,deps:[[new Ue,jh],yt]};function TN(n,...e){return se("angularfire",Wt.full,"fst"),zn([XS,YS,{provide:jh,useFactory:JS(n),multi:!0,deps:[Ze,Bt,zt,mn,[new Ue,Ei],[new Ue,Xn],...e]}])}var Re=ae(L_,!0,2);var Xe=ae(j_,!0);var AN=ae(x_,!0);var Fn=ae(W_,!0,2);var bN=ae(z_,!0,2);var K_=class n{auth=Fe(Tn);firestore=Fe(Mn);currentUserSubject=new wa(null);loadingSubject=new wa(!0);user$=this.currentUserSubject.asObservable();loading$=this.loadingSubject.asObservable();isAuthenticated$=this.user$.pipe(jn(e=>!!e));isEmailVerified$=this.user$.pipe(jn(e=>e?.emailVerified??!1));constructor(){vm(this.auth).subscribe(e=>p(this,null,function*(){if(e){let r=(yield Xe(Re(this.firestore,"users",e.uid))).data(),i=this.mapFirebaseUserToAuthUser(e);i.userRole=r?.userRole||void 0,i.firstTimeLogin=r?.firstTimeLogin||!1,i.lastLoginAt=r?.lastLoginAt||void 0,this.currentUserSubject.next(i)}else this.currentUserSubject.next(null);this.loadingSubject.next(!1)}))}getCurrentUser(){return this.currentUserSubject.value}getUserRole(){return this.getCurrentUser()?.userRole||null}isMentor(){return this.getUserRole()==="mentor"}isMentee(){return this.getUserRole()==="mentee"}signUp(e){return this.loadingSubject.next(!0),Te(wm(this.auth,e.email,e.password)).pipe(gt(t=>{let r=e.displayName;return!r&&(e.firstName||e.lastName)&&(r=`${e.firstName||""} ${e.lastName||""}`.trim()),r&&t.user?Te(vu(t.user,{displayName:r})).pipe(jn(()=>t)):[t]}),gt(t=>{if(t.user){let r={uid:t.user.uid,email:t.user.email||"",displayName:t.user.displayName||"",firstName:e.firstName||"",lastName:e.lastName||"",userRole:e.userRole,createdAt:new Date().toISOString(),emailVerified:!1,firstTimeLogin:!0,lastLoginAt:new Date().toISOString()};return Te(Fn(Re(this.firestore,"users",t.user.uid),r)).pipe(jn(()=>t))}return[t]}),gt(t=>t.user?Te(Iu(t.user)).pipe(jn(()=>t)):[t]),We(t=>{this.loadingSubject.next(!1);let r={code:t.code,message:this.getContextualErrorMessage(t,"signup")};return De(()=>r)}))}signIn(e){return this.loadingSubject.next(!0),Te(bm(this.auth,e.email,e.password)).pipe(gt(t=>p(this,null,function*(){if(t.user){let r=Re(this.firestore,"users",t.user.uid),a=(yield Xe(r)).data()?.userRole;if(!a)throw yield eo(this.auth),{code:"auth/role-not-set",message:"Please complete your profile by selecting your role first. Contact support if you need assistance."};if(a!==e.userRole){yield eo(this.auth);let c=a==="mentor"?"Mentor":"Mentee";throw{code:"auth/wrong-role",message:`You cannot sign in as a ${e.userRole==="mentor"?"Mentor":"Mentee"} because your account is registered as a ${c}. Please select the correct role to continue.`}}yield this.updateLoginTracking(t.user.uid)}return t})),We(t=>{this.loadingSubject.next(!1);let r={code:t.code,message:this.getContextualErrorMessage(t,"signin")};return De(()=>r)}))}signInWithGoogle(e){this.loadingSubject.next(!0);let t=new nu;return t.addScope("profile"),t.addScope("email"),Te(Eu(this.auth,t)).pipe(gt(r=>p(this,null,function*(){if(r.user)if((yield Xe(Re(this.firestore,"users",r.user.uid))).exists())yield this.updateLoginTracking(r.user.uid);else{let s={uid:r.user.uid,email:r.user.email||"",displayName:r.user.displayName||"",firstName:r.user.displayName?.split(" ")[0]||"",lastName:r.user.displayName?.split(" ").slice(1).join(" ")||"",userRole:e||"mentor",createdAt:new Date().toISOString(),emailVerified:r.user.emailVerified,firstTimeLogin:!0,lastLoginAt:new Date().toISOString()};yield Fn(Re(this.firestore,"users",r.user.uid),s)}return r})),We(r=>{this.loadingSubject.next(!1);let i={code:r.code,message:this.getContextualErrorMessage(r,"social")};return De(()=>i)}))}signInWithFacebook(e){this.loadingSubject.next(!0);let t=new tu;return t.addScope("email"),Te(Eu(this.auth,t)).pipe(gt(r=>p(this,null,function*(){if(r.user)if((yield Xe(Re(this.firestore,"users",r.user.uid))).exists())yield this.updateLoginTracking(r.user.uid);else{let s={uid:r.user.uid,email:r.user.email||"",displayName:r.user.displayName||"",firstName:r.user.displayName?.split(" ")[0]||"",lastName:r.user.displayName?.split(" ").slice(1).join(" ")||"",userRole:e||"mentor",createdAt:new Date().toISOString(),emailVerified:r.user.emailVerified,firstTimeLogin:!0,lastLoginAt:new Date().toISOString()};yield Fn(Re(this.firestore,"users",r.user.uid),s)}return r})),We(r=>{this.loadingSubject.next(!1);let i={code:r.code,message:this.getContextualErrorMessage(r,"social")};return De(()=>i)}))}signOut(){return this.loadingSubject.next(!0),Te(eo(this.auth)).pipe(Kd(()=>{this.currentUserSubject.next(null),console.log("User signed out successfully")}),Gd(()=>{this.loadingSubject.next(!1)}),We(e=>(this.loadingSubject.next(!1),console.error("Sign out error:",e),De(()=>this.handleAuthError(e)))))}signOutAndRedirect(){this.signOut().subscribe({next:()=>{localStorage.clear(),sessionStorage.clear(),window.location.href="/auth/login"},error:e=>{console.error("Error during sign out:",e),window.location.href="/auth/login"}})}sendPasswordResetEmail(e){return Te(Am(this.auth,e)).pipe(We(t=>{let r={code:t.code,message:this.getContextualErrorMessage(t,"reset")};return De(()=>r)}))}sendEmailVerification(){let e=this.auth.currentUser;return e?Te(Iu(e)).pipe(We(t=>De(()=>this.handleAuthError(t)))):De(()=>({code:"auth/no-user",message:"No user is currently signed in"}))}updateUserProfile(e){let t=this.auth.currentUser;return t?Te(vu(t,e)).pipe(We(r=>De(()=>this.handleAuthError(r)))):De(()=>({code:"auth/no-user",message:"No user is currently signed in"}))}updatePassword(e,t){let r=this.auth.currentUser;if(!r||!r.email)return De(()=>({code:"auth/no-user",message:"No user is currently signed in"}));let i=Xs.credential(r.email,t);return Te(Tm(r,i)).pipe(gt(()=>Te(Sm(r,e))),We(s=>De(()=>this.handleAuthError(s))))}userNeedsRoleSelection(){return p(this,null,function*(){let e=this.auth.currentUser;if(!e)return!1;try{return!(yield Xe(Re(this.firestore,"users",e.uid))).data()?.userRole}catch(t){return console.error("Error checking user role status:",t),!1}})}updateUserRole(e){let t=this.auth.currentUser;if(!t)return De(()=>({code:"auth/no-user",message:"No user is currently signed in"}));let r=Re(this.firestore,"users",t.uid);return Te(Fn(r,{userRole:e},{merge:!0})).pipe(gt(()=>{let i=this.getCurrentUser();return i&&(i.userRole=e,this.currentUserSubject.next(i)),[void 0]}),We(i=>(console.error("Error updating user role:",i),De(()=>({code:"auth/update-role-failed",message:"Failed to update user role. Please try again."})))))}getUserData(){return p(this,null,function*(){let e=this.auth.currentUser;if(!e)return null;try{let t=yield Xe(Re(this.firestore,"users",e.uid));return t.exists()?t.data():null}catch(t){return console.error("Error getting user data:",t),null}})}isFirstTimeLogin(){return p(this,null,function*(){let e=this.auth.currentUser;if(!e)return!1;try{return(yield Xe(Re(this.firestore,"users",e.uid))).data()?.firstTimeLogin!==!1}catch(t){return console.error("Error checking first time login status:",t),!1}})}getFirstTimeLoginStatus(){return p(this,null,function*(){let e=this.auth.currentUser;if(!e)return!1;try{return(yield Xe(Re(this.firestore,"users",e.uid))).data()?.firstTimeLogin===!0}catch(t){return console.error("Error checking first time login status:",t),!1}})}markFirstTimeLoginComplete(){return p(this,null,function*(){let e=this.auth.currentUser;if(!e)throw new Error("No user is currently signed in");try{let t=Re(this.firestore,"users",e.uid);yield Fn(t,{firstTimeLogin:!1},{merge:!0}),yield this.refreshUserState()}catch(t){throw console.error("Error marking first time login as complete:",t),t}})}refreshUserState(){return p(this,null,function*(){let e=this.auth.currentUser;if(e)try{let r=(yield Xe(Re(this.firestore,"users",e.uid))).data(),i=this.mapFirebaseUserToAuthUser(e);i.userRole=r?.userRole||void 0,i.firstTimeLogin=r?.firstTimeLogin||!1,i.lastLoginAt=r?.lastLoginAt||void 0,this.currentUserSubject.next(i)}catch(t){console.error("Error refreshing user state:",t)}})}updateLoginTracking(e){return p(this,null,function*(){try{let t=Re(this.firestore,"users",e),r=yield Xe(t);if(r.exists()){let s=r.data()?.firstTimeLogin!==!1,a={lastLoginAt:new Date().toISOString()};s&&(a.firstTimeLogin=!1),yield Fn(t,a,{merge:!0})}}catch(t){console.error("Error updating login tracking:",t)}})}mapFirebaseUserToAuthUser(e){return{uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,emailVerified:e.emailVerified,isAnonymous:e.isAnonymous,metadata:{creationTime:e.metadata.creationTime,lastSignInTime:e.metadata.lastSignInTime}}}handleAuthError(e){console.error("Firebase Auth Error:",e);let r={"auth/user-not-found":"No account found with this email address. Please check your email or create a new account.","auth/wrong-password":"Incorrect password. Please try again or reset your password.","auth/invalid-login-credentials":"Invalid email or password. Please check your credentials and try again.","auth/invalid-credential":"Invalid login credentials. Please check your email and password.","auth/user-disabled":"This account has been temporarily disabled. Please contact support.","auth/too-many-requests":"Too many failed login attempts. Please wait a few minutes before trying again.","auth/wrong-role":"Role mismatch. Please select the correct role for your account.","auth/email-already-in-use":"An account with this email address already exists. Please sign in instead.","auth/weak-password":"Password is too weak. Please use at least 6 characters with a mix of letters and numbers.","auth/invalid-email":"Please enter a valid email address.","auth/operation-not-allowed":"Email/password accounts are not enabled. Please contact support.","auth/missing-email":"Please enter your email address.","auth/missing-password":"Please enter your password.","auth/network-request-failed":"Network connection error. Please check your internet connection and try again.","auth/timeout":"The request timed out. Please try again.","auth/internal-error":"An internal error occurred. Please try again later.","auth/requires-recent-login":"For security reasons, please sign in again to complete this action.","auth/credential-already-in-use":"This credential is already associated with a different account.","auth/popup-closed-by-user":"Sign-in was cancelled. Please try again.","auth/cancelled-popup-request":"Sign-in request was cancelled.","auth/popup-blocked":"Sign-in popup was blocked. Please allow popups and try again.","auth/account-exists-with-different-credential":"An account already exists with the same email but different sign-in credentials.","auth/invalid-action-code":"The verification link is invalid or has expired. Please request a new one.","auth/expired-action-code":"The verification link has expired. Please request a new one.","auth/user-token-expired":"Your session has expired. Please sign in again.","auth/unauthorized-domain":"This domain is not authorized for OAuth operations.","auth/invalid-api-key":"Authentication configuration error. Please contact support.","auth/app-deleted":"Application configuration error. Please contact support.","auth/role-not-set":"Your account role is not configured. Please complete your profile setup.","auth/update-role-failed":"Failed to update your account role. Please try again."}[e.code];return r||(e.message?(r=e.message.replace(/Firebase:/g,"").replace(/\(auth\/[^)]+\)/g,"").trim(),r=r.charAt(0).toUpperCase()+r.slice(1),r.endsWith(".")||(r+=".")):r="An unexpected error occurred. Please try again."),{code:e.code||"auth/unknown",message:r}}getContextualErrorMessage(e,t){let r=this.handleAuthError(e).message;switch(t){case"signin":if(e.code==="auth/user-not-found")return"No account found with this email. Would you like to create a new account?";if(e.code==="auth/wrong-password"||e.code==="auth/invalid-credential")return"Incorrect password. Try again or reset your password if you forgot it.";if(e.code==="auth/wrong-role")return e.message;if(e.code==="auth/role-not-set")return"Your account needs to be set up. Please contact support or try social login to complete your profile.";break;case"signup":if(e.code==="auth/email-already-in-use")return"An account with this email already exists. Please sign in instead or use a different email.";if(e.code==="auth/weak-password")return"Please choose a stronger password with at least 6 characters, including letters and numbers.";break;case"reset":if(e.code==="auth/user-not-found")return"No account found with this email address. Please check the spelling or create a new account.";break;case"social":if(e.code==="auth/popup-blocked")return"Sign-in popup was blocked. Please enable popups for this site and try again.";if(e.code==="auth/popup-closed-by-user")return"Sign-in was cancelled. Click the button again to continue with social login.";if(e.code==="auth/wrong-role")return e.message;break}return r}static \u0275fac=function(t){return new(t||n)};static \u0275prov=os({token:n,factory:n.\u0275fac,providedIn:"root"})};export{ZR as a,eP as b,zk as c,Hk as d,dD as e,Mn as f,TN as g,Re as h,Xe as i,AN as j,Fn as k,bN as l,K_ as m};
